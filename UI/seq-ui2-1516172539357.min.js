"use strict";var _module=angular.module("seq-ui2",["ngRoute"]);_module.config(["$locationProvider",function(e){e.hashPrefix("")}]);_module.run(["$rootScope","$window","session","$location","$route",function(e,n,t,i,r){function o(){"$digest"!==e.$$phase&&e.$apply(function(){e.$broadcast("seq:relayout")})}function s(){"$digest"!==e.$$phase&&e.$apply(function(){e.$broadcast("seq:visibility-change","hidden"!==n.document.visibilityState)})}var u=!1;var a=null;var l=!1;e.$on("$routeChangeStart",function(n){if("/login"===i.url().substring(0,6))l=!0;else if(u)e.seq.user||i.url("/login");else{n.preventDefault();a=i.url()||"/"}});e.dropPrefs=function(){e.$broadcast("seq:drop-prefs")};n.addEventListener("resize",o,!1);n.addEventListener("visibilitychange",s,!1);e.$on("$destroy",function(){n.removeEventListener("resize",o,!1);n.removeEventListener("visibilitychange",s,!1)});return t.then(function(t){e.seq=t;"string"==typeof t.watermark&&(n.document.title=t.watermark+" â€” Seq");u=!0;a&&t.user?r.reload():t.user||l||i.url("/login")})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){e.when("/",{redirectTo:"/events"});e.otherwise({redirectTo:"/events"})}]);
"use strict";!function(){Seq.log=function(){}}();
"use strict";var _module=angular.module("seq-ui2");_module.factory("seqApi",["$http","$q","$window",function(n,e,t){var r={};var i=function(e){return n(e).then(function(n){return n.data})};var u=function(n,e,r,u){var o=t.UriTemplate.parse(e).expand(r);return i({method:n,url:o,data:u})};var o=function(n,u){var o={collection:n.collection};o.ensureLinks=function(){if(o.links){var t=e.defer();t.resolve(o.links);return t.promise}return r.root.get().then(function(e){var t=n.collection.slice(0,1);var r=n.collection.slice(1);var u=e.Links[t.toUpperCase()+r+"Resources"];return i({method:"GET",url:u}).then(function(n){o.links=n.Links;return o.links})})};o.link=function(n,e,r,u){return o.ensureLinks().then(function(a){if(!a.hasOwnProperty(e))throw new Error('The link name "'+e+'" is invalid in collection "'+o.collection+'".');var s=t.UriTemplate.parse(a[e]).expand(r||{});return i({method:n,url:s,data:u})})};o.get=function(n){return o.link("GET","Item",{id:n})};o.list=function(n){return o.link("GET","Items",n)};o.create=function(n,e){if(n.hasOwnProperty("Links")&&n.Links.hasOwnProperty("Create")){var r=t.UriTemplate.parse(n.Links.Create).expand(e||{});return i({method:"POST",url:r,data:n})}return o.link("POST","Items",e,n)};o.update=function(n){return i({method:"PUT",url:n.Links.Self,data:n})};o.createOrUpdate=function(n,e){return n.Id?o.update(n):o.create(n,e)};o.remove=function(n){return i({method:"DELETE",url:n.Links.Self})};o.template=function(){return o.link("GET","Template")};u&&u(o);return o};var a=function(n,e){r[n]=o({collection:n},e)};!function(){var n=r.root={};n.get=function(){if(n.entity){var t=e.defer();t.resolve(n.entity);return t.promise}return i({method:"GET",url:"api"}).then(function(e){n.entity=e;return n.entity})}}();a("events",function(n){n.inSignal=function(e,t){return n.link("POST","InSignal",t,e)};n.deleteInSignal=function(e,t){return n.link("DELETE","DeleteInSignal",t,e)};n.tabulate=function(e,t){return n.link("POST","Tabulate",t,e)}});a("data",function(n){n.query=function(e){return n.link("GET","Query",e)};n.inSignal=function(e,t){return n.link("POST","Query",t,e)}});a("updates");a("users",function(n){n.getCurrent=function(){return n.link("GET","Current")};n.login=function(e){return n.link("POST","Login",{},e)};n.logout=function(){return n.link("POST","Logout")};n.getAuthProviders=function(){return n.link("GET","AuthenticationProviders")};n.getSearchHistory=function(n){return i({method:"GET",url:n.Links.SearchHistory})};n.updateSearchHistory=function(n,e,t){return i({method:"POST",url:n.Links.Update,data:{Search:e,Status:t}})}});a("signals",function(n){n.addWatch=function(n){return i({method:"POST",url:n.Links.Watchers,data:{}})};n.removeWatch=function(n){return i({method:"DELETE",url:n.Links.Watchers,data:{}})}});a("sqlQueries",function(n){n.addUser=function(n){return i({method:"POST",url:n.Links.Users,data:{}})};n.removeUser=function(n){return i({method:"DELETE",url:n.Links.Users,data:{}})}});a("retentionPolicies");a("backups",function(n){n.getImmediateBackupUrl=function(){return n.ensureLinks().then(function(n){return t.UriTemplate.parse(n.Immediate).expand({})})}});a("expressions",function(n){n.toStrict=function(t){t=t||"";if(0===t.length){var r=e.defer();r.resolve({MatchedAsText:!1,StrictExpression:""});return r.promise}return n.link("GET","ToStrict",{fuzzy:t})};n.toSql=function(t){t=t||"";if(0===t.length){var r=e.defer();r.resolve({Expression:""});return r.promise}return n.link("GET","ToSql",{strict:t})};n.fuzzyToSql=function(t){t=t||"";if(0===t.length){var r=e.defer();r.resolve({Expression:""});return r.promise}return n.link("GET","ToSql",{fuzzy:t})}});a("apps",function(n){n.assemblyLink=function(n,e){return t.UriTemplate.parse(n.Links.Assembly).expand({assemblyName:e})};n.install=function(e){return n.link("POST","InstallPackage",e)};n.update=function(n,e){return u("POST",n.Links.UpdatePackage,e)}});a("appInstances",function(n){n.template=function(n){return u("GET",n.Links.InstanceTemplate)};n.invoke=function(n,e,t){return u("POST",n.Links.Invoke,{eventId:e},t)}});a("licenses",function(n){n.getCurrent=function(){return n.link("GET","Current")};n.downgradeToFree=function(){return n.link("POST","Downgrade")}});a("diagnostics",function(n){n.getServerMetrics=function(){return n.link("GET","ServerMetrics")};n.getIngestionLogUrl=function(){return n.ensureLinks().then(function(n){return t.UriTemplate.parse(n.IngestionLog).expand({})})};n.getSystemReportUrl=function(){return n.ensureLinks().then(function(n){return t.UriTemplate.parse(n.FullSystemReport).expand({})})};n.getServerStatus=function(e){return n.link("GET","ServerStatus",{initial:e})}});a("settings",function(n){n.getNamed=function(e){return n.link("GET",e)};n.setNamed=function(e,t){return n.getNamed(e).then(function(e){e.Value=t;return n.update(e)})};n.getInternalErrorReporting=function(){return n.link("GET","InternalErrorReporting")};n.updateInternalErrorReporting=function(e){return n.link("PUT","InternalErrorReporting",{},e)}});a("feeds");a("apiKeys");a("permalinks");a("dashboards",function(n){n.queryToChartQuery=function(e){return n.link("GET","QueryTemplate",{q:e})}});return r}]);
"use strict";var _module=angular.module("seq-ui2");_module.factory("busy",["$q",function(u){return{create:function(e){return new Seq.Busy(u,e)}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.factory("downloader",["$document",function(e){return{get:function(n){var a=angular.element('<iframe style="display:none" />');a.attr("src",n);e.find("body").eq(0).append(a)}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.factory("httpInterceptor",["$location","$q",function(t,r){var e=function(r){if(401!==r.status)return r;t.path("/login");return r};return{response:function(t){return e(t)},responseError:function(t){e(t);return r.reject(t)}}}]);_module.config(["$httpProvider",function(t){t.interceptors.push("httpInterceptor")}]);
"use strict";var _module=angular.module("seq-ui2");_module.factory("session",["$q","$location","seqApi","busy",function(e,t,n,s){return n.root.get().then(function(i){return n.users.getCurrent().then(function(r){var l={version:i.Version,instanceName:i.InstanceName,watermark:i.InstanceName,user:r,api:n,settings:{},filterCache:null};l.onLogin=function(t,i){l.user=t;l.settings.isSingleUser=i.IsSingleUser;l.filterCache=new Seq.FilterCache(e,n,s,t)};l.logout=function(){l.api.users.logout().then(function(){l.user=null;l.filterCache=null;t.path("/login")})};l.settings.reload=function(){var t=e.defer();t.resolve({IsSingleUser:!1});var s=[n.settings.getNamed("IsActiveDirectoryAuthentication"),n.settings.getNamed("IsAuthenticationEnabled"),n.users.getAuthProviders(),l.user?n.licenses.getCurrent():t.promise,n.settings.getNamed("InstanceTitle")];return e.all(s).then(function(e){var t=e[0];var n=e[1];var s=e[2];var i=e[3];var r=e[4];l.user&&l.onLogin(l.user,i);var a=s.Providers.length>0&&!s.Providers[0].IsAlternative?s.Providers[0]:null;var u=s.Providers.length>0&&s.Providers[0].IsAlternative?s.Providers[0]:null;l.settings.isAuthenticationEnabled=n.Value;l.settings.isActiveDirectory=!!t.Value;l.settings.azureADAuthenticationUrl=null!==a?a.Url:null;l.settings.alternateAuthenticationUrl=null!==u?u.Url:null;l.settings.alternateAuthenticationName=null!==u?u.Name:null;l.settings.isAzureAD=!!a;l.settings.isBasicAuth=!l.settings.isAzureAD&&!l.settings.isActiveDirectory;l.settings.isSingleUser=i.IsSingleUser;l.settings.instanceTitle=r.Value;r.Value&&(l.watermark=r.Value)})};return l.settings.reload().then(function(){return l})})})}]);
"use strict";var _module=angular.module("seq-ui2");_module.filter("calendar",["$window",function(e){return function(n){if(n){var r=e.moment(n).calendar();r=r[0].toLowerCase().concat(r.substring(1));return r}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.filter("date",function(){return function(e){if(e)return e.slice(0,10)}});
"use strict";function formatBytes(t){if("number"!=typeof t)return void 0===t?"undefined":_typeof(t);if(0===t)return"0 bytes";if(1===t)return"1 byte";if(-1===t)return"-1 byte";var r=Math.abs(t);var o=Math.floor(Math.log(r)/LOG_1024);var e=r/Math.pow(1024,o);t<0&&(e*=-1);var n=e>=100||0===o?0:2;return e.toFixed(n)+" "+UNITS[o]}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var _module=angular.module("seq-ui2");var UNITS=["bytes","kB","MB","GB","TB","PB","EB","ZB","YB"];var LOG_1024=Math.log(1024);_module.filter("formatBytes",function(){return formatBytes});_module.filter("formatBytesSize",function(){return function(t){return formatBytes(t).split(" ")[0]}});_module.filter("formatBytesUnits",function(){return function(t){return formatBytes(t).split(" ")[1]}});
"use strict";var _module=angular.module("seq-ui2");_module.filter("fromNow",["$window",function(o){return function(r){if(r)return o.moment(r).fromNow()}}]);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};var _module=angular.module("seq-ui2");_module.filter("longNumber",function(){return function(o){return"number"==typeof o?o.toLocaleString():void 0===o?"undefined":_typeof(o)}});
"use strict";var _module=angular.module("seq-ui2");_module.filter("percent",function(){return function(r){if(r){return Math.floor(100*r).toString()}return"0"}});
"use strict";var _module=angular.module("seq-ui2");_module.factory("plotly",["$window",function(l){return l.Plotly}]);
"use strict";var _module=angular.module("seq-ui2");_module.filter("timespan",function(){return function(e){return new Seq.Duration(e).friendly()}});
"use strict";var _module=angular.module("seq-ui2");_module.filter("yesNo",function(){return function(e){return e?"Yes":"No"}});
"use strict";var _module=angular.module("seq-ui2");_module.factory("animationBatch",["$timeout",function(t){return new Seq.AnimationBatch(t)}]);_module.directive("animatedEntry",["animationBatch",function(t){return{restrict:"A",link:function(n,i,a){t.onNextTick(function(){i.addClass(a.animatedEntry)})}}}]);
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _module=angular.module("seq-ui2");_module.directive("appSettingInput",function(){var e=function e(){_classCallCheck(this,e)};return Seq.component("appSettingInput",e,{model:"=",onChange:"&",type:"<",displayName:"<",placeholder:"<"})});
"use strict";var _module=angular.module("seq-ui2");_module.directive("avatar",function(){return{restrict:"E",replace:!0,templateUrl:"avatar.tpl.html",scope:{url:"=",size:"@"},link:function(l){function r(){l.url?u.url="url('"+l.url+"?d=blank&size="+l.size+"')":u.url=null}var u=l.avatar={url:null};r();l.$watch("url",r)}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("blurOnEnter",function(){return{restrict:"A",replace:!1,link:function(e,n){n[0].addEventListener("keyup",function(e){13===e.keyCode&&n[0].blur()})}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("changePassword",["session",function(e){return{restrict:"E",replace:!0,templateUrl:"change_password.tpl.html",scope:{user:"=",required:"@",issues:"="},link:function(s){var n=s.changePassword={};e.then(function(e){n.isAuthenticationEnabled=e.settings.isAuthenticationEnabled;s.$watch(function(){return s.$eval('(changePassword.changing || !user.Id || required == "true") && user.NewPassword != user.NewPasswordRepeat')},function(e){s.issues&&(s.issues.invalid=e)})})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("checkmark",function(){return{restrict:"E",replace:!0,templateUrl:"checkmark.tpl.html",scope:{checked:"="}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("close",["$compile",function(e){return{restrict:"A",scope:{close:"&"},link:function(c,l){l.addClass("close");l.append(e('<a href="" ng-click="close()">&times;</a>')(c))}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("controlGroup",function(){var e=0;return{restrict:"E",replace:!0,transclude:!0,templateUrl:"control_group.tpl.html",scope:{label:"@"},link:function(l,r){var t=l.controlGroup={label:l.label};if("string"==typeof t.label){var a=r.find("input")||r.find("select");if(a&&a[0]){var o=a[0];var i="seq-cg-"+t.label.toLowerCase().replace(/ /g,"-")+"-"+e++;t.labelFor=i;o.setAttribute("id",i)}}}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("datepicker",["$window","$timeout",function(e,t){var l=e.moment;return{restrict:"E",replace:!0,templateUrl:"datepicker.tpl.html",scope:{placeholder:"@",model:"=",changed:"&",ti:"@",timePrefs:"="},link:function(e,a){var i=e.datepicker={placeholder:e.placeholder,text:"",textChanged:null,textInvalid:!1,calendarVisible:!1,tabIndex:e.ti||"0",startOfWeek:e.timePrefs.startOfWeek,utc:e.timePrefs.utc};i.loadFromModel=function(){null===e.model?""!==i.text.trim()&&(i.text=""):i.text=e.timePrefs.formatFullDateTime(e.model)};i.gotFocus=function(){i.calendarVisible=!0};i.textChanged=function(a,n){var r=!1;i.textInvalid=!1;if(""!==i.text.trim()){var o=l(i.text,Seq.TimePreferences.fullDateTimeFormat);var d=i.utc?l(Date.UTC(o.year(),o.month(),o.date(),o.hour(),o.minute(),o.second(),o.millisecond())):o;if(d.isValid()&&d.year()>2001){if(!d.isSame(e.model)){e.model=d.toDate();r=!0}}else i.textInvalid=!0}else if(null!==e.model){e.model=null;r=!0}n&&(r=r||!i.calendarVisible);t(function(){a&&(i.calendarVisible=!1);r&&e.changed({$refresh:n&&!i.calendarVisible})})};i.select=function(t){i.text=e.timePrefs.formatFullDateTime(t);i.textChanged()};i.clear=function(){i.text="";i.textChanged()};i.revert=function(){i.loadFromModel();i.calendarVisible=!1};i.tabNext=function(){e.tabNext&&e.tabNext()};e.$on("document:clicked",function(e,t){var l=t;for(;0!==l.length;){if(l[0]===a[0])return;l=l.parent()}i.calendarVisible=!1});i.loadFromModel();e.$watch("model",function(){i.loadFromModel()})}}}]);
"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _module=angular.module("seq-ui2");_module.directive("directionPad",function(){var n=function n(){_classCallCheck(this,n)};return Seq.component("directionPad",n,{up:"&",down:"&",left:"&",right:"&"})});
"use strict";var _module=angular.module("seq-ui2");_module.run(["$rootScope","$document",function(e,n){angular.element(n).on("click",function(n){e.$apply(function(){e.$broadcast("document:clicked",angular.element(n.target))})})}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("dropdown",["$timeout",function(e){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"dropdown.tpl.html",scope:{text:"@",align:"@",iconClass:"@",toggleOn:"@"},link:function(t,n,o){t.subtle=o.hasOwnProperty("subtle");t.toggle=function(){"disabled"!==n.attr("disabled")&&(t.open=!t.open)};t.toggleOn&&t.$on(t.toggleOn,function(){e(function(){t.toggle()})});t.$on("document:clicked",function(e,o){var l=!1;var r=o;for(;0!==r.length;){l=l||r.hasClass("dropdown-toggle");if(r[0]===n[0]){l||(t.open=!1);return}r=r.parent()}t.open=!1})}}}]);
"use strict";function _classCallCheck(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}var _module=angular.module("seq-ui2");_module.directive("durationInput",function(){var n=function n(){_classCallCheck(this,n)};return Seq.component("durationInput",n,{duration:"="})});
"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var a=0;a<n.length;a++){var u=n[a];u.enumerable=u.enumerable||!1;u.configurable=!0;"value"in u&&(u.writable=!0);Object.defineProperty(t,u.key,u)}}return function(n,a,u){a&&t(n.prototype,a);u&&t(n,u);return n}}();var _module=angular.module("seq-ui2");_module.directive("durationTextInput",function(){var t=function(){function t(){_classCallCheck(this,t);this.durationData=null}_createClass(t,[{key:"link",value:function(t){var n=this;this.updateDurationData();t.$watch("durationTextInput.duration",function(){return n.updateDurationData()})}},{key:"updateDurationData",value:function(){null===this.duration||void 0===this.duration?this.durationData=null:this.durationData=new Seq.Duration(this.duration)}},{key:"updateDuration",value:function(){null===this.durationData?this.duration=null:this.duration=this.durationData.format();this.onChange()}}]);return t}();return Seq.component("durationTextInput",t,{duration:"=",onChange:"&"})});
"use strict";var _module=angular.module("seq-ui2");_module.directive("enterKey",function(){return function(e,n,t){n.bind("keydown keypress",function(n){if(13===n.which){e.$apply(function(){e.$eval(t.enterKey)});n.preventDefault()}})}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("errorBox",function(){return{restrict:"E",replace:!0,scope:{busy:"=for"},templateUrl:"error_box.tpl.html",link:function(r){r.errorBox={suppress:function(){r.busy.error=null}}}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("escKey",function(){return function(e,n,u){n.bind("keydown keypress",function(n){27===n.which&&e.$apply(function(){e.$eval(u.escKey)})})}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("filterEditor",["session","busy",function(t,e){return{restrict:"E",replace:!0,templateUrl:"filter_editor.tpl.html",scope:{model:"=",busy:"="},link:function(l){var r=l.filterEditor={parsing:l.busy||e.create("parse filter"),userInput:null,lastParseResult:null};t.then(function(t){function e(){l.model&&l.model.FilterNonStrict&&null===r.userInput&&(r.userInput=l.model.FilterNonStrict)}r.update=function(){if(!l.model||l.model.FilterNonStrict!==r.userInput){if(null!==r.userInput&&""!==r.userInput.trim()){var e=r.userInput;return r.parsing.until(t.api.expressions.toStrict(e).then(function(t){r.lastParseResult=t;l.model=l.model||{};l.model.Filter=t.StrictExpression;l.model.FilterNonStrict=e}))}l.model=null;r.lastParseResult=null}};e();l.$watch("model",function(){e()})})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("frequencyHistogram",["$window",function(t){t.moment;return{restrict:"E",replace:!0,templateUrl:"frequency_histogram.tpl.html",scope:{data:"=",pointClicked:"&",timePrefs:"="},link:function(t){function i(){if(t.data){var i=t.pointClicked;n.pointClicked=function(t){i({$point:t})};var a=(_.max(t.data.ticks,function(t){return t.count})||{count:0}).count;var e=0===a?1:100/a;n.bars=_.map(t.data.ticks,function(i){var n=t.data.tickFormat(i.tick);return{id:i.tick.toISOString()+n,tick:i.tick,count:i.count,label:n,title:i.count+" at "+t.timePrefs.formatFullDateTime(i.tick),barHeight:(e*i.count).toString()+"%",point:i}});n.barWidth=(100/(n.bars.length||1)).toString()+"%";n.vmax=a||1}}var n=t.frequencyHistogram={};t.$watch("data",function(){i()});i()}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("inplaceEditor",["$timeout","busy",function(i,t){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"inplace_editor.tpl.html",scope:{model:"=",inputClass:"@",commit:"&",initiallyEditing:"="},link:function(e,n){var l=e.inplaceEditor={inputClass:e.inputClass,editedValue:"",editing:!1,committing:null};l.begin=function(){l.editing=!0;l.editedValue=e.model;i(function(){n.find("form").find("input")[0].focus()})};l.cancel=function(){l.editing=!1};l.commit=function(){var i=e.commit({$value:l.editedValue});if(i&&i.then){l.committing=l.committing||t.create("commit edits");l.committing.until(i.then(function(){l.editing=!1}))}else l.editing=!1};e.initiallyEditing&&l.begin()}}}]);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var _module=angular.module("seq-ui2");_module.directive("braced",function(){return{scope:{open:"@jopen",close:"@jclose",collapsed:"="},restrict:"E",replace:!0,transclude:!0,template:'<span><span class="jbrace">{{open}}</span><span ng-if="!collapsed" ng-transclude></span><span ng-show="collapsed" class="jellipsis" >&hellip;</span><span class="jbrace">{{close}}</span></span>'}});_module.directive("jsonValue",["$compile","$window",function(e,a){var n=a.JSON;return{restrict:"E",scope:{model:"=",collapsed:"="},terminal:!0,link:function(a,s){a.escapeString=function(e){return n.stringify(e)};a.pp=function(e){var a=_.map(_.pairs(e),function(e){return{name:e[0],value:e[1]}});return _.sortBy(a,"name")};var l=null;switch(_typeof(a.model)){case"string":l='<span class="jstring">{{escapeString(model)}}</span>';break;case"number":l='<span class="jnumber" ng-class="{imprecise: model > 9007199254740992 || model < -9007199254740992}">{{model}}</span>';break;case"boolean":l='<span class="jbool">{{model}}</span>';break;case"undefined":l='<span class="jundefined">undefined</span>';break;default:l=null===a.model?'<span class="jnull">null</span>':Array.isArray(a.model)?'<span class="jarray"><braced jopen="[" jclose="]" collapsed="collapsed"><span ng-repeat="el in model track by $index"><json-value model="el"></json-value><span ng-show="!$last">, </span></span></braced></span>':'<span class="jobject"><braced jopen="{" jclose="}" collapsed="collapsed"><span ng-repeat="(name,value) in model" ng-init="vcollapsed = value.length != 0"><span class="jname" ng-click="vcollapsed = !vcollapsed">{{name}}</span>: <span class="jvalue"><json-value model="value" collapsed="vcollapsed"></json-value></span><span ng-show="!$last">, </span></span></braced></span>'}var o=angular.element(l);e(o)(a);s.replaceWith(o)}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("levelIndicator",function(){return{restrict:"E",replace:!0,scope:{level:"="},templateUrl:"level_indicator.tpl.html",link:function(e){e.levelClass="seq-level-"+Seq.EventLevel.normalize(e.level)}}});
"use strict";angular.module("seq-ui2").directive("loading",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{until:"=",while:"=",spinnerClass:"@",loadingClass:"@"},templateUrl:"loading.tpl.html",link:function(e,l,i){if(void 0!==i.while){e.complete=!e.while;e.$watch("while",function(l){e.complete=!l})}else if(e.until)e.complete=!0;else var t=e.$watch("until",function(l){if(l){e.complete=!0;t()}})}}});
"use strict";var _module=angular.module("seq-ui2");_module.factory("messageBox",["$q","$window",function(r,e){var n=null;var o=null;return{connectConfirm:function(r){n=r},confirm:function(o){if(n)return n(o);var t=r.defer();if(e.confirm(o)){t.resolve("OK");return t.promise}return r.reject("Cancel")},connectPrompt:function(r){o=r},prompt:function(n,t){if(o)return o(n,t);var u=r.defer();var c=e.prompt(n,t);if(null!==c){u.resolve(c);return u.promise}return r.reject("Cancel")}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("modal",["$timeout",function(e){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"modal.tpl.html",scope:{isVisible:"=",onCancel:"&",dialogStyle:"@"},link:function(i,n){var l=!1;i.$watch("isVisible",function(i,n){if(i&&!n){l=!0;e(function(){l=!1},500)}});i.$on("document:clicked",function(e,t){if(!l){var o=t;for(;0!==o.length;){if(o[0]===n[0])return;o=o.parent()}i.isVisible&&i.onCancel&&i.onCancel();i.isVisible=!1}})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("navClass",["$route",function(n){return{restrict:"A",link:function(r,u){var e=null;var a=function(){null!==e&&u.removeClass(e);e=null;if(n.current&&n.current.nav){var r="route-nav-"+n.current.nav;u.addClass(r);e=r}};a();r.$on("$routeChangeSuccess",a)}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("queryErrors",function(){return{restrict:"E",replace:!0,templateUrl:"query_errors.tpl.html",scope:{eventsControl:"=",dataSet:"="},link:function(e){var r=e.queryErrors={};var t=e.eventsControl;r.acceptSuggestion=function(){t.filter(e.dataSet.suggestion)}}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("rawEditor",["toast","$timeout",function(e,i){return{restrict:"E",replace:!0,templateUrl:"raw_editor.tpl.html",scope:{isVisible:"=",data:"=",edited:"&"},link:function(t,r){function a(){var e=JSON.stringify(t.data,null,2);o.setValue(e);i(function(){o.refresh()})}var n=t.rawEditor={};var o=null;i(function(){var e=r.find("textarea")[0];o=CodeMirror.fromTextArea(e,{mode:"application/json",theme:"seq"})});n.cancel=function(){t.isVisible=!1};n.done=function(){try{var i=JSON.parse(o.getValue());t.isVisible=!1;t.edited({$data:i})}catch(i){e.error(i)}};t.isVisible&&a();t.$watch("isVisible",function(e,i){e&&!i&&a()})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("serverStatusIndicator",["session","$interval",function(e,s){return{restrict:"E",replace:!0,templateUrl:"server_status_indicator.tpl.html",scope:{},link:function(n){var t=n.serverStatusIndicator={messages:[],isModal:!1,level:null};t.show=function(){t.messages.length&&(t.isModal=!0)};t.hide=function(){t.isModal=!1};e.then(function(e){var r=function(s){return e.api.diagnostics.getServerStatus(s).then(function(e){t.messages=e.StatusMessages;0===t.messages.length?t.level=null:_.find(t.messages,function(e){return"Error"===e.Level})?t.level="ERR":_.find(t.messages,function(e){return"Warning"===e.Level})?t.level="WARN":t.level="INFO"},function(){t.messages=[{Level:"Error",Message:"The server is unavailable."}];t.level="ERR"})};r(!0);var l=s(function(){return r(!1)},3e4);n.$on("$destroy",function(){s.cancel(l)})})}}}]);
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(n,t,i){t&&e(n.prototype,t);i&&e(n,i);return n}}();var _module=angular.module("seq-ui2");_module.directive("signalExpressionEditor",["session","$q",function(e,n){var t=function(){function t(){var i=this;_classCallCheck(this,t);this.expression=null;this.signals=[];this.nextSignal=null;this.state=Seq.SignalExpression.fromAPIType(this.expression);this.loading=new Seq.Busy(n,"load signals");this.loading.until(e.then(function(e){return e.api.signals.list()}).then(function(e){i.signals=e}));this.notReferencedFilter=this.notReferenced.bind(this)}_createClass(t,[{key:"link",value:function(e){var n=this;e.$watch("signalExpressionEditor.expression",function(){n.state=Seq.SignalExpression.fromAPIType(n.expression)})}},{key:"notReferenced",value:function(e){return e&&!this.state.references(e.Id)}},{key:"findSignal",value:function(e){return e?this.signals.find(function(n){return n.Id===e})||null:null}},{key:"signalName",value:function(e){return(this.findSignal(e)||{Title:e}).Title}},{key:"isMissing",value:function(e){return null===this.findSignal(e)}},{key:"addSignal",value:function(e){var n=this;var t=this.findSignal(e);if(t){var i=Seq.SignalEntity.tryGetDefaultGroupName(t);if(null!==i){var s=!0;var a=!1;var r=void 0;try{for(var l,o=this.state.intersection[Symbol.iterator]();!(s=(l=o.next()).done);s=!0){var u=l.value;if(u.union.every(function(e){var t=n.findSignal(e);return t&&i===Seq.SignalEntity.tryGetDefaultGroupName(t)})){this.state=this.state.extendIntersection(u,e);this.expression=this.state.toAPIType();this.nextSignal=null;this.onChange();return}}}catch(e){a=!0;r=e}finally{try{!s&&o.return&&o.return()}finally{if(a)throw r}}}this.state=this.state.addIntersection(new Seq.IntersectedSignalExpression([e]));this.expression=this.state.toAPIType();this.nextSignal=null;this.onChange()}}},{key:"removeSignal",value:function(e){this.state=this.state.withoutReference(e);this.expression=this.state.toAPIType();this.nextSignal=null;this.onChange()}}]);return t}();return Seq.component("signalExpressionEditor",t,{expression:"=",readOnly:"=",onChange:"&"})}]);
"use strict";function _classCallCheck(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,i){for(var e=0;e<i.length;e++){var t=i[e];t.enumerable=t.enumerable||!1;t.configurable=!0;"value"in t&&(t.writable=!0);Object.defineProperty(n,t.key,t)}}return function(i,e,t){e&&n(i.prototype,e);t&&n(i,t);return i}}();var _module=angular.module("seq-ui2");_module.directive("signalPicker",["session","$q",function(n,i){var e=function(){function e(){var t=this;_classCallCheck(this,e);this.signals=[];this.nextSignal=null;this.loading=new Seq.Busy(i,"load signals");this.loading.until(n.then(function(n){return n.api.signals.list()}).then(function(n){t.signals=n}).then(function(){return t.removeInvalidSignals()}));this.notPickedFilter=this.notPicked.bind(this)}_createClass(e,[{key:"addSignal",value:function(n){if(n){this.signalIds.push(n);this.nextSignal=null;this.onChange()}}},{key:"removeSignal",value:function(n){if(n){this.signalIds.splice(this.signalIds.indexOf(n),1);this.onChange()}}},{key:"signalName",value:function(n){var i=_.find(this.signals,{Id:n});return i?i.Title:n}},{key:"notPicked",value:function(n){return n&&!_.contains(this.signalIds,n.Id)}},{key:"removeInvalidSignals",value:function(){var n=this;Seq.log("SignalPickerController","remove invalid signals",this);var i=_.pluck(this.signals,"Id");var e=_.filter(this.signalIds,function(n){return!_.contains(i,n)});_.each(e,function(i){n.removeSignal(i)})}}]);return e}();return Seq.component("signalPicker",e,{signalIds:"=",onChange:"&"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("syntaxHint",function(){return{restrict:"E",replace:!0,scope:{strictResult:"="},templateUrl:"syntax_hint.tpl.html",link:function(t){function e(){if(t.strictResult&&t.strictResult.MatchedAsText){s.message=t.strictResult.ReasonIfMatchedAsText;s.isText=!0}else{s.message="";s.isText=!1}}var s=t.syntaxHint={message:"",isText:!1,showMessage:!1};e();t.$watch("strictResult",e)}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("tabKey",function(){return function(e,n,u){n.bind("keydown keypress",function(n){9===n.which&&e.$apply(function(){e.$eval(u.tabKey)})})}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("tidyScroller",["$timeout",function(t){return{restrict:"A",link:function(n,e,r){n.ps=new PerfectScrollbar(e[0],{minScrollbarLength:10});var i=function(){t(function(){n.ps.update()})};e.bind("mouseenter",function(){i()});var o=void 0;n.$watch(r.tidyScroller,function(){o&&o();o=n.$watchCollection(r.tidyScroller,function(){i()});i()});i()}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.factory("toast",["$timeout",function(e){var n=new Seq.Toaster;return{listen:function(e){n.listen(e)},info:function(s){e(n.success(s),2e3)},success:function(s){e(n.success(s),2e3)},error:function(s){e(n.error(s),2e3)}}}]);
"use strict";!function(){function r(r,t){var e=this;if(void 0===r||void 0===t)throw new Error("Arguments ($q, activity) are required");e.$q=r;e.activity=t;e.isBusy=!1;e.error=null;e._current=null}r.prototype.reset=function(){var r=this;r.isBusy=!1;r.error=null;r._current=null};r.prototype.setError=function(r){var t=this;t.reset();t.error=r};r.prototype.until=function(r){var t=this;if(!r)throw new Error("A promise was expected");t._current&&t.reset();t.isBusy=!0;t._current=r;return r.then(function(e){t._current===r&&t.reset();return e},function(e){if(t._current===r){t.reset();e.data&&e.data.Error?t.error=e.data.Error:e.status&&e.statusText?t.error="The server responded with HTTP status code "+e.status+" ("+e.statusText+").":0===e.status||-1===e.status?t.error="The server could not be contacted.":t.error=e.message||e}return t.$q.reject(e)})};Seq.Busy=r}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(r,n,a){n&&e(r.prototype,n);a&&e(r,a);return r}}();!function(){var e={debug:"Verbose",information:"Debug",warning:"Information",error:"Warning",fatal:"Error"};var r={};r.debug="@Level = 'Verbose' or @Level = 'Trace'";r.information=r.debug+" or @Level = 'Debug'";r.warning=r.information+" or @Level = 'Information' or @Level = 'Info'";r.error=r.warning+" or @Level = 'Warning' or @Level = 'Warn'";r.fatal=r.error+" or @Level = 'Error'";var n=function(){function n(){_classCallCheck(this,n)}_createClass(n,null,[{key:"normalize",value:function(e){if(null===e||void 0===e)return"information";var r="information";switch(e.toLowerCase()){case"trace":case"verbose":r="verbose";break;case"debug":r="debug";break;case"warning":case"warn":r="warning";break;case"error":r="error";break;case"fatal":case"critical":r="fatal"}return r}},{key:"nextDown",value:function(r){return e[n.normalize(r)]}},{key:"below",value:function(e){return r[n.normalize(e)]}}]);return n}();Seq.EventLevel=n}();
"use strict";!function(){function t(t,e,i,n){var r=this;r.$q=t;r.api=e;r.items={};r.parsing=i.create("parsing filter");r.history=[];r.pinned=[];r.user=n;r.retainedRecentSearches=10;r.historyEntity=null;r._backgroundLoad()}t.prototype._backgroundLoad=function(){var t=this;t.api.users.getSearchHistory(t.user).then(function(e){t.historyEntity=e;t.retainedRecentSearches=e.RetainedRecentSearches;var i=_.clone(t.history);t.history.length=0;var n=_.clone(e.Recent);n.reverse();_.each(n,function(e){t.pushHistory(e,!0)});i.reverse();_.each(i,function(e){t.pushHistory(e)});var r=_.clone(e.Pinned);r.reverse();_.each(r,function(e){t.pushPinned(e,!0)})})};t.prototype.toStrict=function(t){var e=this;if(""===t.trim()){var i=e.$q.defer();i.resolve({StrictExpression:null});return i.promise}e.pushHistory(t);if(e.items.hasOwnProperty(t)){var n=e.$q.defer();n.resolve(e.items[t]);return e.parsing.until(n.promise)}return e.parsing.until(e.api.expressions.toStrict(t).then(function(i){e.items[t]=i;return i}))};t.prototype.pushHistory=function(t,e){var i=this;if(!_.contains(i.pinned,t)){_.contains(i.history,t)?i.history.splice(i.history.indexOf(t),1):i.history.length>=i.retainedRecentSearches&&(i.history.length=i.retainedRecentSearches-1);i.history.splice(0,0,t);!e&&i.historyEntity&&i.api.users.updateSearchHistory(i.historyEntity,t,"Used")}};t.prototype.forget=function(t){var e=this;_.contains(e.history,t)&&e.history.splice(e.history.indexOf(t),1);_.contains(e.pinned,t)&&e.pinned.splice(e.pinned.indexOf(t),1);e.historyEntity&&e.api.users.updateSearchHistory(e.historyEntity,t,"Forgotten")};t.prototype.pin=function(t){var e=this;_.contains(e.history,t)&&e.history.splice(e.history.indexOf(t),1);e.pushPinned(t);e.historyEntity&&e.api.users.updateSearchHistory(e.historyEntity,t,"Pinned")};t.prototype.pushPinned=function(t){this.pinned.splice(0,0,t)};Seq.FilterCache=t}();
"use strict";function _toConsumableArray(n){if(Array.isArray(n)){for(var r=0,t=Array(n.length);r<n.length;r++)t[r]=n[r];return t}return Array.from(n)}function _classCallCheck(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};var _createClass=function(){function n(n,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(n,e.key,e)}}return function(r,t,e){t&&n(r.prototype,t);e&&n(r,e);return r}}();!function(){var n=function(){function n(r){_classCallCheck(this,n);if("object"!==(void 0===r?"undefined":_typeof(r)))throw new Error("Union array is required.");this.union=r}_createClass(n,[{key:"references",value:function(n){return this.union.some(function(r){return r===n})}},{key:"withoutReference",value:function(r){return new n(this.union.filter(function(n){return n!==r}))}},{key:"toString",value:function(){return 1===this.union.length?this.union[0]:"("+this.union.join("~")+")"}},{key:"addUnion",value:function(r){return new n([].concat(_toConsumableArray(this.union),[r]))}},{key:"flatten",value:function(){return this.union}},{key:"toAPIType",value:function(){var n=null;var r=!0;var t=!1;var e=void 0;try{for(var o,i=this.union[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var u=o.value;var a={Kind:"Signal",SignalId:u};n=null===n?a:{Kind:"Union",Left:n,Right:a}}}catch(n){t=!0;e=n}finally{try{!r&&i.return&&i.return()}finally{if(t)throw e}}return n}}]);return n}();Seq.IntersectedSignalExpression=n}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1;t.configurable=!0;"value"in t&&(t.writable=!0);Object.defineProperty(e,t.key,t)}}return function(r,n,t){n&&e(r.prototype,n);t&&e(r,t);return r}}();!function(){var e=/^Equal\((@{0,1}[A-z][A-z0-9_]*),(?:@"|[@"'0-9])/;var r=function(){function r(){_classCallCheck(this,r)}_createClass(r,null,[{key:"tryExtractEqualityPropertyName",value:function(r){var n=e.exec(r);return null===n?null:n[1]}}]);return r}();Seq.PropertyComparisonExtractor=r}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"tryGetDefaultGroupName",value:function(e){return"Explicit"===e.Grouping?e.ExplicitGroupName:"None"===e.Grouping?null:e.Filters&&1===e.Filters.length?Seq.PropertyComparisonExtractor.tryExtractEqualityPropertyName(e.Filters[0].Filter):null}}]);return e}();Seq.SignalEntity=e}();
"use strict";function _toConsumableArray(n){if(Array.isArray(n)){for(var e=0,t=Array(n.length);e<n.length;e++)t[e]=n[e];return t}return Array.from(n)}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(n,r.key,r)}}return function(e,t,r){t&&n(e.prototype,t);r&&n(e,r);return e}}();!function(){var n=function(){function n(e){_classCallCheck(this,n);if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("Intersection array is required.");this.intersection=e;this.referencedSignalIds=e.reduce(function(n,e){return[].concat(_toConsumableArray(n),_toConsumableArray(e.union))},[])}_createClass(n,[{key:"references",value:function(n){return this.intersection.some(function(e){return e.references(n)})}},{key:"withoutReference",value:function(e){return new n(this.intersection.map(function(n){return n.withoutReference(e)}).filter(function(n){return 0!==n.union.length}))}},{key:"toString",value:function(){return this.intersection.join(",")}},{key:"intersect",value:function(e){return new n([].concat(_toConsumableArray(this.intersection),_toConsumableArray(e.intersection)))}},{key:"addIntersection",value:function(e){return new n([].concat(_toConsumableArray(this.intersection),[e]))}},{key:"extendIntersection",value:function(e,t){return new n([].concat(_toConsumableArray(this.intersection.filter(function(n){return n!==e})),[e.addUnion(t)]))}},{key:"flatten",value:function(){return this.intersection.map(function(n){return n.flatten()})}},{key:"toAPIType",value:function(){var n=null;var e=!0;var t=!1;var r=void 0;try{for(var o,i=this.intersection[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var u=o.value;var c=u.toAPIType();null!==c&&(n=null===n?c:{Kind:"Intersection",Left:n,Right:c})}}catch(n){t=!0;r=n}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}return n}},{key:"isEmpty",get:function(){return 0===this.intersection.length}}],[{key:"fromAPIType",value:function(e){return new n(null===e||void 0===e?[]:n.collectOperands(e,"Intersection").map(function(e){return new Seq.IntersectedSignalExpression(n.collectOperands(e,"Union").map(function(n){return n.SignalId}))}))}},{key:"collectOperands",value:function(e,t){return e.Kind===t?n.collectOperands(e.Left,t).concat(n.collectOperands(e.Right,t)):[e]}}]);return n}();Seq.SignalExpression=n}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1;t.configurable=!0;"value"in t&&(t.writable=!0);Object.defineProperty(e,t.key,t)}}return function(n,r,t){r&&e(n.prototype,r);t&&e(n,t);return n}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"_tokenize",value:function(e,n){if(0===e.trim().length)return[];var r=_.chain(e.split(n)).map(function(e){return e.trim()}).value();_.each(r,function(e){if(""===e)throw new Error("Expression should not contain empty items.")});return r}},{key:"_parseIntersection",value:function(n){if("string"!=typeof n)throw new Error("Intersection should be a string.");if(-1===n.indexOf("(")&&-1===n.indexOf(")")){if(-1!==n.indexOf("~"))throw new Error("Intersection elements must be parenthesized.");return new Seq.IntersectedSignalExpression([n])}if(n.length<3||"("!==n[0]||")"!==n[n.length-1])throw new Error("Union elements must be parenthesized; nested expressions are not supported.");var r=n.substring(1,n.length-1);if(-1!==r.indexOf("(")||-1!==r.indexOf(")"))throw new Error("Nested expressions are not supported.");var t=e._tokenize(r,"~");if(t.length<2)throw new Error("Only unioned signal ids should be parenthesized.");return new Seq.IntersectedSignalExpression(t)}},{key:"parse",value:function(n){if("string"!=typeof n)throw new Error("Expression must be of type string.");var r=_.chain(e._tokenize(n,",")).map(function(n){return e._parseIntersection(n)}).value();return new Seq.SignalExpression(r)}}]);return e}();Seq.SignalExpressionParser=e}();
"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(n,r.key,r)}}return function(e,t,r){t&&n(e.prototype,t);r&&n(e,r);return e}}();!function(){var n=function(){function n(){_classCallCheck(this,n)}_createClass(n,null,[{key:"truncate",value:function(n,e){return n.length>e?n.substring(0,e)+"...":n}}]);return n}();Seq.Text=n}();
"use strict";var _module=angular.module("seq-ui2");_module.factory("completionSource",function(){var e=new Seq.CompletionSource;_.each(["Contains","IndexOf","Length","StartsWith","EndsWith","Has","Arrived","DateTime","TypeOf","TotalMilliseconds","Round","ToIsoString","ToHexString","ToTimeString","TimeSpan","TimeOfDay","ToNumber","Substring","ToEventType","Now"],function(t){e.add(t+"(")});_.each(["Arrived","Document","Exception","EventType","Id","Level","Message","MessageTemplate","Properties","Timestamp"],function(t){e.add("@"+t)});e.add("select",Seq.Syntax.INDETERMINATE);_.each(["from","stream","where","group by","limit","like","order by","asc","desc","for","refresh"],function(t){e.add(t,Seq.Syntax.QUERY)});_.each(["time","min","max","count","sum","distinct","mean","percentile","first","last","top","bottom","coalesce"],function(t){e.add(t+"(",Seq.Syntax.QUERY)});return e});
"use strict";!function(){function n(n,t,e,r){return{restrict:"E",replace:!0,templateUrl:n.replace(/([A-Z])/g,function(n){return"_"+n.toLowerCase()})+".tpl.html",transclude:r.transclude,scope:{},controller:t,controllerAs:n,bindToController:e,link:function(n,t,e,r){r&&"function"==typeof r.link&&r.link(n,t,e)}}}function t(t,e,r){return n(t,e,r,{})}function e(t,e,r){return n(t,e,r,{transclude:!0})}Seq.component=t;Seq.componentTransclude=e}();
"use strict";!function(){function r(r,e){if(void 0===r)throw new Error("A route provider is required.");var o=this;o.$routeProvider=r;o.nav=e}r.prototype.when=function(r,e){if(void 0===r)throw new Error("A path is required.");if(void 0===e)throw new Error("A route is required.");var o=this;var i=_.clone(e);i.resolve=_.clone(i.resolve||{});i.resolve.seq=["session",function(r){return r}];i.nav=o.nav;o.$routeProvider.when(r,i)};Seq.Router=r}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,a,i){a&&e(t.prototype,a);i&&e(t,i);return t}}();var _module=angular.module("seq-ui2");_module.controller("DashboardsController",function(){function e(t,a,i,s,n,o,d){var r=this;_classCallCheck(this,e);this.d={seq:t,$scope:a,messageBox:o,$q:s};this.viewSettings=new Seq.DashboardViewSettings(i.localStorage);this.location=new Seq.DashboardLocation(n,i);this.model=new Seq.DashboardsModel;this.loadingDashboards=new Seq.Busy(s,"load dashboards");this.listExpanded=!0;this.canNavigate=!1;this.loadingDashboards.until(this.refresh().then(function(){var e=r.location.addChartParams();e&&r.location.addChartParams(null);var t=!1;var i=null;if(null!==r.location.dashboardId()){i=r.location.dashboardId();r.viewSettings.lastViewedDashboardId(i)}else if(e)t=!0;else if(null!==r.viewSettings.lastViewedDashboardId()&&r.model.isValidDashboardId(r.viewSettings.lastViewedDashboardId())){i=r.viewSettings.lastViewedDashboardId();r.location.dashboardId(i)}else{r.location.dashboardId(null);r.viewSettings.lastViewedDashboardId(null);r.location.maximized(!1)}r.model.onLoaded(i);e&&(t?r.d.seq.api.dashboards.template().then(function(e){return r.switchToNew(e)}).then(function(){return r.model.active.addChart(e)}):r.model.active.addChart(e));r.d.$scope.$on("$routeChangeStart",function(e){if(!r.canNavigate){var t=n.url();e.preventDefault();r.checkUnsaved().then(function(){r.canNavigate=!0;n.url(t)})}});var s=d(function(){return r.refresh()},6e4);a.$on("$destroy",function(){return d.cancel(s)})}))}e.$inject=["seq","$scope","$window","$q","$location","messageBox","$interval"];_createClass(e,[{key:"showList",value:function(){this.listExpanded||this.showHideList()}},{key:"showHideList",value:function(){this.listExpanded=!this.listExpanded;this.d.$scope.$broadcast("seq:relayout")}},{key:"refresh",value:function(){var e=this;return this.d.seq.api.dashboards.list({ownerId:this.d.seq.user.Id,shared:!0}).then(function(t){e.model.refresh(t)})}},{key:"confirmDiscard",value:function(){return this.d.messageBox.confirm("Discard changes to the current dashboard?")}},{key:"tryAdd",value:function(){var e=this;return null!==this.model.active&&this.model.active.dirty?this.confirmDiscard().then(function(){return e.d.seq.api.dashboards.template()}).then(function(t){if(null!==e.model.active.dashboard.Id)return e.d.seq.api.dashboards.get(e.model.active.dashboard.Id).then(function(t){return e.model.active.replace(t)}).then(function(){e.switchToNew(t)});e.switchToNew(t)}):this.d.seq.api.dashboards.template().then(function(t){return e.switchToNew(t)})}},{key:"checkUnsaved",value:function(){if(null===this.model.active||!this.model.active.dirty){var e=this.d.$q.defer();e.resolve(!0);return e.promise}return this.confirmDiscard()}},{key:"tryActivate",value:function(e){var t=this;this.model.isActive(e)||(null!==this.model.active&&this.model.active.dirty?this.confirmDiscard().then(function(){if(null!==t.model.active.dashboard.Id)return t.d.seq.api.dashboards.get(t.model.active.dashboard.Id).then(function(e){return t.model.active.replace(e)}).then(function(){t.activate(e)});t.activate(e)}):this.activate(e))}},{key:"activate",value:function(e){if(this.model.activate(e)){this.location.dashboardId(e.Id);this.viewSettings.lastViewedDashboardId(e.Id)}}},{key:"onCreated",value:function(e){if(this.model.isActive(e)){this.location.dashboardId(e.Id);this.viewSettings.lastViewedDashboardId(e.Id)}}},{key:"onDeleted",value:function(e){Seq.log("DashboardsController","on deleted",e);if(this.model.onDeleted(e)){this.location.dashboardId(null);this.viewSettings.lastViewedDashboardId(null);Seq.log("DashboardsController","reset location")}}},{key:"switchToNew",value:function(e){this.model.add(e);this.activate(e)}}]);return e}());
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(r){r.when("/dash",{redirectTo:"/dashboards"});new Seq.Router(r,"dashboards").when("/dashboards",{controller:"DashboardsController",controllerAs:"dashboards",templateUrl:"dashboards.tpl.html",reloadOnSearch:!1})}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("EventsController",["$scope","$window","$document","$location","$timeout","$q","$route","seq","busy","completionSource","messageBox","toast","downloader",function(e,t,n,r,o,i,l,s,a,c,u,d,f){function h(){if(null!==g.eventSet){g.control.showExpanded=!1;g.eventSet.dispose();g.eventSet=null}if(null!==g.dataSet){g.dataSet.dispose();g.dataSet=null}}function S(e){return"Not("+e+")"}function y(e){return{Filter:S(e.Filter),FilterNonStrict:e.FilterNonStrict,Description:e.Description||e.FilterNonStrict||e.Filter,DescriptionIsExcluded:!0}}function p(e){Seq.log("EventsController","to signal filter part",e);return"string"==typeof e.strictFilter?{Filter:e.strictFilter,FilterNonStrict:e.filter,Description:e.description}:{Filter:e.filter,Description:e.description}}var v=new Seq.StreamSlice(r);var g=e.events={layout:{timelineVisible:!1,query:!1,minSignalBar:!1,selectedView:null,multiline:!1,_listeners:[]},editor:new Seq.SignalEditor(i,s,function(){g.layout.minSignalBar=!1;g.queryEditor.clear()}),queryEditor:new Seq.QueryEditor(i,s,function(){g.layout.minSignalBar=!1}),control:{lastParseResult:null,showExpanded:v.showExpanded,deletionEnabled:v.deletionEnabled,appInstances:[]},slice:v,filters:s.filterCache,eventSet:null,dataSet:null,tagAllocator:new Seq.TagAllocator,refreshing:a.create("refresh events"),timePrefs:new Seq.TimePreferences(s.user.Preferences.ShowTimestampsIn12HourTime,s.user.Preferences.ShowTimestampsInUtc,s.user.Preferences.StartOfWeek),timeoutMS:1e3*parseInt(s.user.Preferences.QueryTimeoutSeconds||"60",10)};g.layout.query=g.slice.query&&g.slice.query.length;g.layout.selectView=function(e){g.layout.selectedView=e;g.slice.view=e};g.layout.selectedView=g.slice.view;g.layout.addUpdateListener=function(e){g.layout._listeners.push(e)};g.layout.removeUpdateListener=function(e){g.layout._listeners=_.without(g.layout._listeners,e)};g.layout.update=function(){_.each(g.layout._listeners,function(e){e()})};g.layout.toggleMinSignalBar=function(){g.layout.minSignalBar=!g.layout.minSignalBar;g.layout.update()};g.queryEditor.setDefaultContent(g.slice.filter||g.slice.query);if(!g.layout.query&&!g.slice.hasRawSignal&&""===g.slice.filter&&!g.control.showExpanded){var m=(s.user.Preferences.DefaultSignal||"").trim();0!==m.length&&(g.slice.signal=Seq.SignalExpressionParser.parse(m))}var w=function(){"$digest"!==e.$$phase&&e.$apply(function(){g.layout.update()})};t.addEventListener("resize",w,!1);e.$on("$destroy",function(){t.removeEventListener("resize",w,!1)});g.control.showExpanded&&(g.slice.showExpanded=!1);e.$on("$destroy",function(){h()});var q=new Seq.InitialWindowEstimator(n);g.control.refresh=function(e){g.layout.query=g.slice.query&&g.slice.query.length;if(g.layout.query){if(e)return g.control.refreshQuery();var t=i.defer();t.resolve(null);return t.promise}return g.control.refreshFilter()};g.control.refreshFilter=function(e){g.slice.autorefresh=!1;g.layout.query=!1;h();var t=g.filters.toStrict(g.slice.filter);return g.refreshing.until(g.editor.current().then(function(n){return t.then(function(t){g.control.lastParseResult=t;var r={signalExpression:g.slice.signal,signal:n,filter:t.StrictExpression,fromUtc:g.slice.fromUtc,toUtc:g.slice.toUtc};g.eventSet=new Seq.EventSet(i,s.api,r,q.count(),c,o);if(!e)return g.eventSet.loadMore();g.eventSet.completeWith(e)})}))};g.control.autorefresh=function(){return g.control.refreshFilter().then(function(){if(null!==g.eventSet){g.slice.autorefresh=!0;g.eventSet.startAutorefresh()}})};g.control.stop=function(){g.slice.autorefresh=!1;if(null!==g.eventSet){g.eventSet.dispose();g.control.refreshFilter(g.eventSet.events)}else if(null!==g.dataSet){g.dataSet.dispose();g.dataSet=null}};g.control.interacted=function(){if(null!==g.eventSet&&"auto"===g.eventSet.state){g.slice.autorefresh=!1;g.eventSet.dispose()}};g.control.exclude=function(e){g.editor.addFilter(y(p(e)));return g.control.refreshFilter()};g.control.filterWithSignal=function(e){g.editor.addFilter(p(e),e.defaultSignalName);return g.control.refreshFilter()};g.control.filter=function(t,n){e.$broadcast("events:filtered",t);n&&g.layout.selectView(n)};g.control.loadQuery=function(t,n){n&&g.layout.selectView(n);e.$broadcast("events:queryLoaded",t)};g.control.filterBoxChanged=function(t){e.$broadcast("events:filterBoxChanged",t)};g.control.setFromUtc=function(t){e.$broadcast("events:fromUtcSet",t)};g.control.addToDash=function(e){if(g.editor.dirty)return u.confirm("Changes to the current signal must be saved before a dashboard chart can be added. Save now?").then(function(t){t&&g.editor.save().then(function(){return g.control.addToDash(e)})});var n;n=g.layout.query?s.api.dashboards.queryToChartQuery(g.slice.query).then(function(e){return{measurements:e.Measurements,where:e.Where,groupBy:e.GroupBy,in:g.slice.signal.toString(),view:g.slice.view}}):s.api.expressions.fuzzyToSql(g.slice.filter).then(function(e){return{measurements:[{Value:"count(*)",Label:"count"}],where:e.Expression,in:g.slice.signal.toString()}});return n.then(function(n){Seq.log("events.control","calculated chart description",n);r.url("/dashboards").search("dashboardId",e.Id).search("add",t.JSON.stringify(n))})};g.control.exportCsv=function(){if(g.dataSet){d.success("Export started");return g.dataSet.export().then(function(e){f.get(e.Links.Render)})}var e=null===g.slice.fromUtc?"This will download all matching events from 24 hours ago to the range end. Continue the export?":"This will download all matching events in the selected date range. Continue the export?";return u.confirm(e).then(function(e){if(e){d.success("Export started");return g.control.refreshFilter().then(function(){return g.eventSet.loadTable(!0,g.slice.fromUtc,g.slice.toUtc).then(function(e){f.get(e.Links.Render)})})}})};g.control.cancelDeletion=function(){g.slice.deletionEnabled=!1};g.control.deleteMatching=function(){return u.confirm("Delete all matching events, including bookmarks? Deletion runs in the background and may take some time.").then(function(){g.eventSet.deleteMatching().then(function(e){d.success("Success; "+e.DeletedEventCount.toString()+" events deleted")},function(){d.error("Event deletion failed")});d.success("Event deletion started")})};g.control.refreshQuery=function(){g.slice.autorefresh=!1;g.layout.query=!0;h();g.filters.pushHistory(g.slice.query);return g.refreshing.until(g.editor.current().then(function(e){g.control.lastParseResult=null;var t={signalExpression:g.slice.signal,signal:e,query:g.slice.query,fromUtc:g.slice.fromUtc,toUtc:g.slice.toUtc};g.dataSet=new Seq.DataSet(i,s.api,t,a,g.timeoutMS);return g.dataSet.load()}))};g.layout.query?g.control.refreshQuery():g.slice.autorefresh?g.control.autorefresh():g.control.refreshFilter();s.api.appInstances.list().then(function(e){g.control.appInstances=e.map(function(e){return new Seq.AppInstance({entity:e})}).filter(function(e){return!e.disallowManualInput})})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){new Seq.Router(e,"events").when("/events",{controller:"EventsController",templateUrl:"events.tpl.html",reloadOnSearch:!1})}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("LoginController",["$scope","$location","seq","busy","$routeParams","$q",function(n,e,r,o,s,a){var t=n.login={credentials:{Username:"",Password:"",NewPassword:""},settings:r.settings,loggingIn:o.create("log in"),providerError:s.error,providerErrorDescription:s.description,changingPassword:!1,newPasswordRepeat:""};t.go=function(){t.loggingIn.until(r.api.users.login(t.credentials).then(function(n){return r.api.licenses.getCurrent().then(function(o){r.onLogin(n,o);e.path("/events")})},function(n){if(t.changingPassword||!n||!n.data||!n.data.MustChangePassword)return a.reject(n);t.changingPassword=!0}))};t.cancel=function(){t.credentials.newPassword="";t.newPasswordRepeat="";t.changingPassword=!1}}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){new Seq.Router(e).when("/login",{controller:"LoginController",templateUrl:"login.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){e.when("/settings",{redirectTo:"/settings/api-keys"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){var r=new Seq.Router(e,"user");r.when("/user/account",{controller:"UserAccountController",templateUrl:"user_account.tpl.html",controllerAs:"userAccount"});r.when("/user/permalinks",{controller:"UserPermalinksController",templateUrl:"user_permalinks.tpl.html",controllerAs:"userPermalinks"});r.when("/user/preferences",{controller:"UserPreferencesController",templateUrl:"user_preferences.tpl.html",controllerAs:"userPreferences"})}]);
"use strict";!function(){function t(t){this.parts=r(t||"00:00")}var r=function t(r){var s=r.split(".");if(1===s.length){var a=s[0].split(":");return{days:0,hours:parseInt(a[0],10),minutes:a.length>1?parseInt(a[1],10):0}}if(2===s.length||3===s.length){if(1!==s[0].split(":").length){var n=t(s[0]);n.days=0;return n}var u=t(s[1]);u.days=parseInt(s[0],10);return u}return{days:0,hours:0,minutes:0}};t.prototype.isZero=function(){var t=this;return!(t.parts.minutes||t.parts.hours||t.parts.days)};t.prototype.friendly=function(){var t=this;if(!t.parts.hours&&!t.parts.days&&!t.parts.minutes)return"0 days";var r="";t.parts.days&&0!==t.parts.days&&(1===t.parts.days?r+="1 day":r+=t.parts.days.toString()+" days");if(t.parts.hours&&0!==t.parts.hours){""!==r&&(r+=" ");1===t.parts.hours?r+="1 hour":r+=t.parts.hours.toString()+" hours"}if(t.parts.minutes&&0!==t.parts.minutes){""!==r&&(r+=" ");1===t.parts.minutes?r+="1 minute":r+=t.parts.minutes.toString()+" minutes"}return r};t.prototype.normalize=function(){var r=this;var s=new t;r.parts.days&&(s.parts.days=r.parts.days);if(r.parts.hours)if(r.parts.hours>23){var a=r.parts.hours%24;var n=(r.parts.hours-a)/24;s.parts.days+=n;s.parts.hours=a}else s.parts.hours=r.parts.hours;if(r.parts.minutes)if(r.parts.minutes>59){var u=r.parts.minutes%60;var i=(r.parts.minutes-u)/60;s.parts.hours+=i;s.parts.minutes=u}else s.parts.minutes=r.parts.minutes;return s};t.prototype.format=function(){var t=this.normalize();return(t.parts.days||0).toString()+"."+(t.parts.hours||0).toString()+":"+(t.parts.minutes||0).toString()+":00"};t.prototype.totalMinutes=function(){var t=this;return 60*(24*(t.parts.days||0)+(t.parts.hours||0))+(t.parts.minutes||0)};t.prototype.totalSeconds=function(){return 60*this.totalMinutes()};Seq.Duration=t}();
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var a=0;a<n.length;a++){var t=n[a];t.enumerable=t.enumerable||!1;t.configurable=!0;"value"in t&&(t.writable=!0);Object.defineProperty(e,t.key,t)}}return function(n,a,t){a&&e(n.prototype,a);t&&e(n,t);return n}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"whenLoaded",value:function(e,n){WebFont.load({custom:{families:[e.family],urls:[e.url]},classes:!1,fontactive:n})}}]);return e}();Seq.FontLoader=e}();
"use strict";!function(){var o={Primary:{family:"Roboto",url:"font/roboto-regular-400.woff2"},Monospace:{family:"Roboto Mono",url:"font/roboto-mono-regular-400.woff2"}};Seq.Fonts=o}();
"use strict";!function(e){!function(e){e.defineMode("seq",function(t,r){function n(e,t){var r=e.next();if(x[r]){var n=x[r](e,t);if(!1!==n){t.preregex=!1;return n}}if(1==f.hexNumber&&"0"==r&&e.match(/^[xX][0-9a-fA-F]+/)){t.preregex=!1;return"number"}if(r.charCodeAt(0)>47&&r.charCodeAt(0)<58&&e.match(/^[0-9]*(d|h|m|s|ms|us|ns)/)){t.preregex=!1;return"number"}if(r.charCodeAt(0)>47&&r.charCodeAt(0)<58&&e.match(/^[0-9]*(\.[0-9]+)?/)){t.preregex=!1;return"number"}if("$"==r&&f.eventType&&e.match(/^[0-9a-fA-F]{1,8}/)){t.preregex=!1;return"eventtype"}if("?"==r&&(e.eatSpace()||e.eol())){t.preregex=!1;return"variable-3"}if('"'==r&&f.doubleQuote||"/"==r&&f.regex&&t.preregex){t.tokenize=o(r);var u=t.tokenize(e,t);t.preregex=!1;return u}if('"'!=r||f.doubleQuote){if("'"==r){t.tokenize=i(r);var a=t.tokenize(e,t);t.preregex=!1;return a}if(/^[\(,\[]/.test(r)){t.preregex=!0;return null}if(/^[\)\]]/.test(r)){t.preregex=!1;return null}if(p.test(r)){e.eatWhile(p);t.preregex=!0;return null}e.eatWhile(/^[_\w\d&|!=]/);var g=e.current().toLowerCase();if(s.hasOwnProperty(g)){t.preregex=!1;return"atom"}if(l.hasOwnProperty(g)){t.preregex=!1;return"builtin"}if(c.hasOwnProperty(g)){t.preregex=!0;return"keyword"}if(d.hasOwnProperty(g)){t.preregex=!0;return"unsupported"}t.preregex=!0;return null}t.tokenize=o(r,"unsupported");var m=t.tokenize(e,t);t.preregex=!1;return m}function o(e,t){return function(r,o){var i=!1,u=void 0;for(;null!=(u=r.next());){if(u==e&&!i){o.tokenize=n;break}i=!i&&"\\"==u}return t||"string"}}function i(e){return function(t,r){var o=void 0;for(;null!=(o=t.next());)if(o==e){r.tokenize=n;break}return"string"}}function u(e,t,r){t.context={prev:t.context,indent:e.indentation(),col:e.column(),type:r}}function a(e){e.indent=e.context.indent;e.context=e.context.prev}var s=r.atoms||{false:!0,true:!0,null:!0},l=r.builtin||{},c=r.keywords||{},p=r.operatorChars||/^[*+\-%<>!=&|~^]/,f=r.support||{},x=r.hooks||{},d=r.unsupported||{};return{startState:function(){return{tokenize:n,context:null,preregex:!0}},token:function(e,t){e.sol()&&t.context&&null==t.context.align&&(t.context.align=!1);if(e.eatSpace())return null;var r=t.tokenize(e,t);if("comment"==r)return r;t.context&&null==t.context.align&&(t.context.align=!0);var n=e.current();"("==n?u(e,t,")"):"["==n?u(e,t,"]"):t.context&&t.context.type==n&&a(t);return r},indent:function(r,n){var o=r.context;if(!o)return e.Pass;var i=n.charAt(0)==o.type;return o.align?o.col+(i?0:1):o.indent+(i?0:t.indentUnit)}}});!function(){function t(e){return e.match(/^[0-9a-zA-Z$\.\_]+/)?"variable-2":null}function r(e){var t={},r=e.split(" ");for(var n=0;n<r.length;++n)t[r[n]]=!0;return t}var n="has contains indexof length startswith endswith substring arrived datetime typeof totalmilliseconds round toisostring tohexstring tonumber totimestring timespan timeofday toeventtype now";e.defineMIME("text/x-seq-filter",{name:"seq",keywords:r("and coalesce is like not or in"),builtin:r(n),atoms:r("false true null"),operatorChars:/^[*+\-%<>!=&|\^]/,support:r("doubleQuote hexNumber regex eventType"),hooks:{"@":t}});e.defineMIME("text/x-seq-sql",{name:"seq",keywords:r("and as asc bottom by coalesce count desc distinct first from group having is last like max mean min not or order percentile select stream sum time top where limit for in"),builtin:r(n),atoms:r("false true null"),operatorChars:/^[*+\-%<>\^]/,unsupported:r("== != && ||"),support:r("hexNumber regex"),hooks:{"@":t}})}()}(CodeMirror)}();
"use strict";!function(){function t(t){var n=this;n.$timeout=t;n.batch=null}t.prototype.onNextTick=function(t){var n=this;if(null===n.batch){n.batch=[];n.$timeout(function(){var t=n.batch;n.batch=null;_.each(t,function(t){t()})})}n.batch.push(t)};Seq.AnimationBatch=t}();
"use strict";var _module=angular.module("seq-ui2");_module.directive("datepickerCalendar",["$window",function(e){var t=e.Pikaday;return{restrict:"E",replace:!0,templateUrl:"datepicker_calendar.tpl.html",scope:{isVisible:"=",current:"=",select:"&",startOfWeek:"=",utc:"="},link:function(e,r){var n=e.datepickerCalendar={};var a=r[0].querySelector(".container");var o=function(t){if(e.utc){var r=moment(t).utc();return new Date(r.year(),r.month(),r.date(),r.hour(),r.minute(),r.second(),r.millisecond())}return t};var l=function(t){return e.utc?new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getMilliseconds())):t};var c=function(){return o(new Date)};var i=new t({container:a,bound:!1,firstDay:e.startOfWeek,yearRange:[2010,2030],field:r[0].querySelector(".invisible"),format:Seq.TimePreferences.fullDateTimeFormat,now:c,onSelect:function(){e.$apply(function(){e.select({$date:l(i.getMoment().toDate())})})}});i.show();n.loadFromModel=function(){if(null===e.current){i.setDate(null,!0);i.gotoToday()}else{i.setDate(o(e.current),!0);i.gotoDate(o(e.current))}};n.selectNow=function(){var t=new Date;i.setDate(o(t),!0);i.gotoDate(o(t));e.select({$date:t})};n.loadFromModel();e.$watch("current",function(){n.loadFromModel()})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("actionItem",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<li><a href="" ng-click="actionItem.selected()" ng-class="{\'disabled\': disabled}" ng-transclude></a></li>',scope:{action:"&",disabled:"="},link:function(e){(e.actionItem={}).selected=function(){!e.disabled&&e.action&&e.action()}}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("dividerItem",function(){return{restrict:"E",replace:!0,templateUrl:"divider_item.tpl.html"}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("linkItem",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<li><a ng-href="{{link}}" ng-transclude></a></li>',scope:{link:"@"}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("confirmDialog",["$q","messageBox",function(e,i){return{restrict:"E",replace:!0,templateUrl:"confirm_dialog.tpl.html",scope:{},link:function(l){var r=null;var n=l.confirmDialog={isVisible:!1,message:null};n.ok=function(){n.isVisible=!1;r.resolve("OK");r=null};n.cancel=function(){n.isVisible=!1;r.reject("Cancel");r=null};var o=function(i){if(null!==r)throw new Error("Confirm already in progress");n.isVisible=!0;n.message=i;r=e.defer();return r.promise};i.connectConfirm(o)}}}]);
"use strict";!function(){function e(){var e=this;e.listeners=[];e.messages=[]}e.prototype.listen=function(e){this.listeners.push(e)};e.prototype.notify=function(){var e=this;_.each(e.listeners,function(s){s(e.messages)})};e.prototype.add=function(e){var s=this;s.messages.splice(0,0,e);s.notify();return function(){s.messages.splice(s.listeners.indexOf(e),1);s.notify()}};e.prototype.success=function(e){var s=this;var t={message:e,level:"SUCCESS"};return s.add(t)};e.prototype.error=function(e){var s=this;var t={message:e,level:"ERROR"};return s.add(t)};Seq.Toaster=e}();
"use strict";var _module=angular.module("seq-ui2");_module.directive("toasterBlind",["toast",function(e){return{restrict:"E",replace:!0,templateUrl:"toaster_blind.tpl.html",link:{pre:function(l){var t=l.toasterBlind={show:!1,level:null,message:null};e.listen(function(e){if(0===e.length)t.show=!1;else{var l=e[0];t.show=!0;t.message=l.message;t.level=l.level.toLowerCase()}})}}}}]);
"use strict";!function(){function t(){var t=this;t.roots={};t.minItemLength=2;t.maxItemLength=40;t.count=0;t.validChar=/[ A-z0-9_(@]/}t.prototype.isValidItem=function(t){var r=this;if("string"!=typeof t)throw new Error("Completion source items must be strings");return t.length>=r.minItemLength&&t.length<r.maxItemLength};t.prototype.add=function(t,r){var e=this;r=r||Seq.Syntax.FILTER;if(e.isValidItem(t)){var n=e.roots;for(var i=0;i<t.length;++i){var a=t[i];if(!a.match(e.validChar))return;n=n.hasOwnProperty(a)?n[a]:n[a]={isItem:!1}}n.isItem||e.count++;n.isItem=!0;n.syntax&&n.syntax===Seq.Syntax.FILTER||(n.syntax=r)}};t.prototype.contains=function(t){var r=this;if(!r.isValidItem(t))return!1;var e=r.roots;for(var n=0;n<t.length;++n){var i=t[n];if(!e.hasOwnProperty(i))return!1;e=e[i]}return e.isItem};t.prototype.fromPrefix=function(t,r){var e=this;if("string"!=typeof t)throw new Error("Prefixes must be strings");r=r||{};var n=r.syntax||Seq.Syntax.FILTER;var i=r.max||30;var a=[];e.itemsDepthFirstInOrder(a,0,"",e.roots,t,i,n);return a};t.prototype.checkBranch=function(t,r,e,n,i,a,o,s){var h=this;if(i.hasOwnProperty(t)){var u=i[t];var f=n+t;if(u.isItem&&Seq.Syntax.isCompatible(u.syntax,s)){r.push(f);if(r.length===o)return!0}if(h.itemsDepthFirstInOrder(r,e+1,f,u,a,o,s))return!0}return!1};t.prototype.itemsDepthFirstInOrder=function(t,r,e,n,i,a,o){var s=this;if(r<i.length){var h=i[r];if(s.checkBranch(h,t,r,e,n,i,a,o))return!0;var u=h===h.toLowerCase()?h.toUpperCase():h.toLowerCase();if(u!==h&&s.checkBranch(u,t,r,e,n,i,a,o))return!0}else{var f=_.chain(n).keys().without("isItem").sort().value();for(var m=0;m<f.length;m++){var c=f[m];if(s.checkBranch(c,t,r,e,n,i,a,o))return!0}}return!1};Seq.CompletionSource=t}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(t,a.key,a)}}return function(e,i,a){i&&t(e.prototype,i);a&&t(e,a);return e}}();var _module=angular.module("seq-ui2");_module.directive("alertEditorDialog",["session","busy",function(t,e){var i=function(){function i(){_classCallCheck(this,i);this.changed=!1;this.alertData={};this.appInstances=[];this.userIsAdmin=!1;this.loading=e.create("load app instances")}_createClass(i,[{key:"link",value:function(t){var e=this;t.$watch("alertEditorDialog.isVisible",function(t,i){t&&!i&&e.prepareToOpen()})}},{key:"dataChanged",value:function(){this.changed=!0}},{key:"prepareToOpen",value:function(){this.changed=!1;this.query=this.alert.query;this.alertData={Condition:this.alert.alert.Condition,MeasurementWindow:this.alert.alert.MeasurementWindow,SuppressionTime:this.alert.alert.SuppressionTime,Level:this.alert.alert.Level,NotificationAppInstanceId:this.alert.alert.NotificationAppInstanceId,NotificationAppSettingOverrides:this.alert.alert.NotificationAppSettingOverrides||{}};return this.loading.until(this.refreshReferenceData())}},{key:"refreshReferenceData",value:function(){var e=this;return t.then(function(t){e.userIsAdmin=t.user.IsAdministrator;return t.api.appInstances.list().then(function(t){return t.map(function(t){return new Seq.AppInstance({entity:t})})}).then(function(t){e.appInstances=t.filter(function(t){return e.userIsAdmin||!t.disallowManualInput})})})}},{key:"close",value:function(){this.isVisible=!1}},{key:"cancel",value:function(){this.isNew?this.remove():this.close()}},{key:"remove",value:function(){this.alert.remove();this.close();this.onChange()}},{key:"update",value:function(){if(this.changed)if(""!==this.alert.alert.Condition.trim()||""!==this.alertData.Condition){this.alert.alert.Condition=this.alertData.Condition;this.alert.alert.MeasurementWindow=this.alertData.MeasurementWindow;this.alert.alert.SuppressionTime=this.alertData.SuppressionTime;this.alert.alert.Level=this.alertData.Level;this.alert.alert.NotificationAppInstanceId=this.alertData.NotificationAppInstanceId;this.alert.alert.NotificationAppSettingOverrides=this.alertData.NotificationAppSettingOverrides;this.alert.isDirty();this.close();this.onChange()}else{this.remove();this.onChange()}else this.close()}},{key:"canUpdate",get:function(){return this.changed&&this.alertData.NotificationAppInstanceId&&""!==this.alertData.Condition.trim()}}]);return i}();return Seq.component("alertEditorDialog",i,{alert:"=",isVisible:"=",isNew:"=",onChange:"&"})}]);
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();var _module=angular.module("seq-ui2");_module.directive("chart",["$document","plotly","$timeout","session","$q","dashboardFetchQueue","$location",function(e,t,r,n,a,i,o){var l=0;var s=function(){function s(){_classCallCheck(this,s);this.isDrawing=!1;this.editing=!1;this.refreshing=new Seq.Busy(a,"fetch chart data");this.errorReasons=[];this.plotlyMountElementId="chartMount"+l++;this.lastResults=null;this.lastRange=null;this.overlay=null;this.showPlot=!0;this.names=null;this.traceNameTooltip=null;i.addListener(this)}_createClass(s,[{key:"link",value:function(e){var t=this;e.$on("seq:relayout",function(e,r){return t.updateLayout(r)});e.$on("seq:chart-editing",function(e,r){return t.onDashboardChartEditing(r)});e.$on("$destroy",function(){return i.removeListener(t)});null===this.model.chart.Id&&(this.editing=!0)}},{key:"tryGetChartDimensions",value:function(){var t=e[0].getElementById(this.plotlyMountElementId);return t?{width:t.offsetWidth,height:160+195*(this.model.chart.DisplayStyle.HeightRows-1)}:null}},{key:"toggleEditor",value:function(){this.editing=!this.editing;this.editing&&this.onEditing({$chart:this.model})}},{key:"onDashboardChartEditing",value:function(e){e!==this.model&&(this.editing=!1)}},{key:"updateLayout",value:function(){var e=this;var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Seq.ChartRefresh.None;Seq.log("ChartController","updating layout",n,this.lastResults);n!==Seq.ChartRefresh.Query?n!==Seq.ChartRefresh.Render||null===this.lastResults?r(function(){var r=e.tryGetChartDimensions();if(r)try{t.relayout(e.plotlyMountElementId,r)}catch(e){Seq.log("ChartController","layout failure",e)}}):this.render(this.lastResults.getTraces()):i.forceRefresh(this)}},{key:"pointsClicked",value:function(e){var t=new Seq.ChartPoint(e);var r=t.findTag();if(r){var n=this.model.queries[r.queryIndex];if(n&&!n.isEmpty()){o.url("/events");var a=new Seq.StreamSlice(o);a.preserveHistory();t.setPointQuery(a,n,r)}}}},{key:"isInSync",value:function(){return null!==this.lastRange&i.isCurrent(this.lastRange)}},{key:"requestData",value:function(e){var t=this;return n.then(function(r){if(void 0===t.model)return function(){};var n=1e3*parseInt(r.user.Preferences.QueryTimeoutSeconds||"60",10);var i=new Seq.TraceBuilder(e);var o=[];t.model.queries.forEach(function(a){if(!a.isEmpty()){var l=t.validateQuery(a).then(function(){var o={q:a.toSql(e.timeGrouping,e.rangeStartUtc,e.rangeEndUtc),signal:a.fullSignalExpression().toString(),timeoutMS:n};Seq.log("ChartController","executing query",o.q);return r.api.data.query(o).then(function(r){i.addResultSet(a.requiresLegend(),r,function(){var r=t.model;var n=r.getFirstQuery();return s.computeDisplayStyles(r,n,e)})})});o.push(l)}});t.errorReasons=[];var l=a.all(o).then(function(){var r=i.getTraces();return function(){t.lastResults=i;t.lastRange=e;t.render(r)}}).catch(function(e){t.errorReasons=(e.data||{}).Reasons;return a.reject(e)});return t.refreshing.until(l)}).catch(function(){return function(){}})}},{key:"validateQuery",value:function(e){try{e.validate();return a.resolve()}catch(e){return a.reject(e)}}},{key:"render",value:function(n){var a=this;this.isDrawing=!0;r(function(){var i=a.tryGetChartDimensions();if(i){a.overlay=n.overlay;a.showPlot=n.showPlot;if(n.showPlot){a.names=n.names;var o=a.computeLayout(i,n);t.newPlot(a.plotlyMountElementId,n.traces,o,{displayModeBar:!1});a.isDrawing=!1;var l=e[0].getElementById(a.plotlyMountElementId);l.on("plotly_click",function(e){r(function(){a.pointsClicked(e.points)})});l.on("plotly_afterplot",function(){var e=l.querySelector("g.legend");if(e){var t=e.querySelectorAll("g.traces");if(0!==t.length){e.querySelectorAll(".tooltip").forEach(function(e){return e.parent.removeChild(e)});t.forEach(function(e){var t=e.__data__[0].trace;var n=e.__data__[0].i;var i=e.__data__[0].label;if(t){e.addEventListener("mouseover",function(){var e=n||t.index;var o=i||t.name;e<a.names.length&&a.names[e]!==o&&r(function(){a.traceNameTooltip=a.names[e]})});e.addEventListener("mouseout",function(){r(function(){a.traceNameTooltip=null})})}})}}});a.updateLayout()}else a.isDrawing=!1}})}},{key:"computeLayout",value:function(e,t){var r=t.showAxis?{xaxis:{fixedrange:!0,type:"date",range:t.range.x,autorange:!1,tickfont:Seq.Fonts.Primary},yaxis:{fixedrange:!0,range:t.range.y,tickfont:Seq.Fonts.Primary,rangemode:"tozero"}}:{};var n=t.alertThresholds.reduce(function(e,r){var n=r.value;r.trigger===Seq.AlertTrigger.Above&&(n=t.range.y[1]);r.trigger===Seq.AlertTrigger.Below&&(n=0);var a={type:"rect",xref:"paper",yref:"y",x0:"0",x1:1,y0:n,y1:r.value,fillcolor:"rgb(222, 179, 179)",opacity:.2,line:{width:0}};var i={type:"line",xref:"paper",yref:"y",x0:"0",x1:1,y0:r.value,y1:r.value,line:{width:1,color:"rgb(222, 211, 211)"}};return[].concat(_toConsumableArray(e),[a,i])},[]);return _extends({width:e.width,height:e.height,margin:{t:5,l:40,r:40,b:t.isPie?20:40},showlegend:t.requiresLegend,legend:{font:Seq.Fonts.Primary},shapes:n},r,{font:Seq.Fonts.Primary})}},{key:"showAlertsEditor",value:function(){this.editing=!0}}],[{key:"computeDisplayStyles",value:function(e,t,r){Seq.log("ChartController","computing display styles",t,r);var n=t.chartQuery.DisplayStyle;return{type:n.Type,mode:n.Type===Seq.ChartType.Point?"markers":n.LineShowMarkers?"lines+markers":"lines",fillToZeroY:n.Type===Seq.ChartType.Line&&n.LineFillToZeroY,palette:n.Palette,overlaySum:n.Type===Seq.ChartType.Bar&&n.BarOverlaySum,tag:{queryIndex:e.queries.indexOf(t),rangeData:r},valueOnly:n.Type===Seq.ChartType.Value,alertThresholds:t.alertThresholds()}}}]);return s}();return Seq.component("chart",s,{model:"=",layoutClass:"@",onEditing:"&"})}]);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,i,n){i&&e(t.prototype,i);n&&e(t,n);return t}}();var _module=angular.module("seq-ui2");_module.directive("chartEditor",["$window",function(e){var t=function(){function t(){_classCallCheck(this,t);this.model=null;this.queryModel=null;this.activeTab=null;this.tabs=[{title:"Signal",id:"signal",isActive:!1},{title:"Query",id:"query",isActive:!1},{title:"SQL",id:"sql",isActive:!1},{title:"Style",id:"style",isActive:!1},{title:"Alerts",id:"alerts",isActive:!1},{title:"Position",id:"actions",isActive:!1}];this.activate(this.tabs[0])}_createClass(t,[{key:"link",value:function(e){var t=this;e.$watch("chartEditor.model",function(){null!==t.model&&(t.queryModel=t.model.getFirstQuery())})}},{key:"activate",value:function(e){null!==this.activeTab&&(this.activeTab.isActive=!1);this.activeTab=e;e.isActive=!0}},{key:"isActive",value:function(e){return null!==this.activeTab&&this.activeTab.id===e}},{key:"changed",value:function(){this.model.isDirty();Seq.log("ChartEditorController","changed",this.model)}},{key:"layoutChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Seq.ChartRefresh.Render;this.changed();this.updateLayout({refresh:e})}},{key:"remove",value:function(){this.model.remove()}},{key:"move",value:function(e){this.model.move(e)}},{key:"duplicate",value:function(){this.model.duplicate(e.JSON)}},{key:"exampleSql",value:function(){if(this.queryModel&&!this.queryModel.isEmpty()){var e=this.currentRange&&this.currentRange.timeGrouping?this.currentRange.timeGrouping:"$time";return this.queryModel.toSql(e)}return null}},{key:"openInEventsURI",value:function(){return this.queryModel&&this.currentRange?"#/events?q="+encodeURIComponent(this.exampleSql())+"&from="+this.currentRange.rangeStartUtc.toISOString()+"&to="+this.currentRange.rangeEndUtc.toISOString()+"&signal="+this.queryModel.fullSignalExpression().toString()+"&view=table":"#"}}]);return t}();return Seq.component("chartEditor",t,{model:"=",updateLayout:"&",currentRange:"="})}]);
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,r){var t=[];var n=!0;var i=!1;var a=void 0;try{for(var l,o=e[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){t.push(l.value);if(r&&t.length===r)break}}catch(e){i=!0;a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(r,t,n){t&&e(r.prototype,t);n&&e(r,n);return r}}();!function(){var e=1;var r=/^([\S]+){1}[\s]*(<=|>=|<|>){1}[\s]*([\S]+){1}/;var t=function(){function t(r,n){_classCallCheck(this,t);this.alert=r;this.query=n;this.sequenceNumber=e++}_createClass(t,[{key:"describe",value:function(){return null===this.alert.Condition||""===this.alert.Condition.trim()?"":this.alert.Condition.trim()+" in "+new Seq.Duration(this.alert.MeasurementWindow).friendly()}},{key:"threshold",value:function(){if(null===this.alert.Condition||""===this.alert.Condition.trim())return null;var e=r.exec(this.alert.Condition);if(null===e)return null;var t=e.slice(1),n=_slicedToArray(t,3),i=(n[0],n[1]),a=n[2];var l=Number.parseFloat(a);return isNaN(l)?null:{trigger:{"<":Seq.AlertTrigger.Below,"<=":Seq.AlertTrigger.Below,">":Seq.AlertTrigger.Above,">=":Seq.AlertTrigger.Above}[i],window:new Seq.Duration(this.alert.MeasurementWindow),value:l}}},{key:"isDirty",value:function(){this.query.isDirty()}},{key:"remove",value:function(){this.query.removeAlert(this)}},{key:"isActive",value:function(){return null!==this.alert.Id}}],[{key:"createNew",value:function(e){return new t({Id:null,Condition:"",MeasurementWindow:"00:01:00",StabilizationWindow:"00:00:30",SuppressionTime:"00:00:00",Level:"Warning"},e)}}]);return t}();Seq.AlertModel=t}();
"use strict";!function(){var e={Above:"Above",Below:"Below"};Seq.AlertTrigger=e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,r,i){r&&e(t.prototype,r);i&&e(t,i);return t}}();!function(){var e=1;var t=function(){function t(r,i){var n=this;_classCallCheck(this,t);this.chart=r;this.dashboard=i;this.queries=_(r.Queries).map(function(e){return new Seq.ChartQueryModel(e,n)});this.sequenceNumber=e++}_createClass(t,[{key:"fullSignalExpression",value:function(){return Seq.SignalExpression.fromAPIType(this.chart.SignalExpression).intersect(this.dashboard.fullSignalExpression())}},{key:"updateTitle",value:function(e){if(e!==this.dashboard.Title){this.chart.Title=e;this.isDirty()}}},{key:"isDirty",value:function(){this.dashboard.isDirty()}},{key:"getFirstQuery",value:function(){0===this.queries.length&&this.addQuery();return this.queries[0]}},{key:"addQuery",value:function(){var e=Seq.ChartQueryModel.createNew(this);this.chart.Queries.push(e.chartQuery);this.queries.push(e);this.dashboard.isDirty()}},{key:"remove",value:function(){this.dashboard.removeChart(this)}},{key:"move",value:function(e){this.dashboard.moveChart(this,e)}},{key:"duplicate",value:function(e){var t=this.clone(e);this.dashboard.insertAfter(this,t)}},{key:"clone",value:function(e){var r=e.parse(e.stringify(this.chart));r.Title=r.Title+" (clone)";r.Id=null;_.each(r.Queries,function(e){e.Id=null;_.each(e.Alerts,function(e){e.Id=null})});return new t(r,this.dashboard)}},{key:"hasActiveAlerts",value:function(){return _.any(this.queries,function(e){return _.any(e.alerts,function(e){return e.isActive()})})}}],[{key:"createNew",value:function(e){var r={Id:null,Title:null,SignalExpression:null,Queries:[],DisplayStyle:{WidthColumns:6,HeightRows:1}};var i=new t(r,e);i.addQuery();return i}}]);return t}();Seq.ChartModel=t}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();!function(){var e=function(){function e(t,r){var n=this;_classCallCheck(this,e);this.chartQuery=t;this.chart=r;this.alerts=t.Alerts.map(function(e){return new Seq.AlertModel(e,n)})}_createClass(e,[{key:"addAlert",value:function(){var e=Seq.AlertModel.createNew(this);this.chartQuery.Alerts.push(e.alert);this.alerts.push(e);this.chart.isDirty();return e}},{key:"requiresLegend",value:function(){Seq.log("ChartQueryModel","determining legend requirement",this);return null!==this.chartQuery.Measurements&&this.chartQuery.Measurements.length>1||null!==this.chartQuery.GroupBy&&this.chartQuery.GroupBy.length>0}},{key:"alertThresholds",value:function(){return this.alerts.map(function(e){return e.threshold()}).filter(function(e){return null!==e})}},{key:"fullSignalExpression",value:function(){return Seq.SignalExpression.fromAPIType(this.chartQuery.SignalExpression).intersect(this.chart.fullSignalExpression())}},{key:"nonEmptyTerms",value:function(e){return _(e).filter(function(e){return null!==e&&0!==e.trim().length})}},{key:"nonEmptyMeasurements",value:function(e){return _.filter(e,function(e){return null!==e.Value&&""!==e.Value.trim()})}},{key:"isEmpty",value:function(){return 0===this.nonEmptyMeasurements(this.chartQuery.Measurements).length}},{key:"toSql",value:function(e,t,r){if(this.isEmpty())throw new Error("The measurement does not contain any select items.");var n=new Seq.QueryBuilder;this.nonEmptyMeasurements(this.chartQuery.Measurements).forEach(function(e){var t=e.Value;null!==e.Label&&""!==e.Label.trim()&&(t+=" as "+e.Label);n.select(t)});n.fromStream(!0);if(void 0!==t){n.where("@Timestamp >= DateTime('"+t.toISOString()+"')");n.where("@Timestamp < DateTime('"+r.toISOString()+"')")}null!==this.chartQuery.Where&&""!==this.chartQuery.Where.trim()&&n.where(this.chartQuery.Where);null!==this.chartQuery.GroupBy&&this.nonEmptyTerms(this.chartQuery.GroupBy).length>0&&n.groupBy(this.nonEmptyTerms(this.chartQuery.GroupBy));void 0!==e&&(Seq.ChartData.isRowset(this.type)?void 0!==t&&n.for("window("+e+")"):n.groupBy("time("+e+")"));n.limit(Seq.ChartData.limit(this.type,1e4));return n.toSql()}},{key:"isDirty",value:function(){this.chart.isDirty()}},{key:"removeAlert",value:function(e){var t=this.alerts.indexOf(e);if(-1!==t){this.alerts.splice(t,1);this.chartQuery.Alerts.splice(t,1);this.isDirty()}}},{key:"validate",value:function(){if(this.type===Seq.ChartType.Pie&&1!==this.chartQuery.GroupBy.length)throw new Error("To plot a pie chart, the query must have one `group by` clause.")}},{key:"type",get:function(){return this.chartQuery.DisplayStyle.Type}}],[{key:"createNew",value:function(e){var t={Id:null,Measurements:[{Value:"count(*)",Label:"count"}],Alerts:[],Where:null,SignalExpression:null,GroupBy:[],DisplayStyle:{Type:Seq.ChartType.Line,LineFillToZeroY:!1,LineShowMarkers:!0,Palette:"Default"}};return new Seq.ChartQueryModel(t,e)}}]);return e}();Seq.ChartQueryModel=e}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,r,t){r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t;return e}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(r,t,n){t&&e(r.prototype,t);n&&e(r,n);return r}}();!function(){var e;var r={Bar:"Bar",Line:"Line",Point:"Point",Pie:"Pie",Value:"Value"};var t={plotlyTypes:(e={},_defineProperty(e,r.Bar,"bar"),_defineProperty(e,r.Pie,"pie"),e),rowsetTypes:[r.Pie,r.Value],dataViewTypes:{pie:r.Pie},limits:_defineProperty({},r.Value,1)};var n=function(){function e(){_classCallCheck(this,e)}_createClass(e,null,[{key:"plotlyType",value:function(e,r){return t.plotlyTypes[e]||r}},{key:"chartTypeFromDataViewType",value:function(e,r){return t.dataViewTypes[e]||r}},{key:"limit",value:function(e,r){return t.limits[e]||r}},{key:"isRowset",value:function(e){return t.rowsetTypes.includes(e)}},{key:"isSeries",value:function(e){return Object.keys(r).includes(e)&&!Chart.isRowset(e)}}]);return e}();Seq.ChartType=r;Seq.ChartData=n}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();!function(){var e=function(){function e(t,n){var i=this;_classCallCheck(this,e);this.$q=t;this.fetching=new Seq.Busy(t,"fetch dashboard data");this.generation=0;this.rangeData=null;this.listeners=[];this.offscreen={isVisible:!0,requestedRange:null,lastInvalidate:null};n.$on("seq:visibility-change",function(e,t){return i.onVisibilityChange(t)})}_createClass(e,[{key:"onVisibilityChange",value:function(e){if(this.offscreen.isVisible!==e)if(e){Seq.log("DashboardFetchQueue","became visible");if(null!==this.offscreen.requestedRange){Seq.log("DashboardFetchQueue","range was requested off-screen; invalidating");this.invalidate(this.offscreen.requestedRange,!0)}this.offscreen.isVisible=!0;this.offscreen.requestedRange=null}else{Seq.log("DashboardFetchQueue","became invisible");this.offscreen.isVisible=!1;this.offscreen.requestedRange=null}}},{key:"beginGeneration",value:function(){this.generation+=1;return this.generation}},{key:"isCurrentGeneration",value:function(e){return this.generation===e}},{key:"invalidate",value:function(e,t){var n=this;Seq.log("DashboardFetchQueue","invalidate requested",this.generation,"range",e);if(!this.offscreen.isVisible){var i=new Date;if(!t&&null!==this.offscreen.lastInvalidate&&i-this.offscreen.lastInvalidate<6e5){Seq.log("DashboardFetchQueue","skipping invalidation because page is not visible");this.offscreen.requestedRange=e;return this.$q.defer().promise}this.offscreen.requestedRange=null}Seq.log("DashboardFetchQueue","invalidating generation",this.generation,"range",e,"listeners",this.listeners.length);this.offscreen.lastInvalidate=new Date;this.rangeData=e;var a=this.beginGeneration();var s=this.$q.defer();s.resolve(0);var r=s.promise;_.each(this.listeners,function(t){r=r.then(function(){return n.requestData(t,e,a)},function(){return n.requestData(t,e,a)})});return this.fetching.until(r)}},{key:"isCurrent",value:function(e){return null!==e&&null!==this.rangeData&&this.rangeData.duration===e.duration&&this.rangeData.timeGrouping===e.timeGrouping}},{key:"requestData",value:function(e,t,n){var i=this;return e.requestData(t).then(function(e){i.isCurrentGeneration(n)?e():Seq.log("DashboardFetchQueue","abandoning data",n)})}},{key:"addListener",value:function(e){this.listeners.push(e);if(null!==this.rangeData){Seq.log("DashboardFetchQueue","syncing added listener");this.requestData(e,this.rangeData,this.generation)}}},{key:"removeListener",value:function(e){this.listeners=_.without(this.listeners,e)}},{key:"forceRefresh",value:function(e){this.removeListener(e);this.addListener(e)}}]);return e}();Seq.DashboardFetchQueue=e}();
"use strict";function _classCallCheck(a,i){if(!(a instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(i,n,e){n&&a(i.prototype,n);e&&a(i,e);return i}}();!function(){var a=function(){function a(i,n){_classCallCheck(this,a);this.$location=i;this.$window=n}_createClass(a,[{key:"dashboardId",value:function(a){if(void 0===a)return this.$location.search().dashboardId||null;this.$location.search("dashboardId",a)}},{key:"refreshInterval",value:function(a){if(void 0===a)return this.$location.search().refresh||null;this.$location.search("refresh",a)}},{key:"range",value:function(a){if(void 0===a)return this.$location.search().range||null;this.$location.search("range",a)}},{key:"group",value:function(a){if(void 0===a)return this.$location.search().group||null;this.$location.search("group",a)}},{key:"addChartParams",value:function(a){if(void 0===a){var i=this.$location.search().add;return i?this.$window.JSON.parse(i):null}a?this.$location.search("add",this.$window.JSON.stringify(a)):this.$location.search("add",null)}},{key:"maximized",value:function(a){if(void 0===a)return void 0!==this.$location.search().maximized;this.$location.search("maximized",!!a||null)}}]);return a}();Seq.DashboardLocation=a}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(t,r.key,r)}}return function(e,a,r){a&&t(e.prototype,a);r&&t(e,r);return e}}();!function(){var t=function(){function t(e){var a=this;_classCallCheck(this,t);this.dashboard=e;this.dirty=null===e.Id;this.charts=_(e.Charts).map(function(t){return new Seq.ChartModel(t,a)})}_createClass(t,[{key:"fullSignalExpression",value:function(){return Seq.SignalExpression.fromAPIType(this.dashboard.SignalExpression)}},{key:"updateTitle",value:function(t){if(t!==this.dashboard.Title){this.dashboard.Title=t;this.isDirty()}}},{key:"toggleShared",value:function(t){null===this.dashboard.OwnerId?this.dashboard.OwnerId=t.Id:this.dashboard.OwnerId=null;this.isDirty()}},{key:"isClean",value:function(){this.dirty=!1}},{key:"isDirty",value:function(){this.dirty=!0}},{key:"clone",value:function(t){var e=t.parse(t.stringify(this.dashboard));e.Title=e.Title+" (clone)";e.Id=null;e.Links={Create:"api/dashboards/"};_.each(e.Charts,function(t){t.Id=null;_.each(t.Queries,function(t){t.Id=null;_.each(t.Alerts,function(t){t.Id=null})})});Seq.log("DashboardModel","created clone",this.dashboard,e);return e}},{key:"replace",value:function(t,e){var a=this;for(var r in this.dashboard)delete this.dashboard[r];for(var i in t)this.dashboard[i]=t[i];this.charts=_(t.Charts).map(function(t){return new Seq.ChartModel(t,a)});e?this.isDirty():this.isClean()}},{key:"addChart",value:function(t){var e=Seq.ChartModel.createNew(this);if(t){e.chart.SignalExpression=Seq.SignalExpressionParser.parse(t.in).toAPIType();var a=e.getFirstQuery();a.chartQuery.Measurements=t.measurements||[];a.chartQuery.Where=void 0===t.where?null:t.where;a.chartQuery.GroupBy=t.groupBy||[];var r=Seq.ChartData.chartTypeFromDataViewType(t.view);r&&(a.chartQuery.DisplayStyle.Type=r)}this.charts.push(e);this.dashboard.Charts.push(e.chart);this.isDirty()}},{key:"removeChart",value:function(t){var e=this.charts.indexOf(t);if(-1!==e){this.charts.splice(e,1);this.dashboard.Charts.splice(e,1);this.isDirty()}}},{key:"moveChart",value:function(t,e){var a=this.charts.indexOf(t);if(-1!==a){var r=a+e;if(r>=0&&r<this.charts.length){this.charts.splice(a,1);this.dashboard.Charts.splice(a,1);this.charts.splice(r,0,t);this.dashboard.Charts.splice(r,0,t.chart);this.isDirty()}}}},{key:"insertAfter",value:function(t,e){var a=this.charts.indexOf(t);if(-1!==a){this.charts.splice(a+1,0,e);this.dashboard.Charts.splice(a+1,0,e.chart);this.isDirty()}}}]);return t}();Seq.DashboardModel=t}();
"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(n,i.key,i)}}return function(e,t,i){t&&n(e.prototype,t);i&&n(e,i);return e}}();!function(){var n=function(){function n(e,t){_classCallCheck(this,n);this.$interval=e;this.callback=t;this.running=!1;this.intervalPromise=null}_createClass(n,[{key:"reset",value:function(n){this.stop();this.intervalMS=1e3*n;this.running=!0;this.nextInterval()}},{key:"stop",value:function(){this.running=!1;if(null!==this.intervalPromise){this.$interval.cancel(this.intervalPromise);this.intervalPromise=null}}},{key:"nextInterval",value:function(){var n=this;var e=this.intervalPromise=this.$interval(function(){n.running&&e===n.intervalPromise&&n.onElapsed()},this.intervalMS)}},{key:"onElapsed",value:function(){var n=this;try{this.callback().then(function(){n.nextInterval()},function(){n.nextInterval()})}catch(n){Seq.log("DashboardRefreshTimer","error on elapsed",n);this.nextInterval()}}}]);return n}();Seq.DashboardRefreshTimer=n}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(t,a.key,a)}}return function(e,i,a){i&&t(e.prototype,i);a&&t(e,a);return e}}();!function(){var t=function(){function t(){_classCallCheck(this,t);this.all=[];this.active=null}_createClass(t,[{key:"refresh",value:function(t){var e=this;if(!this.active||!this.active.dirty){var i=this.active?this.active.dashboard.Id:null;var a=_.find(t,function(t){return t.Id===i});this.all.length=0;_.each(t,function(t){return e.all.push(t)});a&&this.activate(a)}}},{key:"isValidDashboardId",value:function(t){return _.any(this.all,function(e){return e.Id===t})}},{key:"onLoaded",value:function(t){var e=this;this.active=null;void 0!==t&&_.each(this.all,function(i){if(i.Id===t){e.active=new Seq.DashboardModel(i);return!1}})}},{key:"add",value:function(t){this.all.push(t)}},{key:"isActive",value:function(t){return null!==this.active&&t===this.active.dashboard}},{key:"activate",value:function(t){var e=this;if(this.isActive(t))return!1;if(null!==this.active){null===this.active.dashboard.Id&&this.all.splice(this.all.indexOf(this.active.dashboard),1);this.active=null}var i=!1;_.each(this.all,function(a){if(a===t){e.active=new Seq.DashboardModel(a);i=!0;return!1}});return i}},{key:"onDeleted",value:function(t){var e=this.isActive(t);this.all.splice(this.all.indexOf(t),1);this.active=null;return e}}]);return t}();Seq.DashboardsModel=t}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();!function(){var e=function(){function e(t){_classCallCheck(this,e);this.storage=t}_createClass(e,[{key:"lastViewedDashboardId",value:function(e){if(!this.storage)return null;if(void 0===e)return this.storage.getItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_VIEWED");this.storage.setItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_VIEWED",e)}},{key:"lastViewedRefreshInterval",value:function(e){if(!this.storage)return null;if(void 0===e)return this.storage.getItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_REFRESH_INTERVAL");this.storage.setItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_REFRESH_INTERVAL",e)}},{key:"lastViewedRange",value:function(e){if(!this.storage)return null;if(void 0===e)return this.storage.getItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_RANGE");this.storage.setItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_RANGE",e)}},{key:"lastViewedGrouping",value:function(e,t){if(!this.storage)return null;if(void 0===t)return this.storage.getItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_GROUPING_"+e);this.storage.setItem("SEQ_DASHBOARD_VIEW_SETTINGS_LAST_GROUPING_"+e,t)}}]);return e}();Seq.DashboardViewSettings=e}();
"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1;t.configurable=!0;"value"in t&&(t.writable=!0);Object.defineProperty(n,t.key,t)}}return function(e,r,t){r&&n(e.prototype,r);t&&n(e,t);return e}}();!function(){var n=function(){function n(){_classCallCheck(this,n)}_createClass(n,null,[{key:"toSeconds",value:function(n){var e=n[n.length-1];var r=parseInt(n.slice(0,n.length-1),10);if("s"===e)return r;r*=60;if("m"===e)return r;r*=60;if("h"===e)return r;r*=24;if("d"===e)return r;throw new Error("Unrecognized duration moniker `"+n+"`.")}}]);return n}();Seq.DurationMoniker=n}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(r,t,n){t&&e(r.prototype,t);n&&e(r,n);return r}}();!function(){var e=function(){function e(){_classCallCheck(this,e);this.query={select:[],fromStream:!1,where:[],groupBy:[],having:[],orderBy:[],limit:null,for:[]}}_createClass(e,[{key:"select",value:function(r){e.add(this.query.select,r)}},{key:"fromStream",value:function(e){this.query.fromStream=e}},{key:"where",value:function(r){e.add(this.query.where,r)}},{key:"groupBy",value:function(r){e.add(this.query.groupBy,r)}},{key:"having",value:function(r){e.add(this.query.having,r)}},{key:"orderBy",value:function(r){e.add(this.query.orderBy,r)}},{key:"limit",value:function(e){this.query.limit=e}},{key:"for",value:function(r){e.add(this.query.for,r)}},{key:"toSql",value:function(){if(0===this.query.select.length)return"";var e="select "+this.query.select.join(", ")+"\r\n";this.query.fromStream&&(e+="from stream \r\n");if(this.query.where.length>0){e+="where ";if(1===this.query.where.length)e+=this.query.where[0]+"\r\n";else{e+="(";e+=this.query.where.join(")\r\n  and (");e+=")\r\n"}}0!==this.query.groupBy.length&&(e+="group by "+this.query.groupBy.join(", ")+"\r\n");if(this.query.having.length>0){e+="having ";if(1===this.query.having.length)e+=this.query.having[0]+"\r\n";else{e+="(";e+=this.query.having.join(")\r\n  and (");e+=")\r\n"}}0!==this.query.orderBy.length&&(e+="order by "+this.query.orderBy.join(", ")+"\r\n");null!==this.query.limit&&(e+="limit "+this.query.limit+"\r\n");0!==this.query.for.length&&(e+="for "+this.query.for.join(", ")+"\r\n");return e}}],[{key:"add",value:function(e,r){"string"==typeof r?e.push(r):_.each(r,function(r){return e.push(r)})}}]);return e}();Seq.QueryBuilder=e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,a,n){a&&e(t.prototype,a);n&&e(t,n);return t}}();var _module=angular.module("seq-ui2");_module.directive("dashboard",["$q","session","messageBox","$location","$window","$timeout",function(e,t,a,n,i,o){var s=function(){function s(){var a=this;_classCallCheck(this,s);this.saving=new Seq.Busy(e,"save dashboard");this.editingJSON=!1;this.location=new Seq.DashboardLocation(n,i);this.maximized=this.location.maximized();this.showSignalsList=!1;t.then(function(e){a.user=e.user})}_createClass(s,[{key:"save",value:function(){var e=this;if(this.model.dirty){var a=null===this.model.dashboard.Id;this.saving.until(t.then(function(t){return t.api.dashboards.createOrUpdate(e.model.dashboard)}).then(function(t){return e.model.replace(t)}).then(function(){a&&e.dashboards.onCreated(e.model.dashboard)}))}}},{key:"link",value:function(e){this.$scope=e}},{key:"discardChanges",value:function(){var e=this;if(this.model.dashboard.Id)return this.saving.until(t.then(function(t){return t.api.dashboards.get(e.model.dashboard.Id)}).then(function(t){return e.model.replace(t)}).then(function(){return e.broadcastLayoutChange()}))}},{key:"broadcastLayoutChange",value:function(){var e=this;this.$scope&&o(function(){return e.$scope.$broadcast("seq:relayout",Seq.ChartRefresh.Render)},500)}},{key:"del",value:function(){var e=this;a.confirm("Delete the current dashboard?").then(function(){return e.model.dashboard.Id?e.saving.until(t.then(function(t){return t.api.dashboards.remove(e.model.dashboard)}).then(function(){return e.dashboards.onDeleted(e.model.dashboard)})):e.dashboards.onDeleted(e.model.dashboard)})}},{key:"editAsJSON",value:function(){this.editingJSON=!0}},{key:"editedJSON",value:function(e){this.model.replace(e,!0)}},{key:"toggleSignalsList",value:function(){this.showSignalsList=!this.showSignalsList}},{key:"switchToClone",value:function(){var e=this;var t=this.model.clone(i.JSON);this.user.IsAdministrator||(t.OwnerId=this.user.Id);return this.model.dirty&&this.model.dashboard.Id?this.discardChanges().then(function(){return e.dashboards.switchToNew(t)}):this.dashboards.switchToNew(t)}},{key:"toggleShared",value:function(){this.model.toggleShared(this.user)}},{key:"addChart",value:function(){this.model.addChart()}},{key:"toggleMaximized",value:function(){this.maximized=!this.maximized;this.location.maximized(this.maximized);this.broadcastLayoutChange()}},{key:"onEditing",value:function(e){Seq.log("DashboardController","editing",e);this.$scope.$broadcast("seq:chart-editing",e)}}]);return s}();return Seq.component("dashboard",s,{model:"=",dashboards:"="})}]);
"use strict";var _module=angular.module("seq-ui2");_module.factory("dashboardFetchQueue",["$q","$rootScope",function(e,u){return new Seq.DashboardFetchQueue(e,u)}]);
"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,a){for(var n=0;n<a.length;n++){var t=a[n];t.enumerable=t.enumerable||!1;t.configurable=!0;"value"in t&&(t.writable=!0);Object.defineProperty(e,t.key,t)}}return function(a,n,t){n&&e(a.prototype,n);t&&e(a,t);return a}}();var _module=angular.module("seq-ui2");_module.directive("dashboardList",function(){var e=function(){function e(){_classCallCheck(this,e)}_createClass(e,[{key:"activate",value:function(e){this.onActivate({$dashboard:e})}},{key:"addDashboard",value:function(){this.onAdd()}}]);return e}();return Seq.component("dashboardList",e,{items:"=",active:"=",onActivate:"&",onAdd:"&"})});
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var l=n[t];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(e,l.key,l)}}return function(n,t,l){t&&e(n.prototype,t);l&&e(n,l);return n}}();var _module=angular.module("seq-ui2");_module.directive("labeledTermInput",function(){var e=function(){function e(){_classCallCheck(this,e)}_createClass(e,[{key:"addTerm",value:function(){this.model.push({Value:"",Label:"col"+this.model.length});this.onChange()}},{key:"link",value:function(e,n){this.el=n}},{key:"inputChanged",value:function(e){if(e>=0&&e<this.model.length&&void 0!==this.model[e]){var n=this.model[e].Value;if("string"==typeof n&&""===n.trim()){Seq.log("LabeledTermInputController","removing blank item",e);this.model.splice(e,1)}}this.onChange()}}]);return e}();return Seq.component("labeledTermInput",e,{model:"=",onChange:"&"})});
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var i=0;i<n.length;i++){var s=n[i];s.enumerable=s.enumerable||!1;s.configurable=!0;"value"in s&&(s.writable=!0);Object.defineProperty(e,s.key,s)}}return function(n,i,s){i&&e(n.prototype,i);s&&e(n,s);return n}}();var _module=angular.module("seq-ui2");_module.directive("rangeControls",["$location","dashboardFetchQueue","$interval","$window",function(e,n,i,s){var t=[{description:"5 minutes",moniker:"5m",seconds:300,grouping:"5s"},{description:"15 minutes",moniker:"15m",seconds:900,grouping:"5s"},{description:"30 minutes",moniker:"30m",seconds:1800,grouping:"15s"},{description:"60 minutes",moniker:"1h",seconds:3600,grouping:"30s"},{description:"2 hours",moniker:"2h",seconds:7200,grouping:"1m"},{description:"8 hours",moniker:"8h",seconds:28800,grouping:"5m"},{description:"24 hours",moniker:"1d",seconds:86400,grouping:"15m"},{description:"2 days",moniker:"2d",seconds:172800,grouping:"30m"},{description:"7 days",moniker:"7d",seconds:604800,grouping:"1h"},{description:"30 days",moniker:"30d",seconds:2592e3,grouping:"8h"},{description:"90 days",moniker:"90d",seconds:7776e3,grouping:"1d"},{description:"365 days",moniker:"365d",seconds:31536e3,grouping:"7d"}];var o=[{description:"5 seconds",moniker:"5s",seconds:5,roundSeconds:5},{description:"15 seconds",moniker:"15s",seconds:15,roundSeconds:15},{description:"30 seconds",moniker:"30s",seconds:30,roundSeconds:30},{description:"minute",moniker:"1m",seconds:60,roundMinutes:1},{description:"5 minutes",moniker:"5m",seconds:300,roundMinutes:5},{description:"15 minutes",moniker:"15m",seconds:900,roundMinutes:15},{description:"30 minutes",moniker:"30m",seconds:1800,roundMinutes:30},{description:"hour",moniker:"1h",seconds:3600,roundHours:1},{description:"8 hours",moniker:"8h",seconds:28800,roundHours:8},{description:"day",moniker:"1d",seconds:86400,roundHours:24},{description:"week",moniker:"7d",seconds:604800,roundHours:24},{description:"4 weeks",moniker:"28d",seconds:2419200,roundHours:24}];var r=[{description:"manually",moniker:null,seconds:null},{description:"every 10 seconds",moniker:"10s",seconds:10},{description:"every 30 seconds",moniker:"30s",seconds:30},{description:"every minute",moniker:"1m",seconds:60},{description:"every 5 minutes",moniker:"5m",seconds:300},{description:"every 15 minutes",moniker:"15m",seconds:900},{description:"every 30 minutes",moniker:"30m",seconds:1800},{description:"every hour",moniker:"1h",seconds:3600}];var u=function(){function u(){var a=this;_classCallCheck(this,u);this.activeDuration=null;this.activeGrouping=null;this.activeRefreshRate=null;this.durationOptions=t;this.refreshRateOptions=r;this.groupingOptions=o;this.location=new Seq.DashboardLocation(e);this.fetching=n.fetching;this.refreshTimer=new Seq.DashboardRefreshTimer(i,function(){return n.invalidate(a.getRangeData())});this.viewSettings=new Seq.DashboardViewSettings(s.localStorage);var d=null;this.location.range()?d=this.findRangeOption(this.location.range()):null!==this.viewSettings.lastViewedRange()&&(d=this.findRangeOption(this.viewSettings.lastViewedRange()));d=d||t[0];var c=null;this.location.group()?c=this.findGroupingOption(this.location.group()):this.viewSettings.lastViewedGrouping(d.moniker)&&(c=this.findGroupingOption(this.viewSettings.lastViewedGrouping(d.moniker)));c=c||this.findGroupingOption(d.grouping);this.setRangeDuration({duration:d,grouping:c});var h=null;this.location.refreshInterval()?h=this.findRefreshRateOption(this.location.refreshInterval()):null!==this.viewSettings.lastViewedRefreshInterval()&&(h=this.findRefreshRateOption(this.viewSettings.lastViewedRefreshInterval()));this.setRefreshRate(h||r[0])}_createClass(u,[{key:"link",value:function(e){var n=this;e.$on("$destroy",function(){return n.refreshTimer.stop()})}},{key:"findRangeOption",value:function(e){return _.find(this.durationOptions,function(n){return n.moniker===e})}},{key:"findGroupingOption",value:function(e){return _.find(this.groupingOptions,function(n){return n.moniker===e})}},{key:"findRefreshRateOption",value:function(e){return _.find(this.refreshRateOptions,function(n){return n.moniker===e})}},{key:"getRangeData",value:function(){var e=new Date;var n=new Date(e.valueOf());n.setSeconds(e.getSeconds()-this.activeDuration.seconds);n.setMilliseconds(0);if(this.activeGrouping.hasOwnProperty("roundSeconds"))n.setSeconds(n.getSeconds()-n.getSeconds()%this.activeGrouping.roundSeconds);else{n.setSeconds(0);if(this.activeGrouping.hasOwnProperty("roundMinutes"))n.setMinutes(n.getMinutes()-n.getMinutes()%this.activeGrouping.roundMinutes);else{n.setMinutes(0);this.activeGrouping.hasOwnProperty("roundHours")?n.setHours(n.getHours()-n.getHours()%this.activeGrouping.roundHours):n.setHours(0)}}return{duration:this.activeDuration.moniker,timeGrouping:this.activeGrouping.moniker,rangeStartUtc:n,rangeEndUtc:e}}},{key:"setRangeDuration",value:function(e){var i=e.duration,s=e.grouping;if(this.activeDuration!==i||this.activeGrouping!==s){this.activeDuration=i;this.activeGrouping=s;this.location.range(i.moniker);this.location.group(s.moniker);this.viewSettings.lastViewedRange(i.moniker);this.viewSettings.lastViewedGrouping(i.moniker,s.moniker);n.invalidate(this.getRangeData())}}},{key:"setRefreshRate",value:function(e){this.activeRefreshRate=e;this.refreshRateDescription=e.description;this.location.refreshInterval(e.moniker);this.viewSettings.lastViewedRefreshInterval(e.moniker);null!==e.seconds?this.refreshTimer.reset(e.seconds):this.refreshTimer.stop()}},{key:"refreshOrStop",value:function(){n.invalidate(this.getRangeData())}}]);return u}();return Seq.component("rangeControls",u,{})}]);
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(e,r.key,r)}}return function(n,t,r){t&&e(n.prototype,t);r&&e(n,r);return n}}();var _module=angular.module("seq-ui2");_module.directive("termInput",function(){var e=function(){function e(){_classCallCheck(this,e)}_createClass(e,[{key:"addTerm",value:function(){this.model.push("");this.onChange()}},{key:"link",value:function(e,n){this.el=n}},{key:"inputChanged",value:function(e){if(e>=0&&e<this.model.length){var n=this.model[e];if("string"==typeof n&&""===n.trim()){Seq.log("TermInputController","removing blank item",e);this.model.splice(e,1)}}this.onChange()}}]);return e}();return Seq.component("termInput",e,{model:"=",onChange:"&"})});
"use strict";!function(){function t(t,e,s,i,n){var r=this;r.$q=t;r.api=e;r.currentSlice=s;r.loading=i.create("load query results");r.isDisposed=!1;r.columns=null;r.rows=null;r.slices=null;r.reasons=null;r.suggestion=null;r.state="idle";r.timeoutMS=n||6e4}t.prototype.load=function(){var t=this;t.state="busy";return t.loading.until(t.fill()).finally(function(){t.state="idle"})};t.prototype.getParams=function(){var t=this;var e={q:t.currentSlice.query,signal:t.currentSlice.signalExpression.toString(),timeoutMS:t.timeoutMS};t.currentSlice.fromUtc&&(e.rangeStartUtc=t.currentSlice.fromUtc.toISOString());null!==t.currentSlice.toUtc&&(e.rangeEndUtc=t.currentSlice.toUtc.toISOString());return e};t.prototype.export=function(){var t=this;var e=t.currentSlice.signal;var s=t.getParams();s.format="text/csv";s.defer=!0;return t.api.data.inSignal(e,s)};t.prototype.fill=function(){var t=this;var e=t.currentSlice.signal;var s=t.getParams();return t.api.data.inSignal(e,s).then(function(e){if(!t.isDisposed){t.columns=e.Columns;t.rows=e.Rows;t.slices=e.Slices;t.series=e.Series;t.reasons=null;t.suggestion=null;t.statistics=e.Statistics}},function(e){if(!t.isDisposed){t.columns=null;t.rows=null;t.slices=null;t.series=null;t.reasons=(e.data||{}).Reasons;t.suggestion=(e.data||{}).Suggestion;t.statistics=null;return t.$q.reject(e)}})};t.prototype.dispose=function(){var t=this;t.state="idle";t.isDisposed=!0};Seq.DataSet=t}();
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(t,n.key,n)}}return function(e,i,n){i&&t(e.prototype,i);n&&t(e,n);return e}}();!function(){var t={Idle:"idle",Busy:"busy",AutoRefresh:"auto"};var e=function(){function e(i,n,s,r,a,c){_classCallCheck(this,e);this.$q=i;this.$timeout=c;this.api=n;this.currentSlice=s;this.completionSource=a;this.loading=new Seq.Busy(i,"load events");this.isAutoRefresh=!1;this.isDisposed=!1;this.isComplete=!1;this.events=[];this.initialWindowSize=r;this.maxWindowSize=0;this.lastReadEventId=null;this.state=t.Idle;this.statistics={scanned:0,uncachedSegmentsScanned:!1}}_createClass(e,[{key:"loadMore",value:function(){var e=this;if(!(this.loading.isBusy||this.isComplete||this.isAutoRefresh)){0===this.maxWindowSize?this.maxWindowSize=this.initialWindowSize:this.maxWindowSize=Math.min(2*this.maxWindowSize,this.maxWindowSize+5*this.initialWindowSize);this.state=t.Busy;return this.loading.until(this.update()).finally(function(){e.state=t.Idle})}}},{key:"update",value:function(){var t=this;var e=this.currentSlice.signal;var i={count:this.maxWindowSize-this.events.length,filter:this.currentSlice.filter,signal:this.currentSlice.signalExpression.toString(),shortCircuitAfter:100};this.currentSlice.fromUtc&&(i.fromDateUtc=this.currentSlice.fromUtc.toISOString());null!==this.currentSlice.toUtc&&(i.toDateUtc=this.currentSlice.toUtc.toISOString());if(this.lastReadEventId){i.afterId=this.lastReadEventId;i.shortCircuitAfter=0===this.events.length?100:5e3}else if(this.events.length>0){i.afterId=this.events[this.events.length-1].Id;i.shortCircuitAfter=5e3}return this.api.events.inSignal(e,i).then(function(e){if(!t.isDisposed){t.lastReadEventId=e.Statistics.LastReadEventId;t.statistics.scanned+=e.Statistics.ScannedEventCount;t.statistics.scannedUntil=e.Statistics.LastReadEventTimestamp?new Date(e.Statistics.LastReadEventTimestamp):null;t.statistics.uncachedSegmentsScanned=t.statistics.uncachedSegmentsScanned||e.Statistics.UncachedSegmentsScanned;t.append(e.Events);if("Partial"===e.Statistics.Status&&t.events.length<t.maxWindowSize)return t.update();if("Complete"===e.Statistics.Status){null!==t.currentSlice.fromUtc&&(t.statistics.scannedUntil=t.currentSlice.fromUtc);t.isComplete=!0}}})}},{key:"completeWith",value:function(t){var e=[].concat(_toConsumableArray(t));var i=e.pop();this.events=[].concat(_toConsumableArray(this.events),_toConsumableArray(e),[i]);this.lastReadEventId=i.Id;this.isComplete=!0}},{key:"getExportArgs",value:function(t,e){var i=this.currentSlice.signal;var n={filter:this.currentSlice.filter,signal:this.currentSlice.signalExpression.toString()};t&&(n.fromDateUtc=t.toISOString());e&&(n.toDateUtc=e.toISOString());return{signal:i,params:n}}},{key:"loadHistogram",value:function(t,e,i){var n=this;return this.api.expressions.fuzzyToSql(this.currentSlice.filter).then(function(s){var r="select count(*) from stream";"string"==typeof s.Expression&&""!==s.Expression&&(r+=" where "+s.Expression);r+=" group by time("+t+")";var a={q:r,signal:n.currentSlice.signalExpression.toString(),timeoutMS:15e3};e&&(a.rangeStartUtc=e.toISOString());i&&(a.rangeEndUtc=i.toISOString());return n.api.data.inSignal(n.currentSlice.signal,a).then(function(t){return{Points:t.Slices.map(function(t){return{SliceStartUtc:t.Time,Value:t.Rows[0][0]}})}})})}},{key:"loadTable",value:function(t,e,i){var n=this.getExportArgs(e,i);n.params.defer=t;return this.api.events.tabulate(n.signal,n.params)}},{key:"deleteMatching",value:function(){var t=this.getExportArgs();this.currentSlice.fromUtc&&(t.params.fromDateUtc=this.currentSlice.fromUtc.toISOString());null!==this.currentSlice.toUtc&&(t.params.toDateUtc=this.currentSlice.toUtc.toISOString());return this.api.events.deleteInSignal(t.signal,t.params)}},{key:"startAutorefresh",value:function(){this.state=t.AutoRefresh;this.isAutoRefresh=!0;this.setAutorefreshTimer()}},{key:"setAutorefreshTimer",value:function(){var t=this;this.$timeout(function(){if(!t.isDisposed){var e=t.currentSlice.signal;var i={count:t.maxWindowSize,filter:t.currentSlice.filter,signal:t.currentSlice.signalExpression.toString()};t.currentSlice.fromUtc&&(i.fromDateUtc=t.currentSlice.fromUtc.toISOString());null!==t.currentSlice.toUtc&&(i.toDateUtc=t.currentSlice.toUtc.toISOString());return t.api.events.inSignal(e,i).then(function(e){if(!t.isDisposed){t.lastReadEventId=e.Statistics.LastReadEventId;t.statistics.scanned=e.Statistics.ScannedEventCount;t.statistics.scannedUntil=e.Statistics.LastReadEventTimestamp?new Date(e.Statistics.LastReadEventTimestamp):null;t.statistics.uncachedSegmentsScanned=e.Statistics.UncachedSegmentsScanned;t.events=[].concat(_toConsumableArray(e.Events));t.setAutorefreshTimer()}})}},2e3)}},{key:"append",value:function(t){var e=this;t.forEach(function(t){e.events.push(t);t.Properties&&t.Properties.forEach(function(t){var i=t.Name;i[0]>="0"&&i[0]<="9"&&(i="@"+i);e.completionSource.add(i)})})}},{key:"dispose",value:function(){this.isDisposed=!0;this.state=t.Idle;this.isAutoRefresh=!1}}]);return e}();Seq.EventSet=e}();
"use strict";!function(){function t(t){this.document=t}t.prototype.count=function(){var t=this;var n=t.document[0].body.clientHeight;var o=n-200;var i=o/20;var r=10*Math.floor(1.5*i/10);return Math.max(30,r)};Seq.InitialWindowEstimator=t}();
"use strict";!function(){function e(e,t,n){var r=this;r.$q=e;r.seq=t;r.open=null;r.dirty=!1;r.onImplicitCreate=n;r.defaultContent=null}e.prototype.setDefaultContent=function(e){this.defaultContent=e};e.prototype.load=function(e){var t=this;if(null!==t.open&&t.open.Id===e){var n=t.$q.defer();n.resolve(t.open);return n.promise}return t.seq.api.sqlQueries.get(e).then(function(e){t.open=e;t.dirty=!1;return e})};e.prototype.template=function(){var e=this;var t={Title:"New Query",Description:null,Sql:"",Show:!1,Id:null,Links:{Create:"api/sqlqueries/"}};if("string"!=typeof e.defaultContent||""===e.defaultContent.trim()){t.Sql="select ";var n=e.$q.defer();n.resolve(t);return n.promise}var r=Seq.Syntax.detect(e.defaultContent);if(r===Seq.Syntax.QUERY||r===Seq.Syntax.INDETERMINATE){t.Sql=e.defaultContent;var o=e.$q.defer();o.resolve(t);return o.promise}return e.seq.api.expressions.fuzzyToSql(e.defaultContent).then(function(e){t.Sql="select count(*) from stream where "+e.Expression;return t})};e.prototype.edit=function(e){var t=this;t.clear();return t.load(e)};e.prototype.clear=function(){var e=this;e.open=null;e.dirty=!1};e.prototype.create=function(e){var t=this;t.clear();return t.template().then(function(n){t.open=n;"string"==typeof e&&e.trim().length>0&&(t.open.Title=e.trim());t.dirty=!0})};e.prototype.updateTitle=function(e){var t=this;if(t.open.Title!==e){t.open.Title=e;t.dirty=!0}};e.prototype.save=function(){var e=this;return e.seq.api.sqlQueries.createOrUpdate(e.open).then(function(t){e.open=t;e.dirty=!1;return t})};e.prototype.del=function(){var e=this;if(e.open.Id)return e.seq.api.sqlQueries.remove(e.open).then(function(){e.open=null;e.dirty=!1});e.clear();var t=e.$q.defer();t.resolve();return t.promise};e.prototype.setSql=function(e){var t=this;t.defaultContent=e;if(t.open&&t.open.Sql!==e){t.open.Sql=e;t.dirty=!0}};Seq.QueryEditor=e}();
"use strict";!function(){function e(e,t,r){var i=this;i.$q=e;i.seq=t;i.signalId=null;i.open=null;i.dirty=!1;i.onImplicitCreate=r}e.prototype.current=function(){var e=this;var t=e.signalId;if(null!==t){if(null!==e.open&&e.open.Id===t){var r=e.$q.defer();r.resolve(e.open);return r.promise}return e.seq.api.signals.get(t).then(function(t){e.open=t;e.dirty=!1;return t})}var i=e.$q.defer();i.resolve(e.open||e.template());return i.promise};e.prototype.template=function(){return{Title:"New Signal",Description:null,Filters:[],TaggedProperties:[],IsWatched:!1,Id:null,Grouping:"Inferred",ExplicitGroupName:null,Links:{Create:"api/signals/"}}};e.prototype.edit=function(e){var t=this;t.open=null;t.dirty=!1;t.signalId=e;return t.current()};e.prototype.clear=function(){var e=this;e.open=null;e.dirty=!1;e.signalId=null};e.prototype.create=function(e){var t=this;t.clear();t.open=t.template();"string"==typeof e&&e.trim().length>0&&(t.open.Title=e.trim());t.dirty=!0};e.prototype.updateTitle=function(e){var t=this;if(t.open.Title!==e){t.open.Title=e;t.dirty=!0}};e.prototype.updateGrouping=function(e){var t=this;if(t.open.Grouping!==e){t.open.Grouping=e;t.dirty=!0}};e.prototype.updateGroupName=function(e){var t=this;if(t.open.ExplicitGroupName!==e){t.open.ExplicitGroupName=e;t.dirty=!0}};e.prototype.toggleRestricted=function(){var e=this;e.open.IsRestricted=!e.open.IsRestricted;e.dirty=!0};e.prototype.addFilter=function(e,t){var r=this;if(!e)throw new Error("Please provide a signal filter part.");if(null===r.open){r.open=r.template();"string"==typeof t&&(r.open.Title=t);r.onImplicitCreate()}r.dirty=!0;r.open.Filters.push(e)};e.prototype.updateFilter=function(e,t){var r=this;if(!e)throw new Error("Please provide a signal filter part.");if(!t)throw new Error("Please provide a replacement signal filter part.");e.Filter=t.Filter;e.FilterNonStrict=t.FilterNonStrict;e.Description=t.Description;e.DescriptionIsExcluded=t.DescriptionIsExcluded;r.dirty=!0};e.prototype.removeFilter=function(e){var t=this;if(!e)throw new Error("Please provide a signal filter part.");t.open.Filters.splice(t.open.Filters.indexOf(e),1);t.dirty=!0};e.prototype.addTag=function(e){var t=this;if(void 0===e)throw new Error("Please provide a property name.");null===t.open&&(t.open=t.template());t.dirty=!0;t.open.TaggedProperties.push({PropertyName:e})};e.prototype.removeTag=function(e){var t=this;if(!e)throw new Error("Please provide a tagged property.");t.open.TaggedProperties.splice(t.open.TaggedProperties.indexOf(e),1);t.dirty=!0};e.prototype.replace=function(e){var t=this;t.open=e;t.dirty=!0};e.prototype.save=function(){var e=this;"Explicit"!==e.open.Grouping||"string"==typeof e.open.ExplicitGroupName&&""!==e.open.ExplicitGroupName.trim()||(e.open.Grouping="None");return e.seq.api.signals.createOrUpdate(e.open).then(function(t){e.open=t;e.dirty=!1;e.signalId=t.Id;return t})};e.prototype.del=function(){var e=this;if(e.open.Id)return e.seq.api.signals.remove(e.open).then(function(){e.open=null;e.dirty=!1;e.signalId=null});e.clear();var t=e.$q.defer();t.resolve();return t.promise};Seq.SignalEditor=e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(t,i.key,i)}}return function(e,n,i){n&&t(e.prototype,n);i&&t(e,i);return e}}();!function(){var t=function(){function t(e){_classCallCheck(this,t);this.location=e;this.noreplace=!1;this.migrate()}_createClass(t,[{key:"preserveHistory",value:function(){this.noreplace=!0}},{key:"retainEmptyRawSignal",value:function(){this.signal.isEmpty&&this.location.search("signal","")}},{key:"migrate",value:function(){var t=this.location.search().intersect;if(t&&t.length>0){var e=this.location.search().signal||"";e.length>0&&(e+=",");e+=t;this.location.search("intersect",null);this.location.search("signal",e)}}},{key:"filter",get:function(){return this.location.search().filter||""},set:function(t){null!==t&&""!==t.trim()?this.location.search("filter",t):this.location.search("filter",null)}},{key:"query",get:function(){return this.location.search().q||""},set:function(t){null!==t&&""!==t.trim()?this.location.search("q",t):this.location.search("q",null)}},{key:"view",get:function(){return this.location.search().view||"table"},set:function(t){null!==t&&""!==t.trim()&&"table"!==t.trim()?this.location.search("view",t):this.location.search("view",null)}},{key:"signal",get:function(){var t=this.location.search().signal||"";return Seq.SignalExpressionParser.parse(t)},set:function(t){if(null!==t){var e=t.toString();""===e&&(e=null);this.location.search("signal",e)}else this.location.search("signal",null)}},{key:"hasRawSignal",get:function(){return void 0!==this.location.search().signal}},{key:"fromUtc",get:function(){var t=(this.location.search().from||"").trim();return 0===t.length?null:new Date(t)},set:function(t){null!==t?this.location.search("from",t.toISOString()):this.location.search("from",null)}},{key:"toUtc",get:function(){var t=(this.location.search().to||"").trim();return 0===t.length?null:new Date(t)},set:function(t){null!==t?this.location.search("to",t.toISOString()):this.location.search("to",null)}},{key:"autorefresh",get:function(){return!!this.location.search().autorefresh},set:function(t){t?this.location.search("autorefresh",!0):this.location.search("autorefresh",null)}},{key:"showExpanded",get:function(){return!!this.location.search().showExpanded||"expanded"===this.location.search().show},set:function(t){if(!t){this.location.search("show",null);return this.location.search("showExpanded",null)}this.location.search("showExpanded",!0)}},{key:"deletionEnabled",get:function(){return!!this.location.search().deletionEnabled||"enabled"===this.location.search().deletion},set:function(t){if(t)this.location.search("deletionEnabled",!0);else{this.location.search("deletionEnabled",null);this.location.search("deletion",null)}}},{key:"current",get:function(){return{filter:this.filter,signal:this.signal,intersect:this.intersect}}}]);return t}();Seq.StreamSlice=t}();
"use strict";!function(){function t(){var t=this;t._available=10;t._allocated={};t._nextIndex=0;t._listeners=[]}t.prototype.listen=function(t){var e=this;e._listeners.push(t);return function(){e._listeners.splice(e._listeners.indexOf(t),1)}};t.prototype.notify=function(){var t=this;_.each(t._listeners,function(t){t()})};t.prototype.next=function(){return this._nextIndex};t.prototype.allocate=function(t){var e=this;var n=e._allocated[t];if(n){n.uses+=1;if(1===n.uses){delete e._allocated[t];e._allocated[t]=n}}else{e._allocated[t]={uses:1,index:e._nextIndex};e._nextIndex=(e._nextIndex+1)%e._available}e.notify()};t.prototype.deallocate=function(t){var e=this;if(!e.isAllocated(t))throw new Error(t+" is not allocated a tag");var n=e._allocated[t];n.uses-=1;0===n.uses&&e.notify()};t.prototype.reset=function(){var t=this;t._allocated={};t._nextIndex=0;t.notify()};t.prototype.getFor=function(t){var e=this;if(!e.isAllocated(t))throw new Error("No tag has been allocated for "+t);return e._allocated[t].index};t.prototype.isAllocated=function(t){var e=this;return e._allocated.hasOwnProperty(t)&&e._allocated[t].uses>0};t.prototype.getAll=function(){var t=this;return _.chain(t._allocated).pairs().filter(function(t){return t[1].uses>0}).map(function(t){return{propertyName:t[0],index:t[1].index}}).value()};Seq.TagAllocator=t}();
"use strict";var _module=angular.module("seq-ui2");_module.directive("dataView",function(){return{restrict:"E",replace:!0,templateUrl:"data_view.tpl.html",scope:{dataSet:"=",timePrefs:"=",eventsControl:"=",eventsLayout:"="}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("event",["$window",function(e){return{restrict:"E",replace:!0,templateUrl:"event.tpl.html",scope:{model:"=",tagAllocator:"=",eventsControl:"=",signalEditor:"=",timePrefs:"="},link:{pre:function(l){var t=l.eventsControl;var o=l.event={collapsed:!t.showExpanded,model:l.model,levelClass:"seq-level-"+Seq.EventLevel.normalize(l.model.Level),timePrefs:l.timePrefs};o.toggle=function(){t.interacted();e.getSelection&&0!==e.getSelection().toString().length||(o.collapsed=!o.collapsed)}}}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("filterBar",["completionSource",function(e){return{restrict:"E",replace:!0,templateUrl:"filter_bar.tpl.html",scope:{eventsLayout:"=",streamSlice:"=",eventsControl:"=",signalEditor:"=",filterCache:"=",currentEventSet:"=",currentDataSet:"="},link:function(t){function n(){if(s.lastParseResult&&s.lastParseResult.MatchedAsText||o.query){f.syntaxHintAvailable=!0;s.lastParseResult&&s.lastParseResult.MatchedAsText&&(f.syntax=Seq.Syntax.TEXT)}}function r(){f.suggestions={matches:[],backtracks:[]}}var l=t.streamSlice;var i=t.signalEditor;var a=t.filterCache;var s=t.eventsControl;var o=t.eventsLayout;var f=t.filterBar={filter:l.filter.length?l.filter:l.query,syntaxHintAvailable:!1,deletionEnabled:s.deletionEnabled,history:a.history,pinnedHistory:a.pinned,syntax:l.filter.length?Seq.Syntax.FILTER:l.query.length?Seq.Syntax.QUERY:Seq.Syntax.INDETERMINATE,lastRefreshSyntax:null,impliedDate:null,filterState:new Seq.FilterState,choosingDashboard:!1};var c=new Seq.Completion(e);var u=new Seq.FilterTokenizer;t.$watch("eventsControl.lastParseResult",n);r();f.updateSuggestions=function(){f.syntax=Seq.Syntax.detect(f.filter);var e=u.lastIncompleteToken(f.filter);null!==e?f.suggestions=c.suggest(e,{syntax:f.syntax}):r();s.filterBoxChanged(f.filter)};f.checkCompletion=function(e){f.syntaxHintAvailable=!1;if(9===e.keyCode&&f.suggestions.matches.length>0){var n=f.suggestions.matches[0];t.filterBar.complete(n);e.preventDefault()}};f.complete=function(e){var t=u.lastIncompleteToken(f.filter);if(null!==t){f.filter=f.filter.slice(0,-t.length);f.filter+=e;r();f.filterState.activate()}};f.clear=function(){if(""!==f.filter){f.filter="";f.syntaxHintAvailable=!1;s.filterBoxChanged("");f.refresh()}};f.refreshOrStop=function(){if(!(t.currentEventSet&&"idle"!==t.currentEventSet.state&&"auto"!==t.currentEventSet.state||t.currentDataSet&&"idle"!==t.currentDataSet.state))return f.refresh();s.stop()};f.refresh=function(e){f.syntax=Seq.Syntax.detect(f.filter);var t=f.lastRefreshSyntax!==f.syntax;f.lastRefreshSyntax=f.syntax;if(f.syntax===Seq.Syntax.QUERY){l.query=f.filter;l.filter=null;if(l.fromUtc)null!==f.impliedDate&&f.impliedDate.valueOf()!==l.fromUtc.valueOf()&&(f.impliedDate=null);else if(t){var n=new Date;n.setDate(n.getDate()-1);n.setMilliseconds(0);n.setSeconds(0);n.setMinutes(0);f.impliedDate=n;s.setFromUtc(n)}s.refreshQuery()}else{null!==f.impliedDate&&null!==l.fromUtc&&f.impliedDate.valueOf()===l.fromUtc.valueOf()&&null===l.toUtc&&s.setFromUtc(null);f.impliedDate=null;l.filter=f.filter;l.query=null;e||s.refreshFilter()}f.filterState.activate();r()};f.moveToSignal=function(){var e=f.filter;if(""!==e.trim()&&"QUERY"!==f.syntax){var t=l.filter===e;return a.toStrict(e).then(function(n){var r={Filter:n.StrictExpression,FilterNonStrict:e};if(f.filter===e){f.filter="";f.syntaxHintAvailable=!1}i.addFilter(r);f.refresh(t)})}};f.autorefresh=function(){"QUERY"!==f.syntax&&(t.currentEventSet&&t.currentEventSet.isAutoRefresh?s.stop():s.autorefresh())};f.syncFilter=function(){f.filter!==l.filter&&f.refresh()};f.chooseDashboard=function(){f.syncFilter();f.choosingDashboard=!0};f.addToDash=function(e){s.addToDash(e)};f.exportCsv=function(){Seq.Syntax.detect(f.filter)!==Seq.Syntax.QUERY&&f.syncFilter();s.exportCsv()};f.deleteMatching=function(){f.syncFilter();s.deleteMatching()};f.cancelDeletion=function(){f.deletionEnabled=!1;s.cancelDeletion()};f.selectHistory=function(e){f.filter=e;f.syntaxHintAvailable=!1;f.syntax=Seq.Syntax.detect(e);if(f.syntax===Seq.Syntax.QUERY){l.query=f.filter;l.filter=null}else{l.filter=f.filter;l.query=null}f.filterState.activate();s.filterBoxChanged(e)};f.forgetHistory=function(e,t){t.stopPropagation();t.preventDefault();a.forget(e)};f.pinHistory=function(e,t){t.stopPropagation();t.preventDefault();a.pin(e)};t.$on("events:filtered",function(e,t){f.filter=t;f.syntax=Seq.Syntax.detect(t);s.filterBoxChanged(t);f.refresh()});t.$on("events:queryLoaded",function(e,t){f.selectHistory(t)})}}}]);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();var _module=angular.module("seq-ui2");_module.directive("signalBar",["session","$interval","$q","$timeout",function(e,t,n,i){var a=function(){function a(){_classCallCheck(this,a)}_createClass(a,[{key:"link",value:function(a){var r=this;this.state=new Seq.SignalBar(n,i,e,this.streamSlice,this.queryEditor,this.eventsControl,this.signalEditor,this.tagAllocator);a.$on("events:filterBoxChanged",function(e,t){r.queryEditor.setSql(t);r.state.queries.some(function(e){if(e.isActive&&e.entity.Sql.replace(/\s/g,"")!==t.replace(/\s/g,"")){Seq.log("SignalBarController","deselecting query",e.entity.Sql,t);e.isActive=!1;return!0}return!1})});this.state.loading.until(this.state.load().then(function(){var e=t(function(){return r.state.load()},37e3);a.$on("$destroy",function(){t.cancel(e)})}))}},{key:"showHide",value:function(){this.eventsLayout.toggleMinSignalBar()}},{key:"showIfHidden",value:function(){this.eventsLayout.minSignalBar&&this.showHide()}}]);return a}();return Seq.component("signalBar",a,{streamSlice:"=",eventsControl:"=",signalEditor:"=",queryEditor:"=",tagAllocator:"=",eventsLayout:"=",filterCache:"="})}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("streamView",function(){return{restrict:"E",replace:!0,templateUrl:"stream_view.tpl.html",scope:{eventSet:"=",refreshing:"=",tagAllocator:"=",eventsControl:"=",signalEditor:"=",timePrefs:"="},link:function(e){(e.streamView={timePrefs:e.timePrefs}).showMore=function(){var t=e.eventSet;if(t)return t.loadMore()}}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("timeline",["$window","busy",function(e,t){var n=e.moment;return{restrict:"E",replace:!0,templateUrl:"timeline.tpl.html",scope:{eventsControl:"=",eventSet:"=",layout:"=",streamSlice:"=",timePrefs:"="},link:function(e){function o(){f.histogram=null;if(r.timelineVisible&&null!==e.eventSet){var t=null;var o=null;var i=null;var m=null;var u=f.timePrefs.utc?function(e){return n(e).utc()}:function(e){return n(e)};if(a.fromUtc){o=a.fromUtc;i=a.toUtc||new Date;var s=n(i).diff(n(o));var v;if(s<=6e4){t="1s";v=5;m=function(e){var t=u(e);return t.second()%v!=0?"":t.format(l)}}else if(s<=36e5){t="1m";v=5;m=function(e){var t=u(e);return t.minute()%v!=0?"":t.format(c)}}else if(s<=2592e5){t="1h";v=s>864e5?3:1;m=function(e){var t=u(e);return 0===t.hour()?t.format("l"):t.hour()%v!=0?"":t.format(c)}}else{t="1d";v=s>2592e6?s>10368e6?28:7:1;m=function(e){var t=u(e);return t.dayOfYear()%v!=0?"":t.format("l")}}f.histogramLabel="Range by time("+t+")"}else{f.histogramLabel="Recent by time(1h)";t="1h";o=new Date;o.setDate(o.getDate()-1);o.setMinutes(0);o.setSeconds(0);o.setMilliseconds(0);i=new Date;m=function(e){var t=u(e);return 0===t.hours()?t.format("l"):t.hours()%3==0?t.format(c):""}}f.histogram=null;f.effectiveRange={fromUtc:o,toUtc:i,implicitTo:!f.to};return f.updating.until(e.eventSet.loadHistogram(t,o,i).then(function(e){f.histogram={tickFormat:m};f.histogram.ticks=_.map(e.Points,function(e){return{tick:new Date(e.SliceStartUtc),count:e.Value,duration:t}})}))}}var r=e.layout;var a=e.streamSlice;var i=e.eventsControl;var f=e.timeline={from:a.fromUtc,to:a.toUtc,histogram:null,histogramLabel:null,updating:t.create("update histogram"),effectiveRange:null,timePrefs:e.timePrefs};var c="HH:mm";var l="HH:mm:ss";f.applyRange=function(e){a.fromUtc=f.from;a.toUtc=f.to;!e&&r.query||i.refresh(e)};f.goBack=function(){if(f.effectiveRange){var e=n(f.effectiveRange.fromUtc);var t=f.effectiveRange.implicitTo?864e5:n(f.effectiveRange.toUtc).diff(e);f.from=e.subtract({milliseconds:t}).toDate();f.to=n(f.from).add({milliseconds:t}).toDate();f.applyRange()}};f.goForward=function(){if(f.effectiveRange){if(f.effectiveRange.implicitTo){f.from=new Date(f.effectiveRange.toUtc);f.from.setDate(f.effectiveRange.toUtc.getDate());f.from.setMinutes(0);f.from.setSeconds(0);f.from.setMilliseconds(0);f.to=new Date(f.from);f.to.setDate(f.from.getDate()+1)}else{var e=n(f.effectiveRange.toUtc);var t=e.diff(n(f.effectiveRange.fromUtc));f.from=f.effectiveRange.toUtc;f.to=e.add({milliseconds:t}).toDate()}f.applyRange()}};f.selectRange=function(e){var t=e.tick;var n=new Date(t.valueOf());"1d"===e.duration?n.setDate(n.getDate()+1):"1h"===e.duration?n.setHours(n.getHours()+1):"1m"===e.duration?n.setMinutes(n.getMinutes()+1):n.setSeconds(n.getSeconds()+1);f.from=t;f.to=n;f.applyRange()};f.clear=function(){f.from=null;f.to=null;f.applyRange()};e.$watch("eventSet",function(e,t){e!==t&&o()});e.$watch("layout.timelineVisible",function(e,t){e&&e!==t&&null===f.histogram&&o()});e.$on("events:fromUtcSet",function(e,t){f.from=t;a.fromUtc=t});if(f.timePrefs.ampm){c="LT";l="LTS"}o()}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){var t=new Seq.Router(e,"settings");t.when("/settings/api-keys",{controller:"ApiKeysIndexController",controllerAs:"apiKeysIndex",templateUrl:"api_keys_index.tpl.html"});t.when("/settings/api-keys/new",{controller:"ApiKeysEditController",controllerAs:"apiKeysEdit",templateUrl:"api_keys_edit.tpl.html"});t.when("/settings/api-keys/:id",{controller:"ApiKeysEditController",controllerAs:"apiKeysEdit",templateUrl:"api_keys_edit.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(l){var t=new Seq.Router(l,"settings");t.when("/settings/apps",{controller:"AppsIndexController",templateUrl:"apps_index.tpl.html"});t.when("/settings/apps/install",{controller:"AppsInstallController",templateUrl:"apps_install.tpl.html"});t.when("/settings/apps/:id/manage",{controller:"AppsManageController",templateUrl:"apps_manage.tpl.html"});t.when("/settings/apps/:appId/run",{controller:"AppsRunController",controllerAs:"appsRun",templateUrl:"apps_run.tpl.html"});t.when("/settings/apps/instances/:id",{controller:"AppsRunController",controllerAs:"appsRun",templateUrl:"apps_run.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){var l=new Seq.Router(e,"settings");l.when("/settings/backup",{controller:"BackupIndexController",templateUrl:"backup_index.tpl.html"});l.when("/settings/backup/schedule",{controller:"BackupScheduleController",templateUrl:"backup_schedule.tpl.html"})}]);
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(t,i.key,i)}}return function(e,n,i){n&&t(e.prototype,n);i&&t(e,i);return e}}();var _module=angular.module("seq-ui2");_module.controller("DiagnosticsIndexController",function(){function t(e,n,i,r){var s=this;_classCallCheck(this,t);this.seq=n;this.loading=r.create("load diagnostics");this.saving=r.create("save diagnostic settings");this.changingSettings=!1;this.sendErrorReports=!1;this.replyEmail=null;this.originalSettings=null;this.metrics=null;this.ingestionLogUrl=null;this.systemReportUrl=null;e.diagnosticsIndex=this;return this.loading.until(n.api.settings.getInternalErrorReporting().then(function(t){s.originalSettings=t;s.sendErrorReports=t.InternalErrorReportingEnabled;s.replyEmail=t.ReplyEmail}).then(function(){return s.reload()}).then(n.api.diagnostics.getIngestionLogUrl().then(function(t){s.ingestionLogUrl=t})).then(n.api.diagnostics.getSystemReportUrl().then(function(t){s.systemReportUrl=t})).then(function(){var t=i(function(){return s.reload()},1e4);e.$on("$destroy",function(){return i.cancel(t)})}))}t.$inject=["$scope","seq","$interval","busy"];_createClass(t,[{key:"settingsChange",value:function(){this.changingSettings=!0}},{key:"cancelSettingsChange",value:function(){this.replyEmail=this.originalSettings.ReplyEmail;this.sendErrorReports=this.originalSettings.InternalErrorReportingEnabled;this.changingSettings=!1}},{key:"saveSettings",value:function(){var t=this;var e={InternalErrorReportingEnabled:this.sendErrorReports,ReplyEmail:this.sendErrorReports&&null!==this.replyEmail&&""!==this.replyEmail.trim()?this.replyEmail.trim():null};return this.saving.until(this.seq.api.settings.updateInternalErrorReporting(e).then(function(){t.originalSettings=e;t.changingSettings=!1;t.replyEmail=e.ReplyEmail}))}},{key:"reload",value:function(){var t=this;return this.seq.api.diagnostics.getServerMetrics().then(function(e){t.metrics=e;t.friendlyUptime=new Seq.Duration(e.ProcessUptime).friendly();t.queryCountsPerExtent="#/events?q=select%20count(*)%20from%20stream%20group%20by%20time(7d)&from="+e.EventStoreFirstExtentRangeStartUtc+"&view=timeseries"})}}]);return t}());
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){new Seq.Router(e,"settings").when("/settings/diagnostics",{controller:"DiagnosticsIndexController",templateUrl:"diagnostics.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){var t=new Seq.Router(e,"settings");t.when("/settings/feeds",{controller:"FeedsIndexController",templateUrl:"feeds_index.tpl.html"});t.when("/settings/feeds/new",{controller:"FeedEditController",templateUrl:"feeds_edit.tpl.html"});t.when("/settings/feeds/:id",{controller:"FeedEditController",templateUrl:"feeds_edit.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("settingsLayout",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"settings_layout.tpl.html",scope:{title:"@"},link:function(e){var t=[{name:"API Keys",description:"Identify and control the sources of incoming events"},{name:"Apps",description:"Run plug-ins that react to events in the stream"},{name:"Backup",description:"Manage Seq configuration and metadata backups"},{name:"Diagnostics",description:"Review resources used by the Seq server"},{name:"Feeds",description:"Control the sources from which apps may be installed"},{name:"License",description:"View and update Seq license details"},{name:"Retention",description:"Improve search performance and limit disk usage by deleting old events"},{name:"System",description:"Modify system-level settings"},{name:"Theme",description:"Customize the look-and-feel of this Seq instance"},{name:"Users",description:"Create and manage authenticated access to the Seq server"}];var i=_.map(t,function(e){return{title:e.name,subtitle:e.description,slug:e.name.toLowerCase().replace(/ /g,"-")}});var n=_.find(i,function(t){return t.title===e.title});n.isActive=!0;e.settingsLayout={title:e.title,subtitle:n.subtitle,tabs:i}}}});
"use strict";var _module=angular.module("seq-ui2");_module.controller("LicenseIndexController",["$scope","$route","seq","$location","toast","busy",function(e,n,i,s,t,a){var c=e.licenseIndex={loading:a.create("load license details"),saving:a.create("save license details"),canRenew:!1,changed:!1};c.certificateChanged=function(){c.changed=!0};c.saveLicense=function(){return c.saving.until(i.api.licenses.update(c.license).then(function(e){c.license=e;t.success("License saved");n.reload()}))};c.downgradeToFree=function(){return c.saving.until(i.api.licenses.downgradeToFree().then(function(){i.session={};i.settings.isAuthenticationEnabled=!1;t.success("Downgrade completed");n.reload()}))};return c.loading.until(i.api.licenses.getCurrent().then(function(e){c.license=e;c.canRenew=e.CanRenewOnlineNow}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){new Seq.Router(e,"settings").when("/settings/license",{controller:"LicenseIndexController",templateUrl:"license.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(t){var e=new Seq.Router(t,"settings");e.when("/settings/retention",{controller:"RetentionIndexController",templateUrl:"retention_index.tpl.html"});e.when("/settings/retention/new",{controller:"RetentionEditController",templateUrl:"retention_edit.tpl.html"});e.when("/settings/retention/:id",{controller:"RetentionEditController",templateUrl:"retention_edit.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(t){var e=new Seq.Router(t,"settings");e.when("/settings/system/auth",{controller:"SystemAuthController",templateUrl:"auth.tpl.html"});e.when("/settings/system",{controller:"SystemSettingsIndexController",templateUrl:"system_index.tpl.html"});e.when("/settings/system/password-policy",{controller:"SystemPasswordPolicyController",templateUrl:"system_password_policy.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){new Seq.Router(e,"settings").when("/settings/theme",{controller:"ThemeIndexController",templateUrl:"theme_index.tpl.html"})}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("ThemeIndexController",["$scope","seq","toast","busy","$window",function(e,t,n,a,s){var i=e.themeIndex={loading:a.create("load theme"),saving:a.create("save theme"),loaded:!1,styles:null,instanceTitle:null,instanceName:t.instanceName};i.saveTheme=function(){return i.saving.until(t.api.settings.setNamed("ThemeStyles",i.styles).then(function(){return t.api.settings.setNamed("InstanceTitle",i.instanceTitle).then(function(){t.watermark=t.instanceName;i.instanceTitle&&(t.watermark=i.instanceTitle);"string"==typeof t.watermark?s.document.title=t.watermark+" â€” Seq":s.document.title="Seq";var e=s.document.createElement("style");e.id="themeStyles";e.type="text/css";e.innerHTML=i.styles;var a=s.document.getElementById("themeStyles");a.parentNode.replaceChild(e,a);n.success("Theme saved")})}))};return i.loading.until(t.api.settings.getNamed("ThemeStyles").then(function(e){return t.api.settings.getNamed("InstanceTitle").then(function(t){i.styles=e.Value;i.instanceTitle=t.Value;i.loaded=!0})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.config(["$routeProvider",function(e){var t=new Seq.Router(e,"settings");t.when("/settings/users/auth",{redirectTo:"/settings/system/auth"});t.when("/settings/users",{controller:"UsersIndexController",templateUrl:"users_index.tpl.html"});t.when("/settings/users/defaults",{controller:"UsersDefaultsController",templateUrl:"users_defaults.tpl.html",controllerAs:"usersDefaults"});t.when("/settings/users/new",{controller:"UsersEditController",templateUrl:"users_edit.tpl.html"});t.when("/settings/users/:id",{controller:"UsersEditController",templateUrl:"users_edit.tpl.html"})}]);
"use strict";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,s){for(var t=0;t<s.length;t++){var n=s[t];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(s,t,n){t&&e(s.prototype,t);n&&e(s,n);return s}}();var _module=angular.module("seq-ui2");_module.controller("UserAccountController",function(){function e(s,t,n){var a=this;_classCallCheck(this,e);this.seq=s;this.toast=t;this.user=null;this.loading=n.create("load account");this.saving=n.create("save account");this.settings=s.settings;this.passwordIssues={invalid:!1};this.loading.until(this.seq.api.users.get(this.seq.user.Id).then(function(e){a.user=e}))}e.$inject=["seq","toast","busy"];_createClass(e,[{key:"saveChanges",value:function(){var e=this;this.saving.until(this.seq.api.users.update(this.user).then(function(s){e.seq.user=s;e.toast.success("Preferences saved")}))}}]);return e}());
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(e,r.key,r)}}return function(t,n,r){n&&e(t.prototype,n);r&&e(t,r);return t}}();var _module=angular.module("seq-ui2");_module.directive("userLayout",function(){var e=function(){function e(){_classCallCheck(this,e)}_createClass(e,[{key:"link",value:function(){var e=this;var t=[{name:"Account",description:"Your Seq user account"},{name:"Permalinks",description:"View and remove permalinks attached to events"},{name:"Preferences",description:"Your user-specific settings"}];this.tabs=_.map(t,function(e){return{title:e.name,subtitle:e.description,slug:e.name.toLowerCase().replace(/ /g,"-")}});var n=_.find(this.tabs,function(t){return t.title===e.title});n.isActive=!0;this.subtitle=n.subtitle}}]);return e}();return Seq.componentTransclude("userLayout",e,{title:"@"})});
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1;s.configurable=!0;"value"in s&&(s.writable=!0);Object.defineProperty(e,s.key,s)}}return function(n,r,s){r&&e(n.prototype,r);s&&e(n,s);return n}}();var _module=angular.module("seq-ui2");_module.controller("UserPermalinksController",function(){function e(n,r,s){var t=this;_classCallCheck(this,e);this.seq=r;this.loading=new Seq.Busy(n,"load permalinks");this.removing=new Seq.Busy(n,"remove permalink");this.permalinks=null;this.toast=s;this.timePrefs=new Seq.TimePreferences(r.user.Preferences.ShowTimestampsIn12HourTime,r.user.Preferences.ShowTimestampsInUtc,r.user.Preferences.StartOfWeek);this.loading.until(this.seq.api.permalinks.list({ownerId:r.user.Id,includeEvent:!0,renderEvent:!0}).then(function(e){t.permalinks=e}))}e.$inject=["$q","seq","toast"];_createClass(e,[{key:"remove",value:function(e){var n=this;return this.removing.until(this.seq.api.permalinks.remove(e).then(function(){n.permalinks.splice(n.permalinks.indexOf(e),1);n.toast.success("Permalink removed")}))}}]);return e}());
"use strict";function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,s){for(var t=0;t<s.length;t++){var r=s[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(e,r.key,r)}}return function(s,t,r){t&&e(s.prototype,t);r&&e(s,r);return s}}();var _module=angular.module("seq-ui2");_module.controller("UserPreferencesController",function(){function e(s,t,r){var n=this;_classCallCheck(this,e);this.seq=s;this.toast=t;this.user=null;this.loading=r.create("load preferences");this.saving=r.create("save preferences");this.showTimestampsIn12HourTime=!1;this.showTimestampsInUtc=!1;this.queryTimeoutSeconds=null;this.defaultSignalExpression=null;this.startOfWeek=0;this.loading.until(s.api.users.get(s.user.Id).then(function(e){n.user=e;n.defaultSignalExpression=Seq.SignalExpressionParser.parse((e.Preferences.DefaultSignal||"").trim()).toAPIType();n.showTimestampsInUtc=e.Preferences.ShowTimestampsInUtc;n.showTimestampsIn12HourTime=e.Preferences.ShowTimestampsIn12HourTime;n.queryTimeoutSeconds=e.Preferences.QueryTimeoutSeconds;n.startOfWeek=e.Preferences.StartOfWeek||0}))}e.$inject=["seq","toast","busy"];_createClass(e,[{key:"saveChanges",value:function(){var e=this;this.user.Preferences.DefaultSignal=Seq.SignalExpression.fromAPIType(this.defaultSignalExpression).toString();this.user.Preferences.ShowTimestampsIn12HourTime=this.showTimestampsIn12HourTime;this.user.Preferences.ShowTimestampsInUtc=this.showTimestampsInUtc;this.user.Preferences.QueryTimeoutSeconds=this.queryTimeoutSeconds;this.user.Preferences.StartOfWeek=this.startOfWeek;this.saving.until(this.seq.api.users.update(this.user).then(function(s){e.seq.user=s;e.toast.success("Preferences saved")}))}}]);return e}());
"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(n,i.key,i)}}return function(t,e,i){e&&n(t.prototype,e);i&&n(t,i);return t}}();var _module=angular.module("seq-ui2");_module.directive("alertEditor",function(){var n=function(){function n(){_classCallCheck(this,n)}_createClass(n,[{key:"appendCondition",value:function(n){var t=this.alertData;null===t.Condition&&(t.Condition="");t.Condition.length>0&&" "!==t.Condition[t.Condition.length-1]&&(t.Condition+=" ");t.Condition+=n}},{key:"notificationAppChanged",value:function(){this.alertData.NotificationAppSettingOverrides={};this.onChange()}},{key:"notificationAppInstance",get:function(){var n=this;return this.appInstances.find(function(t){return t.id===n.alertData.NotificationAppInstanceId})}}]);return n}();return Seq.component("alertEditor",n,{alertData:"=",query:"=",appInstances:"=",onChange:"&"})});
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,a,n){a&&e(t.prototype,a);n&&e(t,n);return t}}();!function(){var e=function(){function e(t){_classCallCheck(this,e);this.points=t}_createClass(e,[{key:"findTag",value:function(){var e=this.points[0];if(e){var t=null;e.data?t=e.data.tag:e.trace?t=e.trace._input.tag:this.points.trace&&(t=this.points.trace._input.tag);return t}}},{key:"setPointQuery",value:function(e,t,a){e.signal=t.fullSignalExpression();e.retainEmptyRawSignal();var n=Seq.ChartData.isRowset(t.type)?this.rowsetRange(a):this.seriesRange(a),r=n.startSlice,i=n.endSlice;e.fromUtc=r;e.toUtc=i;if(1===t.chartQuery.Measurements.length&&"count(*)"===t.chartQuery.Measurements[0].Value&&0===t.chartQuery.GroupBy.length)e.filter=t.chartQuery.Where;else{var s=t.toSql();e.query=s;e.view="table"}}},{key:"rowsetRange",value:function(e){var t=e.rangeData;return{startSlice:t.rangeStartUtc,endSlice:t.rangeEndUtc}}},{key:"seriesRange",value:function(e){var t=e.rangeData;var a=t.timeGrouping;var n=this.points[0].x;var r=moment(n,"YYYY-MM-DD HH:mm:ss.SSS").toDate();var i=Seq.DurationMoniker.toSeconds(a);var s=new Date(r);s.setSeconds(s.getSeconds()+i);return{startSlice:r,endSlice:s}}}]);return e}();Seq.ChartPoint=e}();
"use strict";!function(){var e={None:"None",Render:"Render",Query:"Query"};Seq.ChartRefresh=e}();
"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,r){var t=[];var a=!0;var n=!1;var o=void 0;try{for(var s,u=e[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){t.push(s.value);if(r&&t.length===r)break}}catch(e){n=!0;o=e}finally{try{!a&&u.return&&u.return()}finally{if(n)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(e,a.key,a)}}return function(r,t,a){t&&e(r.prototype,t);a&&e(r,a);return r}}();!function(){var e={Default:["#00A5B6","#C6C62E","#FF9CE8","#FFC7B9","#E1B0FF","#A8A8A8","#FF8672","#4DBB46","#FF942A","#016DA9"],Reds:["#e12406","#e90056","#c4034a","#ff5300","#ff006a","#f14023","#f10707","#c6060e"],Greens:["#00A506","#06C60E","#119c22","#0FC709","#01B00F","#08A808","#0b6802","#0DBB06","#0F940A","#01FD09"],Blues:["#0005B6","#3891ff","#09c5d9","#3375ed","#138ad1","#0606FE","#0F0CE8","#0100FF","#010DA9"],OrangePurple:["#FFC000","#C38F44","#9E7150","#fba707","#55365A","#331B5B","#1E0F35"]};var r={Default:"#FFF"};var t=6e4*(new Date).getTimezoneOffset();var a=function(){function a(e){_classCallCheck(this,a);this.rangeData=e;this.resultSets=[];this.resultSetRequiresLegend=!1}_createClass(a,[{key:"addResultSet",value:function(e,r,t){this.resultSetRequiresLegend=this.resultSetRequiresLegend||e;this.resultSets.push({resultSet:r,computeOptions:t})}},{key:"requiresLegend",value:function(){return this.resultSetRequiresLegend||this.resultSets.length>1}},{key:"getTraces",value:function(){var r=this;var t=null;var a=null;var n=[];var o=!1;var s=!0;var u=null;var i=[];var l=[];this.resultSets.forEach(function(t){var c=t.computeOptions();i=[].concat(_toConsumableArray(i),_toConsumableArray(c.alertThresholds));Seq.ChartData.isRowset(c.type)&&(s=!1);if(c.overlaySum||!c.valueOnly){c.overlaySum&&(a=e[(c||{}).palette||"Default"][3]);r.resultSetToTraces(t.resultSet,c).forEach(function(e){l.push(e);n=[].concat(_toConsumableArray(n),_toConsumableArray(e.names))})}else{a=e[(c||{}).palette||"Default"][0];o=!0;u=void 0===t.resultSet.Rows||0===t.resultSet.Rows.length||0===t.resultSet.Rows[0].length?"":t.resultSet.Rows[0][0]}});var c=l.reduce(function(e,r){return r.y?r.y.reduce(function(e,r){var t=e.max,a=e.sum;return{max:r>t?r:t,sum:a+r}},e):e},{max:0,sum:0}),f=c.max,v=c.sum;var h=Seq.DurationMoniker.toSeconds(this.rangeData.timeGrouping);i=i.filter(function(e){return e.window.totalSeconds()===h&&e.value<2*f});var m=Math.max.apply(Math,_toConsumableArray(i.map(function(e){return e.value})));var y=1e3*h;var p=[this.rangeData.rangeStartUtc.getTime()-y,this.rangeData.rangeEndUtc.getTime()+y];var g=[0,1.2*Math.max(m,f)];if(null!==a){t={color:a,value:null};if(o){var S=u;"number"==typeof S&&(S=S.toLocaleString());t.value=S}else t.value=v.toLocaleString()}return{traces:l,names:n,overlay:t,showAxis:s,alertThresholds:i,showPlot:!o,requiresLegend:this.requiresLegend(),isPie:1===l.length&&l[0].type===Seq.ChartData.plotlyType(Seq.ChartType.Pie),range:{x:p,y:g}}}},{key:"resultSetToTraces",value:function(e,r){var t=this;this.validate(r.type,e);if(Seq.ChartData.isRowset(r.type))return e.Columns.slice(1).map(function(a){return t.rowsetToTrace(e.Rows,a,r)});var a=[];if(e.Slices)e.Columns.forEach(function(n,o){var s=t.seriesToTrace(e.Slices,{name:n},o,o,r);a.push(s)});else{var n=0;e.Series.map(function(e){var r="";e.Key.forEach(function(e){""!==r&&(r+=" | ");r+=null===e?"null":e});return{name:r,series:e}}).sort(function(e,r){return e.name.localeCompare(r.name)}).forEach(function(o){var s=o.name;var u=o.series;e.Columns.slice(u.Key.length).forEach(function(e,o){var i=t.makeSeriesName(s,e);a.push(t.seriesToTrace(u.Slices,i,o,n,r));n++})})}return a}},{key:"validate",value:function(e,r){if(e===Seq.ChartType.Pie&&(!r.Rows||2!==r.Columns.length))throw new Error("To plot a pie chart, the query must return two columns. The rightmost column must be numeric.")}},{key:"makeSeriesName",value:function(e,r,t){var a=e||"null";var n=function(e){return t?[e].concat(_toConsumableArray(new Array(t).fill("â€‹"))).join(""):e};var o="("===r[0]?r:"("+r+")";var s=a+" "+o;var u=a.length>11?a.substring(0,10)+"â€¦":a;u+=" ";u+=o.length>7?o.substring(0,6)+"â€¦":o;return{name:n(u),description:n(s),raw:e}}},{key:"addPoint",value:function(e,r,a){var n=new Date(r.Time);var o=new Date(n.getTime()-t);var s=o.toISOString().replace("T"," ").slice(0,-1);e.x.push(s);1===r.Rows.length?e.y.push(r.Rows[0][a]):e.y.push(null)}},{key:"seriesToTrace",value:function(e,r,t,a,n){var o=this;var s=this.makeSeriesTrace(r,a,n);e.forEach(function(e){o.addPoint(s,e,t)});return s}},{key:"makeSeriesTrace",value:function(r,t,a){var n=a||{};var o=e[n.palette||"Default"];var s="string"==typeof r.description?r.description:r.name;var u={x:[],y:[],type:Seq.ChartData.plotlyType(n.type,"scatter"),name:r.name,names:[s],description:s,marker:{color:o[t%o.length],size:4},tag:n.tag};if("scatter"===u.type){u.mode=n.mode||"lines+markers";if(n.fillToZeroY){u.fill="tozeroy";u.fillcolor=this.transparency(o[t%o.length],.1)}}return u}},{key:"addRow",value:function(e,r,t,a){var n=_slicedToArray(a,2),o=n[0],s=n[1];var u=this.makeSeriesName(o,r,t);e.labels.push(u.name);e.names.push(u.description);e.values.push(s)}},{key:"rowsetToTrace",value:function(e,r,t){var a=this;var n=this.makeRowSetTrace(t);e.forEach(function(e,t){a.addRow(n,r,t,e)});return n}},{key:"makeRowSetTrace",value:function(t){var a=t||{};var n=e[a.palette||"Default"];var o=r[a.textPalette||"Default"];return{values:[],labels:[],names:[],type:Seq.ChartData.plotlyType(a.type,"pie"),textposition:"none",hole:.45,textfont:{color:o},marker:{colors:n,size:4},tag:a.tag}}},{key:"transparency",value:function(e,r){return"rgba("+_([e[1].concat(e[2]),e[3].concat(e[4]),e[5].concat(e[6])]).map(function(e){return parseInt(e,16)}).join(",")+","+r.toString()+")"}}]);return a}();Seq.TraceBuilder=a}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();var _module=angular.module("seq-ui2");_module.directive("alertsEditor",function(){var e=function(){function e(){_classCallCheck(this,e);this.editing=!1;this.editingAlert=null}_createClass(e,[{key:"addAlert",value:function(){this.startEditing(this.query.addAlert(),!0)}},{key:"startEditing",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.editing=!0;this.isNew=t;this.editingAlert=e}}]);return e}();return Seq.component("alertsEditor",e,{query:"=",onChange:"&"})});
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _module=angular.module("seq-ui2");_module.directive("chartQueryEditor",function(){var e=function e(){_classCallCheck(this,e)};return Seq.component("chartQueryEditor",e,{query:"=",onChange:"&"})});
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(e,r.key,r)}}return function(n,t,r){t&&e(n.prototype,t);r&&e(n,r);return n}}();var _module=angular.module("seq-ui2");_module.directive("chartStyleEditor",function(){var e=function(){function e(){_classCallCheck(this,e);this.types=Object.keys(Seq.ChartType)}_createClass(e,[{key:"onChangeType",value:function(){this.onChange({refresh:Seq.ChartRefresh.Query})}},{key:"onChangeStyle",value:function(){this.onChange({refresh:Seq.ChartRefresh.Render})}}]);return e}();return Seq.component("chartStyleEditor",e,{displayStyle:"=",onChange:"&"})});
"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(n,i.key,i)}}return function(e,t,i){t&&n(e.prototype,t);i&&n(e,i);return e}}();var _module=angular.module("seq-ui2");_module.directive("rangePicker",function(){var n=function(){function n(){_classCallCheck(this,n);this.open=!1}_createClass(n,[{key:"toggle",value:function(){this.open=!this.open}},{key:"link",value:function(n,e){var t=this;n.$on("document:clicked",function(n,i){var o=i;for(;0!==o.length;){if(o[0]===e[0])return;o=o.parent()}t.open=!1})}},{key:"isAvailable",value:function(n){return n.seconds<this.activeDuration.seconds&&this.activeDuration.seconds/n.seconds<=719}},{key:"selectDuration",value:function(n){var e=this.activeGrouping;(e.seconds>=n.seconds||n.seconds/e.seconds>719)&&(e=_.find(this.groupingOptions,function(e){return e.moniker===n.grouping}));this.onChange({$option:{duration:n,grouping:e}});this.open=!1}},{key:"selectGrouping",value:function(n){this.onChange({$option:{duration:this.activeDuration,grouping:n}});this.open=!1}}]);return n}();return Seq.component("rangePicker",n,{durationOptions:"=",activeDuration:"=",groupingOptions:"=",activeGrouping:"=",onChange:"&"})});
"use strict";var _module=angular.module("seq-ui2");_module.directive("asBar",["plotly","$timeout",function(t,a){var o=["#00A5B6","#C6C62E","#FF9CE8","#FFC7B9","#E1B0FF","#A8A8A8","#FF8672","#4DBB46","#FF942A","#016DA9"];return{restrict:"E",replace:!0,templateUrl:"as_bar.tpl.html",scope:{dataSet:"=",eventsLayout:"="},link:function(e,n){function i(t,a){return{x:[],y:[],name:t,type:"bar",marker:{color:o[a%o.length],line:{color:"#FFF",width:1}}}}function r(t){return null===t?"null":t.toString()}function l(){return{width:n[0].offsetWidth-15,height:Math.max(n[0].offsetHeight-20,400)}}function u(){a(function(){var a=l();try{t.relayout("bar-view-chart",a)}catch(t){}})}function s(){h.hasData=c(e.dataSet);if(h.hasData&&e.dataSet!==m){h.isDrawing=!0;m=e.dataSet;var o=[];var n=e.dataSet.columns[0];var u;if(2===e.dataSet.columns.length){u=e.dataSet.columns[1];var s=i(null,0);_.each(e.dataSet.rows,function(t){s.x.push(r(t[0]));s.y.push(t[1])});o.push(s)}else{u=e.dataSet.columns[2];var f=_.groupBy(e.dataSet.rows,function(t){return t[1]});_.each(_.keys(f),function(t,a){var n=r(t)+" ("+e.dataSet.columns[1]+")";var l=i(n,a);_.each(f[t],function(t){l.x.push(r(t[0]));l.y.push(t[2])});o.push(l)})}a(function(){var a=l();var e={width:a.width,height:a.height,margin:{t:40,l:60},barmode:"stack",legend:{font:{family:"Roboto"}},xaxis:{title:n,titlefont:{color:"#777",family:"Roboto"},tickfont:{family:"Roboto"}},yaxis:{title:u,titlefont:{color:"#777",family:"Roboto"},tickfont:{family:"Roboto"}},font:{family:"Roboto"}};t.newPlot("bar-view-chart",o,e,{displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"]});h.isDrawing=!1})}}function c(t){return!(!t||!t.rows)&&(2===t.columns.length||3===t.columns.length)}var h=e.asBar={hasData:!1,isDrawing:!1};var f=e.eventsLayout;var d=u.bind(this);f.addUpdateListener(d);e.$on("$destroy",function(){f.removeUpdateListener(d)});e.$watch("dataSet.series",function(){s()});e.$watch("dataSet.slices",function(){s()});var m=null;s()}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("asPie",["plotly","$timeout",function(t,e){var a=["#52E0F1","#DBDA43","#CBCBCB","#FFA9F6","#FFC7B9","#EDBAFF","#FF8E79","#74E068","#FF9F37","#4C96D5","#7BBFFF"];return{restrict:"E",replace:!0,templateUrl:"as_pie.tpl.html",scope:{dataSet:"=",eventsLayout:"="},link:function(i,n){function o(t){return null===t?"null":t.toString()}function r(){return{width:n[0].offsetWidth-15,height:Math.max(n[0].offsetHeight-20,400)}}function l(){e(function(){var e=r();try{t.relayout("pie-view-chart",e)}catch(t){}})}function s(){c.hasData=u(i.dataSet);if(c.hasData&&i.dataSet!==f){c.isDrawing=!0;f=i.dataSet;var n=[];var l={type:"pie",labels:[],values:[],hole:.45,marker:{colors:a,line:{color:"#FFF",width:1}},textinfo:"label"};_.each(i.dataSet.rows,function(t){l.labels.push(o(t[0]));l.values.push(t[1])});n.push(l);e(function(){var e=r();var a={width:e.width,height:e.height,margin:{t:60,l:60},legend:{font:{family:"Roboto"}},font:{family:"Roboto"}};t.newPlot("pie-view-chart",n,a,{displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"]});c.isDrawing=!1})}}function u(t){return!(!t||!t.rows)&&2===t.columns.length}var c=i.asPie={hasData:!1,isDrawing:!1};var h=i.eventsLayout;var d=l.bind(this);h.addUpdateListener(d);i.$on("$destroy",function(){h.removeUpdateListener(d)});i.$watch("dataSet.series",function(){s()});i.$watch("dataSet.slices",function(){s()});var f=null;s()}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("asTimeseries",["plotly","$timeout",function(e,t){var n=["#00A5B6","#C6C62E","#FF9CE8","#FFC7B9","#E1B0FF","#A8A8A8","#FF8672","#4DBB46","#FF942A","#016DA9"];var a=6e4*(new Date).getTimezoneOffset();return{restrict:"E",replace:!0,templateUrl:"as_timeseries.tpl.html",scope:{dataSet:"=",eventsLayout:"="},link:function(r,i){function o(e,t){return{x:[],y:[],type:"scatter",name:e,mode:"lines+markers",marker:{color:n[t%n.length],size:4}}}function s(e,t,n){var r=new Date(t.Time);var i=new Date(r.getTime()-a);var o=i.toISOString().replace("T"," ").slice(0,-1);e.x.push(o);1===t.Rows.length?e.y.push(t.Rows[0][n]):e.y.push(null)}function u(e,t,n,a){var r=o(t,a);_.each(e,function(e){s(r,e,n)});return r}function l(e,t,n,a){var r=o(t,a);_.each(e,function(e){var t=m(e[0]);if(null!==t){r.x.push(t);"number"==typeof e[n]?r.y.push(e[n]):r.y.push(null)}});return r}function c(){return{width:i[0].offsetWidth-15,height:Math.max(i[0].offsetHeight-20,400)}}function f(){t(function(){var t=c();try{e.relayout("timeseries-view-chart",t)}catch(e){}})}function h(){g.hasData=d(r.dataSet);if(g.hasData&&r.dataSet!==p){g.isDrawing=!0;p=r.dataSet;var n=[];if(r.dataSet.rows)_.each(r.dataSet.columns,function(e,t){if(0!==t){var a=l(r.dataSet.rows,e,t,t);n.push(a)}});else if(r.dataSet.slices)_.each(r.dataSet.columns,function(e,t){var a=u(r.dataSet.slices,e,t,t);n.push(a)});else{var a=0;_.each(r.dataSet.series,function(e){var t="";_.each(e.Key,function(e){""!==t&&(t+=" | ");t+=null===e?"null":e});var i=r.dataSet.columns.slice(e.Key.length);_.each(i,function(r,i){var o=t+" ("+r+")";n.push(u(e.Slices,o,i,a));a++})})}t(function(){var t=c();var a={width:t.width,height:t.height,margin:{t:40,l:60},legend:{font:{family:"Roboto"}},xaxis:{tickfont:{family:"Roboto"}},yaxis:{tickfont:{family:"Roboto"},rangemode:"tozero"},font:{family:"Roboto"}};e.newPlot("timeseries-view-chart",n,a,{displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"]});g.isDrawing=!1})}}function m(e){try{if("string"==typeof e){var t=new Date(e);return new Date(t.getTime()-a).toISOString().replace("T"," ").slice(0,-1)}if("number"==typeof e){var n=Math.floor(e/1e4-621355968e5)-a;var r=new Date(n);return r.getFullYear()<2e3||r.getFullYear()>2200?null:r.toISOString().replace("T"," ").slice(0,-1)}return null}catch(e){return null}}function v(e){return _.every(e,function(e){return 0===e.Rows.length||1===e.Rows.length&&_.every(e.Rows[0],function(e){return null===e||"number"==typeof e})})}function d(e){return!!e&&(e.series?_.every(e.series,function(e){return v(e.Slices)}):e.slices?v(e.slices):!!e.rows&&(e.columns.length>1&&e.rows.length>0&&null!==m(e.rows[0][0])))}var g=r.asTimeseries={hasData:!1,isDrawing:!1};var y=r.eventsLayout;var w=f.bind(this);y.addUpdateListener(w);r.$on("$destroy",function(){y.removeUpdateListener(w)});r.$watch("dataSet.series",function(){h()});r.$watch("dataSet.slices",function(){h()});var p=null;h()}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("asTable",function(){return{restrict:"E",replace:!0,templateUrl:"as_table.tpl.html",scope:{dataSet:"=",timePrefs:"="},link:function(e){function t(e,t){if(!e||!t)return null;var n=_.map(e,function(e){return{name:e,cls:""}});var r={name:"time",cls:"timestamp"};if(!t.length)return n.concat([r]);var a=t[0].Key.length;return _.first(n,a).concat([r],_.last(n,e.length-a))}var n=e.timePrefs;var r=e.asTable={seriesColumns:e.dataSet&&e.dataSet.series?t(e.dataSet.columns,e.dataSet.series):null};e.$watch("dataSet.series",function(n,a){n!==a&&(e.dataSet&&e.dataSet.series?r.seriesColumns=t(e.dataSet.columns,e.dataSet.series):r.seriesColumns=null)});r.isNull=function(e){return null===e};r.isScalar=function(e){return"string"==typeof e&&!Seq.EventProperty.isEventId(e)||"number"==typeof e||"boolean"==typeof e};r.isStructure=function(e){return null!==e&&!r.isScalar(e)&&!r.isEventId(e)};r.isEventId=Seq.EventProperty.isEventId;r.formatTime=function(e){var t=new Date(e);return n.formatTimestamp(t)}}}});
"use strict";!function(){function e(a){var i=this;i.isEventId=e.isEventId(a.Value);i.isNumeric="number"==typeof a.Value;i.isNumeric&&(i.isImprecise=a.Value>9007199254740992||a.Value<-9007199254740992);i.isScalar=null===a.Value||"string"==typeof a.Value&&!i.isEventId||i.isNumeric||"boolean"==typeof a.Value;i.isStructure=!i.isScalar&&!i.isEventId;i.name=a.Name;i.value=a.Value;i.displayValue="(nonscalar)";i.isScalar&&(i.displayValue=void 0===i.value||null===i.value||""===i.value?" ":i.value.toString())}e.isEventId=function(e){return"string"==typeof e&&38===e.length&&"event-"===e.slice(0,6)};Seq.EventProperty=e}();
"use strict";!function(){function e(e){this.JSON=e}e.prototype.asTemplate=function(e){var t="";_.each(e,function(e){"string"==typeof e.PropertyName?"string"==typeof e.RawText?t+=e.RawText:t+="{"+_.escape(e.PropertyName)+"}":void 0!==e.Text&&(t+=e.Text||"")});return t};e.prototype.format=function(e,t){var a=this;var n="";_.each(e,function(e){if(void 0!==e.PropertyName&&null!==e.PropertyName){var l=_.find(t,function(t){return e.PropertyName===t.Name});var r=!1;if(void 0===l)n+="{"+e.PropertyName+"}";else{var o;var i=null;if(void 0!==e.FormattedValue&&null!==e.FormattedValue)o=e.FormattedValue;else if(null===l.Value)o="null";else if("string"==typeof l.Value||"number"==typeof l.Value||"boolean"==typeof l.Value)o=l.Value.toString();else{var s=l.Value;if(void 0!==s.$typeTag){s=_.clone(s);i=s.$typeTag;delete s.$typeTag}else if(void 0!==s._typeTag){s=_.clone(s);i=s._typeTag;delete s._typeTag}o=a.JSON.stringify(s);if(o.length>90){o=o.substring(0,90);r=!0}}if(o.length>1024){o=o.substring(0,1024);r=!0}n+=['<span class="token" title="',_.escape(l.Name),'">',null!==i?'<span class="type-tag">'+_.escape(i)+" </span>":"",_.escape(o),r?'<span class="ellipsis">&hellip;</span>':"","</span>"].join("")}}else void 0!==e.Text&&(n+=_.escape(e.Text||""))});return n};Seq.FastTemplateFormatter=e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();!function(){var e=function(){function e(t){_classCallCheck(this,e);this.state={$window:t}}_createClass(e,[{key:"literal",value:function(e){return"string"==typeof e?"'"+e.replace(/'/g,"''")+"'":this.state.$window.JSON.stringify(e)}},{key:"describe",value:function(e){return"string"==typeof e?e:this.state.$window.JSON.stringify(e)}},{key:"property",value:function(e){return this.escapePropertyName(e.name)}},{key:"where",value:function(e){return this.property(e)+" = "+this.literal(e.value)}},{key:"has",value:function(e){return"Has("+this.property(e)+")"}},{key:"strictWhere",value:function(e){return"Equal("+this.property(e)+","+this.literal(e.value)+")"}},{key:"escapePropertyName",value:function(e){if("string"!=typeof e||0===e.length)return"?";for(var t=0;t<e.length;++t){var r=e[t];if("_"!==r&&(r<"0"||r>"9")&&(r<"A"||r>"z"))return"@Properties["+this.literal(e)+"]"}return e[0]>="0"&&e[0]<="9"?"@Properties["+this.literal(e)+"]":e}},{key:"whereEventType",value:function(e){return"@EventType = 0x"+e.substring(1)}}]);return e}();Seq.FilterSyntax=e}();
"use strict";var _module=angular.module("seq-ui2");_module.directive("eventActions",["downloader","$window","session","toast",function(e,t,n,r){var i=new Seq.FastTemplateFormatter(t.JSON);return{restrict:"E",replace:!0,templateUrl:"event_actions.tpl.html",scope:{model:"=",eventsControl:"="},link:function(l){var s=l.model;var o=l.eventsControl;var a=l.eventActions={model:s,showPermalink:!1,appInstances:o.appInstances};a.clause={thisType:{filter:"@EventType = 0x"+s.EventType.substring(1),description:Seq.Text.truncate(i.asTemplate(s.MessageTemplateTokens),30)},thisTypeByTemplate:{filter:"@EventType = ToEventType('"+i.asTemplate(s.MessageTemplateTokens).replace(/'/g,"''")+"')",description:Seq.Text.truncate(i.asTemplate(s.MessageTemplateTokens),30)},thisId:{filter:"@Id = '"+s.Id+"'",description:s.Id},arrivedBefore:{filter:"@Arrived <= Arrived('"+s.Id+"')",description:"Arrived before "+s.Id},arrivedNear:{filter:"@Arrived <= 10 + Arrived('"+s.Id+"')",description:"Arrived near "+s.Id},levelOnAnyType:{filter:"@Level = '"+s.Level+"'",description:s.Level+" events"},levelBelow:{filter:Seq.EventLevel.below(s.Level),description:Seq.EventLevel.nextDown(s.Level)+" events and below"}};a.filter=function(e){o.filter(e.filter)};a.query=function(e){o.filter(e.query,e.view)};a.exclude=function(e){o.exclude(e)};a.plotOccurrences=function(e){return{query:"select count(*) from stream where "+e.filter+" group by time(1h)",view:"timeseries"}};a.rawJson=function(){var n=t.UriTemplate.parse(a.model.Links.Self).expand({download:!0,clef:!0,render:!0});e.get(n)};n.then(function(e){a.permalink=function(){var t={OwnerId:e.user.Id,EventId:s.Id};return e.api.permalinks.create(t).then(function(){r.success("Permalink created");a.showPermalink=!0})};a.invokeApp=function(e){a.notifyingAppInstance=e}})}}}]);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();var _module=angular.module("seq-ui2");_module.directive("eventProperties",["$window",function(e){var t=new Seq.FilterSyntax(e);var r=function(){function e(){_classCallCheck(this,e)}_createClass(e,[{key:"link",value:function(){this.nextTag=this.tagAllocator.next();this.properties=this.model.Properties.map(function(e){return new Seq.EventProperty(e)})}},{key:"filter",value:function(e){this.eventsControl.filter(e.filter)}},{key:"filterWithSignal",value:function(e){this.eventsControl.filterWithSignal(e)}},{key:"query",value:function(e){this.eventsControl.filter(e.query,e.view)}},{key:"exclude",value:function(e){this.eventsControl.exclude(e)}},{key:"propertyOnAnyType",value:function(e){return{filter:t.where(e),strictFilter:t.strictWhere(e),defaultSignalName:Seq.Text.truncate(t.describe(e.value),30)}}},{key:"propertyOnThisType",value:function(e){return{filter:t.whereEventType(this.model.EventType)+" and "+t.where(e)}}},{key:"hasPropertyOnAnyType",value:function(e){return{filter:t.has(e)}}},{key:"canTag",value:function(e){return!this.signalEditor.open||!this.signalEditor.open.TaggedProperties.find(function(t){return t.PropertyName===e.name})}},{key:"countByValue",value:function(e){return{query:"select count(*) from stream where "+t.property(e)+" is not null group by "+t.property(e),view:"pie"}}},{key:"valueByTime",value:function(e){var r=t.property(e);return{query:"select @Timestamp, "+r+" from stream where "+r+" is not null",view:"timeseries"}}},{key:"numericAggregates",value:function(e){var r=t.property(e);return{query:"select min("+r+"), max("+r+"), mean("+r+"), percentile("+r+", 90) from stream group by time(1h)",view:"timeseries"}}},{key:"showAsTag",value:function(e){this.tagAllocator.allocate(e.name);this.signalEditor.addTag(e.name)}}]);return e}();return Seq.component("eventProperties",r,{model:"=",eventsControl:"=",tagAllocator:"=",signalEditor:"="})}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("eventTimestamp",function(){return{restrict:"E",replace:!0,templateUrl:"event_timestamp.tpl.html",scope:{value:"=",timePrefs:"="},link:function(e){var t=e.eventTimestamp={};var r=new Seq.DateTimeOffset(e.value);var a=r.localDateTime;t.dayPart=e.timePrefs.formatDay(a);t.yearPart=e.timePrefs.formatYear(a);t.timePart=e.timePrefs.formatTime(a);t.isoString=e.timePrefs.formatIso(a)}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("renderedMessage",["$sce","$window",function(e,r){return{restrict:"E",replace:!0,templateUrl:"rendered_message.tpl.html",scope:{template:"=",properties:"="},link:function(t){var a=t.renderedMessage={};var s=new Seq.FastTemplateFormatter(r.JSON);var l=s.format(t.template,t.properties);a.html=e.trustAsHtml(l)}}}]);
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(n,t,i){t&&e(n.prototype,t);i&&e(n,i);return n}}();var _module=angular.module("seq-ui2");_module.directive("sendToAppDialog",["session","toast","$q",function(e,n,t){var i=function(){function i(){_classCallCheck(this,i)}_createClass(i,[{key:"link",value:function(e){var n=this;e.$watch("sendToAppDialog.appInstance",function(e,t){if(e&&!t){n.prepareToOpen();n.overridableSettings.length<1&&n.sendToApp()}})}},{key:"prepareToOpen",value:function(){this.sending=new Seq.Busy(t,"send event to app");this.overriddenSettings={}}},{key:"sendToApp",value:function(){var t=this;var i=this.instance.title;return this.sending.until(e.then(function(e){return e.api.appInstances.invoke(t.instance.entity,t.eventEntity.Id,t.overriddenSettings)})).then(function(){n.success("Sent event to "+i);t.close()})}},{key:"close",value:function(){this.appInstance=null}},{key:"isVisible",get:function(){return!!this.appInstance&&(this.overridableSettings.length>0||this.sending.error)},set:function(e){}},{key:"instance",get:function(){return this.appInstance||{}}},{key:"overridableSettings",get:function(){return this.instance.invocationOverridableSettingDefinitions||[]}}]);return i}();return Seq.component("sendToAppDialog",i,{eventEntity:"=",appInstance:"="})}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("taggedProperties",function(){return{restrict:"E",replace:!0,templateUrl:"tagged_properties.tpl.html",scope:{properties:"=",tagAllocator:"="},link:function(e){var t=e.taggedProperties={tags:[]};var r=_.chain(e.properties).map(function(e){return new Seq.EventProperty(e)}).indexBy("name").value();var a=e.tagAllocator;var n=function(){var e=a.getAll();t.tags=_.chain(e).filter(function(e){return r.hasOwnProperty(e.propertyName)}).map(function(e){return{name:e.propertyName,index:e.index,value:r[e.propertyName].displayValue}}).value();t.show=t.tags.length>0};var o=a.listen(function(){n()});e.$on("$destroy",function(){o()});n()}}});
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(t,o){var e=this;if("object"!==(void 0===t?"undefined":_typeof(t)))throw new Error("A completion source is required");e.source=t;e.lastQuery="";e.options=_.clone(o||{});e.options.maxSuggestions=e.options.maxSuggestions||10;e.options.maxBacktracks=e.options.maxBacktracks||2}t.prototype.suggest=function(t,o){var e=this;if("string"!=typeof t)throw new Error("Completion tokens must be strings");o=o||{};o.syntax=o.syntax||Seq.Syntax.FILTER;var n=e.source.fromPrefix(t,{max:e.options.maxSuggestions,syntax:o.syntax});var s=[];e.lastQuery.length>0&&-1!==t.lastIndexOf(e.lastQuery)&&(s=_.chain(e.source.fromPrefix(e.lastQuery,{max:e.options.maxBacktracks,syntax:e.lastSyntax})).difference(n).value());e.lastQuery=t;e.lastSyntax=o.syntax;return{matches:n,backtracks:s}};Seq.Completion=t}();
"use strict";!function(){function t(){this.activateListeners=[]}t.prototype.onActivate=function(t){this.activateListeners.push(t)};t.prototype.activate=function(){var t=this;_.each(t.activateListeners,function(t){t()})};Seq.FilterState=t}();
"use strict";!function(){function t(){}var r={" ":!0,"\r":!0,"\n":!0,"\t":!0,"(":!0,"=":!0,"<":!0,">":!0};t.prototype.lastIncompleteToken=function(t){if("string"!=typeof t)throw new Error("Partial filters must be strings");if(0===t.length||!t[t.length-1].match(/[A-z0-9_@]/))return null;for(var e=t.length-1;e>=0;--e){var n=t[e];if(!n.match(/[A-z0-9_@]/))return r[n]?t.slice(e+1):null}return t};Seq.FilterTokenizer=t}();
"use strict";!function(){function E(){}E.INDETERMINATE="INDETERMINATE";E.FILTER="FILTER";E.QUERY="QUERY";E.TEXT="TEXT";E.detect=function(e){var t=e.toLowerCase().replace(/^\s+/,"");return 0===t.indexOf("select ")||0===t.indexOf("select\n")?E.QUERY:t==="select".substr(0,t.length)?E.INDETERMINATE:E.FILTER};E.isCompatible=function(e,t){if(t===E.INDETERMINATE)return e===E.INDETERMINATE||e===E.FILTER;if(t===E.FILTER)return e===E.FILTER;if(t===E.QUERY)return e===E.QUERY||e===E.FILTER;throw new Error("Unrecognized required syntax: "+t)};Seq.Syntax=E}();
"use strict";var _module=angular.module("seq-ui2");_module.directive("autocomplete",function(){return{restrict:"E",replace:!0,scope:{suggestions:"=",complete:"&"},templateUrl:"autocomplete.tpl.html",link:function(e){e.autocomplete={};e.autocomplete.select=function(t){e.complete({$opt:t})}}}});
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var s=0;s<n.length;s++){var t=n[s];t.enumerable=t.enumerable||!1;t.configurable=!0;"value"in t&&(t.writable=!0);Object.defineProperty(e,t.key,t)}}return function(n,s,t){s&&e(n.prototype,s);t&&e(n,t);return n}}();var _module=angular.module("seq-ui2");_module.directive("dashboardPicker",["session",function(e){var n=function(){function n(){var s=this;_classCallCheck(this,n);this.dashboards=null;e.then(function(e){s.seq=e}).then(function(){return s.reloadList()})}_createClass(n,[{key:"reloadList",value:function(){var e=this;this.seq.api.dashboards.list({ownerId:this.seq.user.Id,shared:this.seq.user.IsAdministrator}).then(function(n){e.dashboards=e.dashboards||[];e.dashboards.length=0;_.each(n,function(n){return e.dashboards.push(n)})})}},{key:"choose",value:function(e){this.onSelected({$dashboard:e});this.isVisible=!1}},{key:"chooseNew",value:function(){this.onSelected({$dashboard:{Id:null}});this.isVisible=!1}},{key:"link",value:function(e,n){var s=this;e.$on("document:clicked",function(e,t){var i=t;for(;0!==i.length;){if(i[0]===n[0])return;i=i.parent()}s.isVisible=!1})}}]);return n}();return Seq.component("dashboardPicker",n,{onSelected:"&",isVisible:"="})}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("filterBox",["$timeout",function(e){function t(e,t){if(null===e||"string"!=typeof e)return!1;if(t&&e.length>40){var n=t.getScrollerElement();if(n&&n.children[0]&&n.children[0].offsetHeight>30)return!0}return-1!==e.indexOf("\n")||-1!==e.indexOf("\n")}function n(e){return e===Seq.Syntax.TEXT?"text":e===Seq.Syntax.QUERY?"text/x-seq-sql":"text/x-seq-filter"}return{restrict:"E",replace:!0,templateUrl:"filter_box.tpl.html",scope:{filterState:"=",filter:"=",change:"&",keydown:"&",submit:"&",eventsLayout:"=",syntax:"="},link:function(i,l){var r=i.eventsLayout;r.multiline=t(i.filter,null);var o=i.filterBox={cmFocused:!1};var u=CodeMirror(l[0],{mode:n(i.syntax),theme:"seq",value:i.filter,tabindex:980,lineWrapping:!0,scrollbarStyle:"null"});e(function(){u.setCursor(u.lineCount(),0);u.refresh();u.focus();e(function(){r.multiline=t(i.filter,u)})},100);i.filterState.onActivate(function(){u.focus()});r.addUpdateListener(function(){e(function(){u.refresh();e(function(){r.multiline=t(i.filter,u);e(function(){u.refresh()})})})});i.$watch("filter",function(){if(i.filter!==u.getValue()){u.setValue(i.filter);u.setCursor(u.lineCount(),0);r.multiline=t(i.filter,u);e(function(){u.refresh();u.focus()})}});i.$watch("syntax",function(e){u.setOption("mode",n(e))});u.on("change",function(){u.getValue()!=i.filter&&e(function(){i.filter=u.getValue();r.multiline=t(i.filter,u);e(function(){i.change()})})});u.on("keydown",function(e,t){if(!(t.keyCode>=37&&t.keyCode<=40))if(13==t.keyCode)if(t.ctrlKey){var n=u.getDoc();n.replaceSelection("\n")}else{t.preventDefault();i.$apply(function(){i.submit()})}else i.$apply(function(){i.keydown({$event:t})})});u.on("focus",function(){e(function(){o.cmFocused=!0})});u.on("blur",function(){e(function(){o.cmFocused=!1})})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("addSignal",["busy","session",function(e,n){return{restrict:"E",replace:!0,templateUrl:"add_signal.tpl.html",scope:{isVisible:"=",signals:"=",onAdded:"&",onCreate:"&"},link:function(i){var t=i.addSignal={filter:"",signals:i.signals,adding:e.create("add signal"),onCreate:i.onCreate,onAdded:i.onAdded};i.$watch("signals",function(e){t.signals=e});t.close=function(){i.isVisible=!1};t.create=function(){t.onCreate({$title:t.filter});t.filter="";i.isVisible=!1};t.add=function(e){return t.adding.until(n.then(function(n){return n.api.signals.addWatch(e.entity).then(function(){e.entity.IsWatched=!0;t.close();t.onAdded({$value:e})})}))}}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("addQuery",["busy","session",function(e,i){return{restrict:"E",replace:!0,templateUrl:"add_query.tpl.html",scope:{isVisible:"=",queries:"=",onAdded:"&",onCreate:"&"},link:function(t){var n=t.addQuery={filter:"",queries:t.queries,adding:e.create("add signal"),onCreate:t.onCreate,onAdded:t.onAdded};n.close=function(){t.isVisible=!1};n.create=function(){n.onCreate({$title:n.filter});n.filter="";t.isVisible=!1};n.add=function(e){return n.adding.until(i.then(function(i){return i.api.sqlQueries.addUser(e.entity).then(function(){e.entity.Show=!0;n.close();n.onAdded({$value:e})})}))}}}}]);
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(t,n.key,n)}}return function(e,i,n){i&&t(e.prototype,i);n&&t(e,n);return e}}();!function(){var t=function(){function t(e,i,n,a,r,s,o,l){_classCallCheck(this,t);this.$q=e;this.$timeout=i;this.session=n;this.streamSlice=a;this.queryEditor=r;this.eventsControl=s;this.signalEditor=o;this.tagAllocator=l;this.state=new Seq.SignalBarState;this.queries=[];this.loading=new Seq.Busy(e,"load signals and queries");this.loadingToEdit=new Seq.Busy(e,"edit signal or query")}_createClass(t,[{key:"refresh",value:function(){this.updateSlice();this.eventsControl.refresh()}},{key:"updateSlice",value:function(){this.streamSlice.signal=this.state.activatedSignalExpression()}},{key:"toggle",value:function(t,e){var i=this;if(!this.state.isEditingSignal(t.id)){if(t.activated){this.state.deactivateSignal(t.id);t.taggedProperties.forEach(function(t){return i.tagAllocator.deallocate(t.PropertyName)})}else{this.state.activateSignal(t.id);t.taggedProperties.forEach(function(t){return i.tagAllocator.allocate(t.PropertyName)})}e||this.refresh()}}},{key:"toggleDefaults",value:function(t){this.state.activateDefaultSignals();t||this.refresh()}},{key:"toggleNone",value:function(t){this.state.deactivateAllSignals();t||this.refresh()}},{key:"activate",value:function(t){this.state.activateSignal(t.id)}},{key:"isEditingSignal",value:function(t){return this.state.isEditingSignal(t.id)}},{key:"edit",value:function(t,e){var i=this;var n=e||this.signalEditor.open;if(this.signalEditor.open){this.signalEditor.open.TaggedProperties.forEach(function(t){return i.tagAllocator.deallocate(t.PropertyName)});if(this.signalEditor.open.Id){var a=this.state.findSignal(this.signalEditor.open.Id);a&&a.taggedProperties.forEach(function(t){return i.tagAllocator.allocate(t.PropertyName)})}}this.loadingToEdit.until(this.signalEditor.edit(t).then(function(){if(e){i.signalEditor.open.TaggedProperties.forEach(function(t){return i.tagAllocator.allocate(t.PropertyName)});var a=i.state.findSignal(t);a&&a.taggedProperties.forEach(function(t){return i.tagAllocator.deallocate(t.PropertyName)})}n&&i.eventsControl.refresh()}))}},{key:"editItem",value:function(t){this.uneditQuery();this.edit(t.id,!t.isIntersected);this.state.editSignal(t.id);this.updateSlice()}},{key:"editQueryItem",value:function(t){var e=this;this.unedit();this.$timeout(function(){t.isEditing=!0;t.isActive=!1;e.loadingToEdit.until(e.queryEditor.edit(t.entity.Id).then(function(){e.queryEditor.open&&e.eventsControl.loadQuery(e.queryEditor.open.Sql)}))})}},{key:"activateQuery",value:function(t){this.uneditQuery();this.queries.forEach(function(e){e!==t&&(e.isActive=!1)});t.isActive=!0;this.eventsControl.loadQuery(t.entity.Sql)}},{key:"clearAll",value:function(){this.state.deactivateAllSignals();this.state.stopEditingSignal();this.signalEditor.open?this.unedit():this.refresh();this.tagAllocator.reset()}},{key:"uneditQuery",value:function(){if(this.queryEditor.open){this.queryEditor.clear();this.queries.forEach(function(t){t.isEditing=!1})}}},{key:"unedit",value:function(t){var e=this;this.uneditQuery();var i=t||this.signalEditor.open;if(null!==i){this.signalEditor.clear();if(i.Id){var n=this.state.findSignal(i.Id);n&&n.taggedProperties.forEach(function(t){return e.tagAllocator.allocate(t.PropertyName)})}i.TaggedProperties.forEach(function(t){return e.tagAllocator.deallocate(t.PropertyName)});this.state.stopEditingSignal();this.eventsControl.refresh()}}},{key:"switchEditorToClone",value:function(t){var e=this.signalEditor.open;if(e){this.signalEditor.clear();this.state.stopEditingSignal();this.state.deactivateSignal(e.Id);var i=t.JSON.parse(t.JSON.stringify(e));i.Title=i.Title+" (clone)";i.Id=null;i.Links={Create:"api/signals/"};this.signalEditor.replace(i)}}},{key:"create",value:function(t){this.unedit();this.signalEditor.create(t);this.eventsControl.refresh()}},{key:"createQuery",value:function(t){var e=this;this.unedit();this.queryEditor.create(t).then(function(){e.eventsControl.loadQuery(e.queryEditor.open.Sql)})}},{key:"onSaved",value:function(t){var e=this.tryGetDefaultGroupName(t);var i=this.state.findSignal(t.Id);var n=i&&i.group!==e;this.state.addOrUpdateSignalEntity(t).updateSignalGroup(t.Id,e).activateSignal(t.Id).editSignal(t.Id);this.updateSlice();n&&this.eventsControl.refresh()}},{key:"onDeleted",value:function(t){this.state.removeSignal(t.Id);this.refresh()}},{key:"onRemoved",value:function(t){this.state.unwatchSignal(t.Id);this.refresh()}},{key:"onSavedQuery",value:function(t){var e=this.queries.find(function(e){return e.entity.Id===t.Id});if(e)e.entity=t;else{this.queries.push({entity:t,isEditing:this.queryEditor.open&&this.queryEditor.open.Id===t.Id});this.queries.sort(function(t,e){return t.entity.Title.localeCompare(e.entity.Title)})}}},{key:"onDeletedQuery",value:function(t){var e=this.queries.find(function(e){return e.entity.Id===t.Id});if(e){e.isEditing=!1;this.queries.splice(this.queries.indexOf(e),1)}}},{key:"onRemovedQuery",value:function(t){var e=this.queries.find(function(e){return e.entity.Id===t.Id});if(e){e.isEditing=!1;e.entity.Show=!1}}},{key:"tryGetDefaultGroupName",value:function(t){return Seq.SignalEntity.tryGetDefaultGroupName(t)}},{key:"load",value:function(){var t=this;return this.session.then(function(e){return t.$q.all([t.loadSignals(e),t.loadQueries(e)])})}},{key:"loadSignals",value:function(t){var e=this;return t.api.signals.list().then(function(i){var n=Seq.SignalExpressionParser.parse((t.user.Preferences.DefaultSignal||"").trim());var a=i.map(function(t){var i=e.tryGetDefaultGroupName(t);var n=e.state.findSignal(t.Id);if(n){if(n.activated||e.state.isEditingSignal(t.Id)){t.TaggedProperties.forEach(function(t){return e.tagAllocator.allocate(t.PropertyName)});n.taggedProperties.forEach(function(t){return e.tagAllocator.deallocate(t.PropertyName)});n.updateEntity(t)}return n}var a=e.streamSlice.signal.references(t.Id);var r=new Seq.SignalBarSignal({entity:t,state:{activated:a,group:i}});(a||e.state.isEditingSignal(t.Id))&&t.TaggedProperties.forEach(function(t){return e.tagAllocator.allocate(t.PropertyName)});return r});var r=e.streamSlice.signal;e.state=new Seq.SignalBarState(_extends({},e.state.state,{signals:a,defaults:n,inputExpression:r}))})}},{key:"loadQueries",value:function(t){var e=this;return t.api.sqlQueries.list().then(function(t){e.queries=e.queries||[];var i=t.sort(function(t,e){return t.Title.localeCompare(e.Title)}).map(function(t){var i=e.queries.find(function(e){return e.entity.Id===t.Id});i?i.entity=t:i={entity:t,isEditing:!1};return i});e.queries.length=0;i.forEach(function(t){e.queries.push(t)})})}},{key:"signals",get:function(){return this.state.allSignals}},{key:"groupedSignals",get:function(){return this.state.watchedGroupedSignals}},{key:"ungroupedSignals",get:function(){return this.state.watchedUngroupedSignals}},{key:"items",get:function(){return this.state.items}},{key:"hasDefaults",get:function(){return this.state.hasDefaults}}]);return t}();Seq.SignalBar=t}();
"use strict";function _toConsumableArray(r){if(Array.isArray(r)){for(var n=0,e=Array(r.length);n<r.length;n++)e[n]=r[n];return e}return Array.from(r)}function _defineProperty(r,n,e){n in r?Object.defineProperty(r,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[n]=e;return r}function _classCallCheck(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=e[a])}return r};var _createClass=function(){function r(r,n){for(var e=0;e<n.length;e++){var a=n[e];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(r,a.key,a)}}return function(n,e,a){e&&r(n.prototype,e);a&&r(n,a);return n}}();!function(){var r=function(r){return!r||""===r};var n=function(){function n(){_classCallCheck(this,n)}_createClass(n,null,[{key:"collectSignalGroups",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Seq.SignalExpression([]);var a={bySignal:{},byGroup:{}};var u=n.reduce(function(n,e){if(r(e.group))return n;var a=n.bySignal,u=n.byGroup;return{bySignal:_extends({},a,_defineProperty({},e.id,e.group)),byGroup:_extends({},u,_defineProperty({},e.group,[].concat(_toConsumableArray(u[e.group]||[]),[e])))}},a);var t={virtualGroupedSignals:{ctr:1,bySignal:{},byGroup:{}},virtualUngroupedSignals:[]};var o=e.flatten().reduce(function(r,n){var e=r.virtualGroupedSignals,a=r.virtualUngroupedSignals;if(n.length<=1)return{virtualGroupedSignals:e,virtualUngroupedSignals:[].concat(_toConsumableArray(a),_toConsumableArray(n))};var u=e.ctr,t=e.bySignal,o=e.byGroup;return{virtualUngroupedSignals:a,virtualGroupedSignals:{ctr:u+1,bySignal:n.reduce(function(r,n){return _extends({},r,_defineProperty({},n,u))},t),byGroup:_extends({},o,_defineProperty({},u,[].concat(_toConsumableArray(o[u]||[]),_toConsumableArray(n))))}}},t),i=o.virtualGroupedSignals,l=o.virtualUngroupedSignals;var g={groupedSignalsMap:{},ungroupedSignals:[]};var s=n.reduce(function(n,a){var t=n.groupedSignalsMap,o=n.ungroupedSignals;var g=function(){return{groupedSignalsMap:t,ungroupedSignals:[].concat(_toConsumableArray(o),[a])}};var s=function(r,n){return{ungroupedSignals:o,groupedSignalsMap:_extends({},t,_defineProperty({},r,{isVirtual:n,signals:[].concat(_toConsumableArray((t[r]||{}).signals||[]),[a])}))}};var p=!r(a.group);var c=p&&1===u.byGroup[a.group].length;if(e.referencedSignalIds.includes(a.id)){if(l.includes(a.id)){if(c)return g();var f=l.some(function(r){return r!==a.id&&u.bySignal[r]===a.group});if(p&&f)return g()}var d=i.bySignal[a.id];if(!r(d)){if(r(a.group))return s(d,!0);if(i.byGroup[d].map(function(r){return u.bySignal[r]}).some(function(r){return r!==a.group}))return s(d,!0)}}return r(a.group)||c?g():s(a.group,!1)},g),p=s.groupedSignalsMap,c=s.ungroupedSignals;var f={groups:[],virtualCtr:1};var d=Object.keys(p).reduce(function(r,n){var e=r.groups,a=r.virtualCtr;var u=p[n];if(u.isVirtual){var t="Group "+a;return{virtualCtr:a+1,groups:[].concat(_toConsumableArray(e),[_extends({group:t},u)])}}return{virtualCtr:a,groups:[].concat(_toConsumableArray(e),[_extends({group:n},u)])}},f).groups.sort(function(r,n){return r.isVirtual===n.isVirtual?r.group.localeCompare(n.group):r.isVirtual?-1:1});return{groupedSignals:d,ungroupedSignals:c,items:d.map(function(r){return new Seq.SignalBarItem({group:r})}).concat(c.map(function(r){return new Seq.SignalBarItem({signal:r})})).sort(Seq.SignalBarItem.compare)}}}]);return n}();Seq.SignalBarGroupBuilder=n}();
"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(n,i.key,i)}}return function(t,e,i){e&&n(t.prototype,e);i&&n(t,i);return t}}();!function(){var n=function(){function n(t){var e=t.signal,i=t.group;_classCallCheck(this,n);if(!e&&!i)throw new Error("An item must be a signal or a group.");if(e&&i)throw new Error("An item must be either a signal or a group, not both.");if(e){this.signal=e;this.group=null;this.trackingKey="s#"+e.id}else{this.group=i;this.signal=null;this.trackingKey="g#"+i.group+"-"+i.signals.length}}_createClass(n,[{key:"title",get:function(){return this.signal?this.signal.title:this.group.group}}],[{key:"compare",value:function(n,t){var e=n.title.localeCompare(t.title);return 0!==e?e:n.signal&&t.signal?n.signal.id.localeCompare(t.signal.id):n.signal?-1:1}}]);return n}();Seq.SignalBarItem=n}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(t,i.key,i)}}return function(e,n,i){n&&t(e.prototype,n);i&&t(e,i);return e}}();!function(){var t={Id:null,Title:"",IsWatched:!0,Filters:[],TaggedProperties:[]};var e={group:null,activated:!1};var n=function(){function n(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{entity:{},state:{}},a=i.entity,r=i.state;_classCallCheck(this,n);this.state=_extends({},e,r);this.entity=_extends({},t,a)}_createClass(n,[{key:"toggle",value:function(){this.state=_extends({},this.state,{activated:!this.state.activated});return this}},{key:"activate",value:function(){this.state=_extends({},this.state,{activated:!0});return this}},{key:"deactivate",value:function(){this.state=_extends({},this.state,{activated:!1});return this}},{key:"watch",value:function(){this.entity=_extends({},this.entity,{IsWatched:!0});return this}},{key:"unwatch",value:function(){this.entity=_extends({},this.entity,{IsWatched:!1});return this}},{key:"updateEntity",value:function(t){this.entity=t;return this}},{key:"updateGroup",value:function(t){this.state=_extends({},this.state,{group:t});return this}},{key:"id",get:function(){return this.entity.Id}},{key:"title",get:function(){return this.entity.Title}},{key:"group",get:function(){return this.state.group}},{key:"activated",get:function(){return this.state.activated}},{key:"isWatched",get:function(){return this.entity.IsWatched}},{key:"filters",get:function(){return this.entity.Filters}},{key:"taggedProperties",get:function(){return this.entity.TaggedProperties}}],[{key:"compare",value:function(t,e){var n=t.title.localeCompare(e.title);return 0===n?t.id.localeCompare(e.id):n}}]);return n}();Seq.SignalBarSignal=n}();
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(t,i.key,i)}}return function(n,e,i){e&&t(n.prototype,e);i&&t(n,i);return n}}();!function(){var t=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Seq.SignalExpression([]);var e=t.filter(function(t){return t.isWatched||n.referencedSignalIds.includes(t.id)});return Seq.SignalBarGroupBuilder.collectSignalGroups(e,n)};var n={signals:[],defaults:new Seq.SignalExpression([]),editingSignal:null,inputExpression:new Seq.SignalExpression([])};var e=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;_classCallCheck(this,e);var a=[].concat(_toConsumableArray(i.signals)).sort(Seq.SignalBarSignal.compare);var r=t(a,i.inputExpression);this.state=_extends({},n,i,r,{signals:a})}_createClass(e,[{key:"findSignal",value:function(t){return this.allSignals.find(function(n){return n.id===t})}},{key:"signalExpression",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(t){return!0};var n=this.watchedGroupedSignals.map(function(n){var e=(n.group,n.signals);var i=e.filter(t);return 0===i.length?null:new Seq.IntersectedSignalExpression(i.map(function(t){return t.id}))}).filter(function(t){return null!==t});var e=this.watchedUngroupedSignals.filter(t).map(function(t){return new Seq.IntersectedSignalExpression([t.id])});var i=[].concat(_toConsumableArray(e),_toConsumableArray(n));return new Seq.SignalExpression(i)}},{key:"activatedSignalExpression",value:function(){return this.signalExpression(function(t){return t.activated})}},{key:"defaultSignals",value:function(){var t=this;return this.allSignals.filter(function(n){return t.state.defaults.references(n.id)})}},{key:"activatedSignals",value:function(){return this.allSignals.filter(function(t){return t.activated})}},{key:"deactivatedSignals",value:function(){return this.allSignals.filter(function(t){return!t.activated})}},{key:"allGroups",value:function(){return this.watchedGroupedSignals.map(function(t){var n=t.group;t._;return n})}},{key:"isEditingSignal",value:function(t){return this.isEditingAnySignal&&this.state.editingSignal===t}},{key:"toggleSignal",value:function(t){var n=this.findSignal(t);return n?n.activated?this.deactivateSignal(n.id):this.activateSignal(n.id):this}},{key:"activateSignal",value:function(t){var n=this.findSignal(t);return n?this.putSignal(n.activate()):this}},{key:"deactivateSignal",value:function(t){var n=this.findSignal(t);n&&this.putSignal(n.deactivate(),this.activatedSignalExpression().withoutReference(t));return this}},{key:"activateDefaultSignals",value:function(){var n=this;var e=this.state.signals.map(function(t){return n.state.defaults.references(t.id)?t.activate():t.deactivate()});this.state=_extends({},this.state,t(e,this.state.defaults),{signals:e});return this}},{key:"deactivateAllSignals",value:function(){var n=this.state.signals.map(function(t){return t.deactivate()});this.state=_extends({},this.state,{signals:n},t(n));return this}},{key:"putSignal",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activatedSignalExpression();var i=[].concat(_toConsumableArray(this.state.signals.filter(function(t){return t.id!==n.id})),[n]).sort(Seq.SignalBarSignal.compare);this.state=_extends({},this.state,t(i,e),{signals:i});return this}},{key:"addOrUpdateSignalEntity",value:function(t){var n=this.findSignal(t.Id);return n?this.putSignal(n.updateEntity(t)):this.putSignal(new Seq.SignalBarSignal({entity:t}))}},{key:"updateSignalGroup",value:function(t,n){var e=this.findSignal(t);return e?this.putSignal(e.updateGroup(n)):this}},{key:"removeSignal",value:function(n,e){var i=this.state.signals.filter(function(t){return t.id!==n});this.state=_extends({},this.state,t(i,this.activatedSignalExpression().withoutReference(n)),{signals:i});return this}},{key:"unwatchSignal",value:function(t){var n=this.findSignal(t);return n?this.putSignal(n.deactivate().unwatch(),this.activatedSignalExpression().withoutReference(t)):this}},{key:"editSignal",value:function(t){this.state.editingSignal=t;return this}},{key:"stopEditingSignal",value:function(){this.state.editingSignal=null;return this}},{key:"allSignals",get:function(){return this.state.signals}},{key:"watchedGroupedSignals",get:function(){return this.state.groupedSignals}},{key:"watchedUngroupedSignals",get:function(){return this.state.ungroupedSignals}},{key:"items",get:function(){return this.state.items}},{key:"hasDefaults",get:function(){return!this.state.defaults.isEmpty}},{key:"isEditingAnySignal",get:function(){return null!==this.state.editingSignal}}]);return e}();Seq.SignalBarState=e}();
"use strict";var _module=angular.module("seq-ui2");_module.directive("currentQuery",["busy","messageBox","session",function(e,n,r){return{restrict:"E",replace:!0,scope:{queryEditor:"=editor",signalBar:"="},templateUrl:"current_query.tpl.html",link:function(t){var u=t.signalBar;var i=t.queryEditor;var o=t.currentQuery={saving:e.create("save current query")};r.then(function(e){t.seq=e});o.save=function(){if(i.dirty)return o.saving.until(i.save().then(function(e){u.onSavedQuery(e)}))};o.del=function(){var e=i.open;return n.confirm("Delete the current query? To hide it from your personal list, use Remove instead.").then(function(){return o.saving.until(i.del().then(function(){u.unedit();e.Id&&u.onDeletedQuery(e)}))})};o.close=function(){u.unedit()};o.remove=function(){var e=i.open;return o.saving.until(r.then(function(n){return n.api.sqlQueries.removeUser(e).then(function(){e.Show=!1;u.unedit();u.onRemovedQuery(e)})}))}}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("currentSignal",["busy","messageBox","session","$window",function(e,t,n,r){return{restrict:"E",replace:!0,scope:{signalEditor:"=editor",tagAllocator:"=",eventsControl:"=",signalBar:"=",filterCache:"="},templateUrl:"current_signal.tpl.html",link:function(i){var o=i.signalBar;var a=i.tagAllocator;var l=i.signalEditor;var c=i.eventsControl;var u=i.filterCache;var s=i.currentSignal={saving:e.create("save current signal"),editingRaw:!1};n.then(function(e){i.seq=e});s.toggleRestricted=function(){l.toggleRestricted()};s.tagNumber=function(e){return a.isAllocated(e.PropertyName)?a.getFor(e.PropertyName):""};s.updateFilter=function(e,t){var n=e.FilterNonStrict||e.Filter;return u.toStrict(t).then(function(r){if(e.Filter!==r.StrictExpression||t!==n){var i={Filter:r.StrictExpression,FilterNonStrict:t};l.updateFilter(e,i);c.refresh()}})};s.removeFilter=function(e){l.removeFilter(e);c.refresh()};s.removeTag=function(e){l.removeTag(e);a.deallocate(e.PropertyName)};s.save=function(){if(l.dirty)return s.saving.until(l.save().then(function(e){o.onSaved(e)}))};s.del=function(){var e=l.open;return t.confirm("Delete the current signal? To hide it from your personal list, use Remove instead.").then(function(){return s.saving.until(l.del().then(function(){o.unedit(e);e.Id&&o.onDeleted(e);c.refresh()}))})};s.close=function(){o.unedit()};s.remove=function(){var e=l.open;return s.saving.until(n.then(function(t){return t.api.signals.removeWatch(e).then(function(){e.IsWatched=!1;o.unedit();o.onRemoved(e);c.refresh()})}))};s.editedRaw=function(e){e.Id=l.open.Id;l.replace(e)};s.switchToClone=function(){o.switchEditorToClone(r)}}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("footer",["session",function(e){return{restrict:"E",replace:!1,templateUrl:"footer.tpl.html",scope:{},link:function(t){e.then(function(e){t.seq=e})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("queryList",function(){return{restrict:"E",replace:!0,scope:{signalBar:"="},templateUrl:"query_list.tpl.html",link:function(e){var t=e.queryList={addingQuery:!1};var i=e.signalBar;t.shown=function(e){return e.entity.Show};t.addQuery=function(){t.addingQuery=!0};t.create=function(e){i.createQuery(e)};t.added=function(e){t.activate(e)};t.edit=function(e){i.editQueryItem(e)};t.activate=function(e){i.activateQuery(e)}}}});
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,a,n){a&&e(t.prototype,a);n&&e(t,n);return t}}();var _module=angular.module("seq-ui2");_module.directive("signalList",function(){var e=function(){function e(){_classCallCheck(this,e);this.signalBar=null;this.collapsedSignals={};this.tagAllocator=null;this.addingSignal=!1}_createClass(e,[{key:"none",value:function(e){this.signalBar.toggleNone(e)}},{key:"default",value:function(e){this.signalBar.toggleDefaults(e)}},{key:"toggle",value:function(e,t){this.signalBar.toggle(e,t)}},{key:"toggleGroup",value:function(e){var t=!!this.collapsedSignals[e.group];this.collapsedSignals[e.group]=!t}},{key:"groupIsCollapsed",value:function(e){return!!this.collapsedSignals[e.group]}},{key:"groupIsEmpty",value:function(e){return e.signals.every(function(e){return!e.activated})}},{key:"signalClass",value:function(e,t){var a=function(e){return e.replace(/\s+/g,"-").replace(/[^A-Za-z-]/g,"").toLowerCase()};return t?a(t.group)+"-"+a(e.title):a(e.title)}},{key:"addSignal",value:function(){this.addingSignal=!0}},{key:"added",value:function(e){e.activated||this.toggle(e)}},{key:"create",value:function(e){this.signalBar.create(e)}},{key:"edit",value:function(e){this.signalBar.editItem(e)}},{key:"isWatched",value:function(e){return e.isWatched||e.activated}},{key:"items",get:function(){return this.signalBar.items}}]);return e}();return Seq.component("signalList",e,{signalBar:"=",tagAllocator:"="})});
"use strict";var _module=angular.module("seq-ui2");_module.directive("atScrollLimit",function(){return{restrict:"A",link:function(i,l,t){var r=l[0];l.bind("scroll",function(){r.scrollTop+r.offsetHeight>=r.scrollHeight-400&&i.$apply(t.atScrollLimit)})}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("eventSetStatistics",function(){return{restrict:"E",replace:!0,templateUrl:"event_set_statistics.tpl.html",scope:{refreshing:"=",eventSet:"="}}});
"use strict";var _module=angular.module("seq-ui2");var licenseStatus={license:null,isError:!1,isWarning:!1,isDismissed:!1,userIsAdmin:!1};_module.directive("licenseStatus",["session","$interval",function(s,e){return{restrict:"E",replace:!0,templateUrl:"license_status.tpl.html",scope:{},link:function(i){i.licenseStatus=licenseStatus;s.then(function(s){function t(){return s.api.licenses.getCurrent().then(function(s){licenseStatus.license=s;licenseStatus.isError=s&&!s.IsValid;licenseStatus.isWarning=s&&s.IsValid&&s.IsWarning;licenseStatus.isError&&(licenseStatus.isDismissed=!1)})}licenseStatus.userIsAdmin=s.user.IsAdministrator;licenseStatus.dismiss=function(){licenseStatus.isDismissed=!0};t();var n=e(t,6e5);i.$on("$destroy",function(){e.cancel(n)})})}}}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("expander",function(){return{restrict:"E",replace:!0,templateUrl:"expander.tpl.html",scope:{eventsLayout:"=",streamSlice:"=",currentEventSet:"="},link:function(e){function t(){e.expander.isExpanded=e.eventsLayout.timelineVisible;n.fromUtc||n.toUtc?i.caption="Specified range":i.caption="All time"}var n=e.streamSlice;var i=e.expander={caption:"All time",isExpanded:e.eventsLayout.timelineVisible,toggle:function(){e.expander.isExpanded=e.eventsLayout.timelineVisible=!e.expander.isExpanded}};e.$watch("currentEventSet",t);t()}}});
"use strict";var _module=angular.module("seq-ui2");_module.directive("viewSelector",function(){return{restrict:"E",replace:!0,templateUrl:"view_selector.tpl.html",scope:{layout:"=",view:"@",img:"@",caption:"@"}}});
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1;s.configurable=!0;"value"in s&&(s.writable=!0);Object.defineProperty(e,s.key,s)}}return function(t,i,s){i&&e(t.prototype,i);s&&e(t,s);return t}}();var _module=angular.module("seq-ui2");_module.controller("ApiKeysEditController",function(){function e(t,i,s,a,n,r){_classCallCheck(this,e);this.saving=new Seq.Busy(s,"update API key");this.parsingFilter=new Seq.Busy(s,"parse input filter");this.seq=a;this.messageBox=n;this.toast=r;this.$location=i;this.id=t.id;this.newProperty=e.defaultNewProperty();this.getApiKey()}e.$inject=["$routeParams","$location","$q","seq","messageBox","toast"];_createClass(e,[{key:"isExistingApiKey",value:function(){return!!this.id}},{key:"getApiKey",value:function(){var e=this;if(this.isExistingApiKey()){this.title="Edit API key";return this.seq.api.apiKeys.get(this.id).then(function(t){e.apiKey=t})}this.title="New API key";return this.seq.api.apiKeys.template().then(function(t){e.apiKey=t})}},{key:"saveApiKey",value:function(){var e=this;var t=!this.isExistingApiKey();this.addProperty();return this.saving.until(this.seq.api.apiKeys.createOrUpdate(this.apiKey).then(function(){t?e.toast.success("API key created"):e.toast.success("API key saved");e.$location.path("/settings/api-keys")}))}},{key:"deleteApiKey",value:function(){var e=this;return this.messageBox.confirm("Delete the API key?").then(function(){return e.saving.until(e.seq.api.apiKeys.remove(e.apiKey).then(function(){e.toast.success("API key deleted");e.$location.path("/settings/api-keys")}))})}},{key:"removeProperty",value:function(e){this.apiKey.AppliedProperties=_.without(this.apiKey.AppliedProperties,e)}},{key:"addProperty",value:function(){var t=this.newProperty;if(t&&t.Name&&""!==t.Name){this.apiKey.AppliedProperties.push(t);this.newProperty=e.defaultNewProperty()}}}],[{key:"defaultNewProperty",value:function(){return{Name:"",Value:""}}}]);return e}());
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();var _module=angular.module("seq-ui2");_module.controller("ApiKeysIndexController",function(){function e(t,n,i,r,s){var a=this;_classCallCheck(this,e);this.loading=new Seq.Busy(t,"load API keys");this.updating=new Seq.Busy(t,"update API key settings");this.seq=i;this.toast=r;this.loading.until(this.reload().then(function(){var e=s(function(){return a.reload()},1e4);n.$on("$destroy",function(){s.cancel(e)})}))}e.$inject=["$q","$scope","seq","toast","$interval"];_createClass(e,[{key:"saveSettings",value:function(){var e=this;return this.updating.until(this.seq.api.settings.setNamed("RequireApiKeyForWritingEvents",this.setting.RequireApiKeyForWritingEvents).then(function(){e.original=e.setting;e.setting={RequireApiKeyForWritingEvents:e.original.RequireApiKeyForWritingEvents};e.toast.success("Changes saved")}))}},{key:"reload",value:function(){var e=this;return this.seq.api.apiKeys.list().then(function(t){return e.seq.api.settings.getNamed("RequireApiKeyForWritingEvents").then(function(n){return e.seq.api.licenses.getCurrent().then(function(i){e.license=i;e.setting={RequireApiKeyForWritingEvents:n.Value};e.original={RequireApiKeyForWritingEvents:n.Value};e.apiKeys=_.sortBy(t,"Title")})})})}}]);return e}());
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t};var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(t,a.key,a)}}return function(e,n,a){n&&t(e.prototype,n);a&&t(e,a);return e}}();!function(){var t={Id:null,Name:"",AvailableSettings:[]};var e={};var n=function(){function n(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{entity:{},state:{}},r=a.entity,i=a.state;_classCallCheck(this,n);this.state=_extends({},e,i);this.entity=_extends({},t,r)}_createClass(n,[{key:"id",get:function(){return this.entity.Id}},{key:"name",get:function(){return this.entity.Name}},{key:"availableSettings",get:function(){return this.entity.AvailableSettings}}]);return n}();Seq.App=n}();
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(t,i.key,i)}}return function(n,e,i){e&&t(n.prototype,e);i&&t(n,i);return n}}();!function(){var t={Id:null,AppId:null,Title:null,ArrivalWindow:null,SuppressionTime:null,IsManualInputOnly:!0,DisallowManualInput:!1,InputSignalExpression:null,Settings:{},InvocationOverridableSettings:[],InvocationOverridableSettingDefinitions:[]};var n={};var e=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{entity:{},state:{}},r=i.entity,s=i.state;_classCallCheck(this,e);this.state=_extends({},n,s);this.entity=_extends({},t,r)}_createClass(e,[{key:"isInvocationOverridable",value:function(t){return this.invocationOverridableSettings.includes(t)}},{key:"allowInvocationOverride",value:function(t){this.invocationOverridableSettings.includes(t)||(this.entity=_extends({},this.entity,{InvocationOverridableSettings:[].concat(_toConsumableArray(this.entity.InvocationOverridableSettings),[t])}));return this}},{key:"denyInvocationOverride",value:function(t){this.invocationOverridableSettings.includes(t)&&(this.entity=_extends({},this.entity,{InvocationOverridableSettings:this.entity.InvocationOverridableSettings.filter(function(n){return n!==t})}));return this}},{key:"manualInputOnly",value:function(t){this.entity=_extends({},this.entity,{IsManualInputOnly:t,InputSignalExpression:t?null:this.inputSignalExpression});return this}},{key:"updateArrivalWindow",value:function(t){this.entity=_extends({},this.entity,{ArrivalWindow:t});return this}},{key:"updateSuppressionTime",value:function(t){this.entity=_extends({},this.entity,{SuppressionTime:t});return this}},{key:"updateSettings",value:function(t){this.entity=_extends({},this.entity,{Settings:t});return this}},{key:"id",get:function(){return this.entity.Id}},{key:"appId",get:function(){return this.entity.AppId}},{key:"title",get:function(){return this.entity.Title}},{key:"settings",get:function(){return this.entity.Settings}},{key:"invocationOverridableSettings",get:function(){return this.entity.InvocationOverridableSettings}},{key:"invocationOverridableSettingDefinitions",get:function(){return this.entity.InvocationOverridableSettingDefinitions}},{key:"isManualInputOnly",get:function(){return this.entity.IsManualInputOnly}},{key:"disallowManualInput",get:function(){return this.entity.DisallowManualInput}},{key:"arrivalWindow",get:function(){return this.entity.ArrivalWindow}},{key:"suppressionTime",get:function(){return this.entity.SuppressionTime}},{key:"inputSignalExpression",get:function(){return this.entity.InputSignalExpression}},{key:"iconUrl",get:function(){return this.entity.Links?this.entity.Links.IconUrl||null:null}}]);return e}();Seq.AppInstance=e}();
"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(n,a.key,a)}}return function(t,e,a){e&&n(t.prototype,e);a&&n(t,a);return t}}();!function(){var n=function(){function n(){_classCallCheck(this,n)}_createClass(n,null,[{key:"getAppInstances",value:function(n){return n.api.appInstances.list().then(function(t){return n.api.apps.list().then(function(n){return{instanceEntities:t,appEntities:n}})}).then(function(n){var t=n.instanceEntities,e=n.appEntities;var a=e.map(function(n){return new Seq.App({entity:n})});return t.map(function(n){return new Seq.AppInstance({entity:n})}).map(function(n){var t=a.find(function(t){return t.id===n.appId});var e=t.availableSettings.filter(function(t){return n.invocationOverridableSettings.includes(t.Name)});return{instance:n,overridableSettings:e,app:t}})})}}]);return n}();Seq.AppInstanceLoader=n}();
"use strict";function _defineProperty(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n;return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(t,i.key,i)}}return function(e,n,i){n&&t(e.prototype,n);i&&t(e,i);return e}}();!function(){var t={app:null,instance:null,isRawEditing:!1,createOptions:{runOnExisting:!1}};var e=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;_classCallCheck(this,e);var i=n.app||new Seq.App;var a=n.instance||new Seq.AppInstance;var r=i.availableSettings.reduce(function(t,e){if("Integer"===e.Type&&_typeof("string"===t[e.Name]))try{return _extends({},t,_defineProperty({},e.Name,parseInt(t[e.Name],10)))}catch(t){}else if("Decimal"===e.Type&&_typeof("string"===t[e.Name]))try{return _extends({},t,_defineProperty({},e.Name,parseFloat(t[e.Name])))}catch(t){}return t},a.settings);this.state=_extends({},t,n,{app:i,instance:a.updateSettings(r)});Seq.log("AppsRunState",this.state)}_createClass(e,[{key:"beginRawEdit",value:function(){this.state=_extends({},this.state,{isRawEditing:!0});return this}},{key:"finishRawEdit",value:function(t){this.state=_extends({},this.state,{isRawEditing:!1,instance:this.instance.updateSettings(t)});return this}},{key:"debounceWindow",value:function(){return this.instance.suppressionTime?new Seq.Duration(this.instance.suppressionTime):null}},{key:"updateDebounceWindow",value:function(t){this.instance.updateSuppressionTime(t?t.format():null)}},{key:"bufferSort",value:function(t){this.instance.updateArrivalWindow(t?this.instance.arrivalWindow||"00:00:30":null)}},{key:"manualInputOnly",value:function(t){this.instance.manualInputOnly(t)}},{key:"instance",get:function(){return this.state.instance}},{key:"app",get:function(){return this.state.app}},{key:"isRawEditing",get:function(){return this.state.isRawEditing}},{key:"isBufferedSort",get:function(){return!!this.instance.arrivalWindow}},{key:"isManualInputOnly",get:function(){return this.instance.isManualInputOnly}},{key:"createOptions",get:function(){return this.state.createOptions}}]);return e}();Seq.AppsRunState=e}();
"use strict";var _module=angular.module("seq-ui2");_module.controller("AppsIndexController",["$scope","$location","seq","busy","toast",function(e,a,n,t,c){var s=e.appsIndex={loading:t.create("load apps"),saving:t.create("save settings"),checkForPackageUpdates:!1,original:{checkForPackageUpdates:!1},apps:null,instances:null};s.getIconUrl=function(e){return e&&e.Package&&e.Package.IconUrl&&""!==e.Package.IconUrl?e.Package.IconUrl:"img/seq-app-package-default.png"};s.saveSettings=function(){s.saving.until(n.api.settings.setNamed("CheckForPackageUpdates",s.checkForPackageUpdates).then(function(){s.original.checkForPackageUpdates=s.checkForPackageUpdates;c.success("Changes saved")}))};return s.loading.until(n.api.apps.list().then(function(e){return n.api.appInstances.list().then(function(a){return n.api.settings.getNamed("CheckForPackageUpdates").then(function(n){s.apps=_.sortBy(e,"Name");s.instances=_.groupBy(_.sortBy(a,"Title"),"AppId");s.checkForPackageUpdates=s.original.checkForPackageUpdates=n.Value})})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("AppsInstallController",["$scope","$location","seq","$routeParams","toast","busy",function(e,a,n,t,s,l){var i=e.appsInstall={};i.loading=l.create("load feeds");i.installing=l.create("install app");return i.loading.until(n.api.feeds.list().then(function(e){i.feeds=_.sortBy(e,"Name");i.package={feedId:"",packageId:"",version:""};1===e.length&&(i.package.feedId=e[0].Id);i.installPackage=function(){return i.installing.until(n.api.apps.install(i.package).then(function(e){s.success("Installed "+e.Name+" version "+e.Package.Version);a.path("/settings/apps")}))}}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("AppsManageController",["$scope","$location","seq","$routeParams","toast","messageBox","busy",function(e,a,t,n,p,i,o){var s=e.appsManage={};s.loading=o.create("load app");s.updating=o.create("update app");var r=n.id;return s.loading.until(t.api.apps.get(r).then(function(e){return t.api.feeds.get(e.Package.NuGetFeedId).then(function(n){s.app=e;s.feed=n;s.package={version:"",force:!1};var o=s.app.Package.Version;s.updateApp=function(){return s.updating.until(t.api.apps.update(s.app,s.package).then(function(e){s.package.force||e.Package.Version!==o?p.success("Updated "+e.Name+" to version "+e.Package.Version):p.info("No new version of the package is available");a.path("/settings/apps")}))};s.deleteApp=function(){return i.confirm("Delete the app? This will delete all instances.").then(function(){return s.updating.until(t.api.apps.remove(s.app).then(function(){a.path("/settings/apps")}))})}})}))}]);
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t};var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1;a.configurable=!0;"value"in a&&(a.writable=!0);Object.defineProperty(t,a.key,a)}}return function(e,n,a){n&&t(e.prototype,n);a&&t(e,a);return e}}();var _module=angular.module("seq-ui2");_module.controller("AppsRunController",function(){function t(e,n,a,s,i,o,r){var u=this;_classCallCheck(this,t);this.$location=a;this.seq=i;this.toast=o;this.messageBox=r;this.loading=new Seq.Busy(n,"load app details");this.saving=new Seq.Busy(n,"save app details");var p=s.appId;var c=s.id;this.state=new Seq.AppsRunState;var l=p?i.api.apps.get(p).then(function(t){return i.api.appInstances.template(t).then(function(e){return{app:t,instance:e}})}):i.api.appInstances.get(c).then(function(t){return i.api.apps.get(t.AppId).then(function(e){return{app:e,instance:t}})});this.loading.until(l.then(function(t){var n=t.app,a=t.instance;u.state=new Seq.AppsRunState(_extends({},u.state.state,{app:new Seq.App({entity:n}),instance:new Seq.AppInstance({entity:a})}));u.bufferedSort=u.state.isBufferedSort;u.isManualInputOnly=u.state.isManualInputOnly;u.debounceWindow=u.state.debounceWindow();e.$watch("appsRun.bufferedSort",function(t){u.state.bufferSort(t)});e.$watch("appsRun.isManualInputOnly",function(t){u.state.manualInputOnly(t)});e.$watch("appsRun.debounceWindow",function(t){u.state.updateDebounceWindow(t)},!0)}))}t.$inject=["$scope","$q","$location","$routeParams","seq","toast","messageBox"];_createClass(t,[{key:"saveInstance",value:function(){var t=this;return this.saving.until(this.seq.api.appInstances.createOrUpdate(this.state.instance.entity,this.state.createOptions).then(function(){t.toast.success("App instance saved");t.$location.path("/settings/apps")}))}},{key:"deleteInstance",value:function(){var t=this;return this.messageBox.confirm("Delete the app instance?").then(function(){return t.saving.until(t.seq.api.appInstances.remove(t.state.instance.entity).then(function(){t.$location.path("/settings/apps")}))})}},{key:"editAsJson",value:function(){this.state.beginRawEdit()}},{key:"jsonEdited",value:function(t){this.state.finishRawEdit(t)}},{key:"app",get:function(){return this.state.app}},{key:"instance",get:function(){return this.state.instance}},{key:"createOptions",get:function(){return this.state.createOptions}}]);return t}());
"use strict";var _module=angular.module("seq-ui2");_module.controller("BackupIndexController",["$scope","seq","toast","busy",function(e,a,t,n){var s=e.backupIndex={loading:n.create("load backup information"),downloadImmediateHref:null,masterKeyIsBackedUp:!1};s.dismissWarning=function(){s.masterKeyIsBackedUp=!0;return a.api.settings.setNamed("MasterKeyIsBackedUp","True")};return s.loading.until(a.api.backups.list().then(function(e){return a.api.settings.getNamed("MasterKeyIsBackedUp").then(function(t){return a.api.backups.getImmediateBackupUrl().then(function(a){s.backups=e;s.immediateBackupUrl=a;s.masterKeyIsBackedUp=t.Value})})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("BackupScheduleController",["$scope","seq","toast","busy","$q","$location",function(t,e,n,a,s,u){var i=t.backupSchedule={loading:a.create("load backup settings"),saving:a.create("save backup settings"),settings:{BackupLocation:null,BackupsToKeep:null,BackupUtcTimeOfDay:null}};i.saveSettings=function(){var t=_.map(_.pairs(i.settings),function(t){return e.api.settings.setNamed(t[0],t[1])});return i.saving.until(s.all(t).then(function(){return e.api.backups.list().then(function(t){i.backups=t;n.success("Backup settings saved");u.path("/settings/backup")})}))};var c=_.map(_.keys(i.settings),function(t){return[t,e.api.settings.getNamed(t)]});var l=_.map(c,function(t){return t[1]});return i.loading.until(s.all(l).then(function(t){for(var e=0;e<t.length;++e)i.settings[c[e][0]]=t[e].Value}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("FeedEditController",["$scope","$routeParams","$location","seq","messageBox","toast","busy",function(e,t,n,d,s,a,i){var o=t.id;var u=e.editFeed={loading:i.create("load feed details"),saving:i.create("save feed details")};u.deleteFeed=function(){return s.confirm("Delete the feed?").then(function(){return u.saving.until(d.api.feeds.remove(u.feed).then(function(){a.success("Feed deleted");n.path("/settings/feeds")}))})};u.saveFeed=function(){return u.saving.until(d.api.feeds.createOrUpdate(u.feed).then(function(){a.success("Feed saved");n.path("/settings/feeds")}))};return o?u.loading.until(d.api.feeds.get(o).then(function(e){u.feed=e})):u.loading.until(d.api.feeds.template().then(function(e){u.feed=e}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("FeedsIndexController",["$scope","$location","seq",function(e,o,n){var r=e.feedsIndex={};return n.api.feeds.list().then(function(e){r.feeds=_.sortBy(e,"Name")})}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("RetentionEditController",["$scope","$routeParams","$location","seq","messageBox","toast","busy",function(e,t,n,i,o,r,a){var l=t.id;var c=e.editRetention={loading:a.create("load retention policy details"),saving:a.create("save retention policy details")};c.deletePolicy=function(){return o.confirm("Delete the policy?").then(function(){return c.saving.until(i.api.retentionPolicies.remove(c.policy).then(function(){n.path("/settings/retention")}))})};c.savePolicy=function(){c.policy.RetentionTime=c.time.format();return c.saving.until(i.api.retentionPolicies.createOrUpdate(c.policy).then(function(){r.success("Retention policy saved");n.path("/settings/retention")}))};return c.loading.until(i.api.signals.list().then(function(e){c.time=new Seq.Duration;return l?i.api.retentionPolicies.get(l).then(function(e){c.policy=e;c.time=new Seq.Duration(e.RetentionTime)}):i.api.retentionPolicies.template().then(function(e){c.policy=e;c.time=new Seq.Duration(e.RetentionTime)})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("RetentionIndexController",["$scope","seq","busy",function(e,n,t){var o=e.retentionIndex={loading:t.create("load retention policies")};return o.loading.until(n.api.retentionPolicies.list().then(function(e){o.policies=_.sortBy(e,function(e){return new Seq.Duration(e.RetentionTime).totalMinutes()})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("SystemAuthController",["$scope","$location","seq","busy",function(e,t,n,i){var r=e.auth={loading:i.create("load authentication details"),saving:i.create("save authentication details"),settings:n.settings,provider:"Basic",passwordIssues:{invalid:!1}};r.enableLocal=function(){var e=r.user.NewPassword;var i="ActiveDirectory"===r.provider;return r.saving.until(n.api.settings.setNamed("AzureADTenantId",null).then(function(){return n.api.settings.setNamed("AzureADClientId",null)}).then(function(){return n.api.settings.setNamed("AzureADClientKey",null)}).then(function(){return n.api.settings.setNamed("IsActiveDirectoryAuthentication",i)}).then(function(){return n.api.settings.setNamed("AutomaticallyGrantUserAccessToADAccounts",!1)}).then(function(){return n.api.users.update(r.user)}).then(function(){return n.api.users.login({Username:r.user.Username,Password:e})}).then(function(){return n.api.settings.setNamed("IsAuthenticationEnabled",!0)}).then(function(){return n.settings.reload()}).then(function(){return t.path("/settings/users")}))};r.enableAzureAD=function(){if(r.user.Username&&-1!==r.user.Username.indexOf("@")){if(r.azureAD.tenantId.Value&&r.azureAD.clientId.Value&&r.azureAD.clientKey.Value)return r.saving.until(n.api.settings.setNamed("IsActiveDirectoryAuthentication",!1).then(function(){return n.api.settings.setNamed("AutomaticallyGrantUserAccessToADAccounts",!1)}).then(function(){return n.api.settings.setNamed("AzureADTenantId",r.azureAD.tenantId.Value)}).then(function(){return n.api.settings.setNamed("AzureADClientId",r.azureAD.clientId.Value)}).then(function(){return n.api.settings.setNamed("AzureADClientKey",r.azureAD.clientKey.Value)}).then(function(){return n.api.users.update(r.user)}).then(function(){return n.settings.isAuthenticationEnabled?n.settings.reload().then(function(){return n.logout()}):n.api.settings.setNamed("IsAuthenticationEnabled",!0).then(function(){return n.settings.reload()}).then(function(){t.path("/login")})}));r.saving.setError("Azure Active Directory requires that each of the Tenant Id, Client Id, and Client Key is specified.")}else r.saving.setError("Azure Active Directory usernames must take the form of an email address.")};r.enable=function(){"AzureAD"===r.provider?r.enableAzureAD():r.enableLocal()};return r.loading.until(n.api.users.getCurrent().then(function(e){return n.api.settings.getNamed("IsActiveDirectoryAuthentication").then(function(t){return n.api.settings.getNamed("AzureADTenantId").then(function(i){return n.api.settings.getNamed("AzureADClientId").then(function(s){return n.api.settings.getNamed("AzureADClientKey").then(function(a){return n.api.licenses.getCurrent().then(function(n){r.user=e;r.license=n;r.azureAD={tenantId:i,clientId:s,clientKey:a};r.provider=t.Value?"ActiveDirectory":i.Value?"AzureAD":"Basic";if("admin"===e.Username){r.user.Username="";r.user.DisplayName=""}})})})})})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("SystemSettingsIndexController",["$scope","seq","toast","busy","$q",function(t,a,s,e,n){var i=t.systemIndex={loading:e.create("load system settings"),saving:e.create("save system settings"),settings:{RawPayloadMaximumContentLength:null,RawEventMaximumContentLength:null,IsActiveDirectoryAuthentication:null,AutomaticallyGrantUserAccessToADAccounts:null,CheckForUpdates:null,MinimumFreeStorageSpace:null,AzureADTenantId:null,LazilyFlushEventWrites:null},partials:{automaticAccessADDomain:null,automaticAccessADGroup:null}};i.saveSettings=function(){var t=null;if(i.settings.AutomaticallyGrantUserAccessToADAccounts){if(!(!i.partials.automaticAccessADDomain&&!i.partials.automaticAccessADGroup||i.partials.automaticAccessADDomain&&i.partials.automaticAccessADGroup)){i.saving.setError("Both domain and group must be specified.");return}i.partials.automaticAccessADDomain&&(t=i.partials.automaticAccessADDomain+"\\"+i.partials.automaticAccessADGroup)}var e=_.map(_.pairs(i.settings),function(t){return a.api.settings.setNamed(t[0],t[1])});e.push(a.api.settings.setNamed("AutomaticAccessADGroup",t));return i.saving.until(n.all(e).then(function(){s.success("System settings saved")}))};var u=_.map(_.keys(i.settings),function(t){return[t,a.api.settings.getNamed(t)]});var c=_.map(u,function(t){return t[1]});return i.loading.until(n.all(c).then(function(t){for(var s=0;s<t.length;++s)i.settings[u[s][0]]=t[s].Value;return a.api.settings.getNamed("AutomaticAccessADGroup").then(function(t){if("string"==typeof t.Value){var a=t.Value.split("\\");if(a.length>0){i.partials.automaticAccessADDomain=a[0];a.length>1&&(i.partials.automaticAccessADGroup=a[1])}}})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("SystemPasswordPolicyController",["$scope","seq","busy","toast",function(e,i,r,s){var a=e.systemPasswordPolicy={loading:r.create("load password policy"),saving:r.create("save password policy"),minimumLength:0,requireUppercase:!1,requireLowercase:!1,requireDigit:!1,requirePunctuation:!1};a.loading.until(i.api.settings.getNamed("MinimumPasswordLength").then(function(e){return i.api.settings.getNamed("PasswordRequiredCharacterClasses").then(function(i){a.minimumLength=e.Value;var r=i.Value;null===r&&(r="");a.requireUppercase=-1!==r.indexOf("A");a.requireLowercase=-1!==r.indexOf("a");a.requireDigit=-1!==r.indexOf("0");a.requirePunctuation=-1!==r.indexOf("!")})}));a.save=function(){var e="";a.requireUppercase&&(e+="A");a.requireLowercase&&(e+="a");a.requireDigit&&(e+="0");a.requirePunctuation&&(e+="!");return i.api.settings.setNamed("MinimumPasswordLength",a.minimumLength).then(i.api.settings.setNamed("PasswordRequiredCharacterClasses",e)).then(function(){s.success("Password policy updated")})}}]);
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1;s.configurable=!0;"value"in s&&(s.writable=!0);Object.defineProperty(e,s.key,s)}}return function(t,n,s){n&&e(t.prototype,n);s&&e(t,s);return t}}();var _module=angular.module("seq-ui2");_module.controller("UsersDefaultsController",function(){function e(t,n,s){_classCallCheck(this,e);this.d={seq:t,toast:s};this.loading=new Seq.Busy(n,"load new user defaults");this.saving=new Seq.Busy(n,"save new user defaults");this.showSignalIds=[];this.loading.until(this.loadSettings())}e.$inject=["seq","$q","toast"];_createClass(e,[{key:"loadSettings",value:function(){var e=this;return this.d.seq.api.settings.getNamed("NewUserShowSignalIds").then(function(t){_.each((t.Value||"").split(","),function(t){""!==t&&e.showSignalIds.push(t)})})}},{key:"saveSettings",value:function(){var e=this;var t=this.showSignalIds.join(",");return this.saving.until(this.d.seq.api.settings.setNamed("NewUserShowSignalIds",t)).then(function(){return e.d.toast.info("Settings saved")})}}]);return e}());
"use strict";var _module=angular.module("seq-ui2");_module.controller("UsersEditController",["$scope","$routeParams","$location","seq","messageBox","toast","busy",function(e,s,t,n,r,a,i){var u=e.editUser={settings:n.settings,loading:i.create("load user"),saving:i.create("save user"),parsingFilter:i.create("parse filter"),passwordIssues:{invalid:!1},showSignalIds:[]};var o=s.id;u.deleteUser=function(){return r.confirm("Delete this user?").then(function(){return u.saving.until(n.api.users.remove(u.user).then(function(){t.path("/settings/users")}))})};u.saveUser=function(){return u.saving.until(n.api.users.createOrUpdate(u.user,{watchSignalIds:u.showSignalIds.join(",")}).then(function(){a.success("User saved");t.path("/settings/users")}))};return o?u.loading.until(n.api.users.get(o).then(function(e){u.user=e;var s=e.Id===n.user.Id;u.canDelete=!s;u.canDemote=!s})):u.loading.until(n.api.settings.getNamed("NewUserShowSignalIds").then(function(e){_.each((e.Value||"").split(","),function(e){e&&u.showSignalIds.push(e)})}).then(function(){return n.api.users.template()}).then(function(e){u.user=e;u.canDelete=!0;u.canDemote=!0}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.controller("UsersIndexController",["$scope","seq","busy",function(e,s,n){var r=e.usersIndex={loading:n.create("load users"),settings:s.settings};return r.loading.until(s.api.users.list().then(function(e){return s.api.licenses.getCurrent().then(function(s){r.license=s;r.users=_.sortBy(e,"Username")})}))}]);
"use strict";var _module=angular.module("seq-ui2");_module.directive("permalink",["$window","$document","$timeout",function(e,i,n){return{restrict:"E",replace:!0,templateUrl:"permalink.tpl.html",scope:{isVisible:"=",event:"="},link:function(t,l){var a=function(){var a=t.event;var r=e.location.href.slice(0,-e.location.hash.length);var o=r+"#/events/?filter=@Id%20%3D%20%27"+a.Id+"%27&showExpanded";(t.permalink={url:o}).close=function(){t.isVisible=!1};n(function(){var n=l.find("a")[0];var t=i[0].createRange();t.selectNodeContents(n);var a=e.getSelection();a.removeAllRanges();a.addRange(t)},100)};if(t.isVisible)a();else var r=t.$watch("isVisible",function(e){if(e){r();a()}})}}}]);
"use strict";!function(){function e(e){if("string"!=typeof e)throw new Error("A date-time-offset string is required.");var t=this;t.localDateTime=new Date(e);var r=e.slice("-6");var i="-"===r[0];var s=r.slice(1).split(":");var a=parseInt(s[0],10)+parseInt(s[1],10)/60;t.originOffsetHours=i?-a:a}Seq.DateTimeOffset=e}();
"use strict";!function(){function t(t,e){return(t+e.toString()).slice(-t.length)}function e(t,e,r){var o=this;o.ampm=t;o.utc=e;o.startOfWeek=r||0}var r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.prototype._adjust=function(t){return this.utc?new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds()):t};e.prototype.formatDay=function(e){e=this._adjust(e);return t("00",e.getDate())+" "+r[e.getMonth()]};e.prototype.formatTime=function(e){var r=this;e=r._adjust(e);if(r.ampm){var o=moment(e).format("hh:mm:ss.SSS A");"0"===o[0]&&(o=" "+o.slice(1));return o}return t("00",e.getHours())+":"+t("00",e.getMinutes())+":"+t("00",e.getSeconds())+"."+t("000",e.getMilliseconds())};e.prototype.formatYear=function(t){t=this._adjust(t);return t.getFullYear().toString()};e.prototype.formatTimestamp=function(t){var e=this;t=e._adjust(t);return e.formatDay(t)+" "+e.formatYear(t)+" "+e.formatTime(t)};e.prototype.formatFullDateTime=function(t){return(this.utc?moment(t).utc():moment(t)).format(e.fullDateTimeFormat)};e.prototype.formatIso=function(t){return t.toISOString()};e.fullDateTimeFormat="YYYY-MM-DD HH:mm:ss";Seq.TimePreferences=e}();
"use strict";var _module=angular.module("seq-ui2");_module.directive("availableUpdates",["$interval","$location","session","toast",function(e,t,a,i){return{restrict:"E",replace:!0,templateUrl:"available_updates.tpl.html",scope:{},link:function(t){var n=t.availableUpdates={isDisabled:!1,updateAvailable:!1,browseUrl:null,updateDescription:null};a.then(function(a){n.enable=function(){return a.api.settings.setNamed("CheckForUpdates",!0).then(function(){i.success("Update checking is enabled; you can undo this in Settings > System.");n.isDisabled=!1})};var l=function(){return a.api.settings.getNamed("CheckForUpdates").then(function(e){n.isDisabled=!e.Value;if(e.Value)return a.api.updates.list().then(function(e){if(1===e.length){var t=e[0];n.updateAvailable=!0;n.updateDescription=t.Description;n.browseUrl=t.Links.Browse}else n.updateAvailable=!1});n.updateAvailable=!1})};var s=e(l,6e4);t.$on("$destroy",function(){e.cancel(s)})})}}}]);
//# sourceMappingURL=maps/seq-ui2-1516172539357.min.js.map
